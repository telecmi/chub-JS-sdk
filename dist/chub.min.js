"use strict";!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JsSIP=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("../package.json"),e={USER_AGENT:d.title+" "+d.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60};b.exports=e},{"../package.json":51}],2:[function(a,b,c){function d(a,b,c,d){var h;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!b.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};d=b instanceof g.IncomingResponse?b.status_code<200?e.STATUS_EARLY:e.STATUS_CONFIRMED:d||e.STATUS_CONFIRMED,h=b.parseHeader("contact"),"UAS"===c?(this.id={call_id:b.call_id,local_tag:b.to_tag,remote_tag:b.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.remote_seqnum=b.cseq,this.local_uri=b.parseHeader("to").uri,this.remote_uri=b.parseHeader("from").uri,this.remote_target=h.uri,this.route_set=b.getHeaders("record-route")):"UAC"===c&&(this.id={call_id:b.call_id,local_tag:b.from_tag,remote_tag:b.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.local_seqnum=b.cseq,this.local_uri=b.parseHeader("from").uri,this.remote_uri=b.parseHeader("to").uri,this.remote_target=h.uri,this.route_set=b.getHeaders("record-route").reverse()),this.owner=a,a.ua.dialogs[this.id.toString()]=this,f("new "+c+" dialog created with status "+(this.state===e.STATUS_EARLY?"EARLY":"CONFIRMED"))}b.exports=d;var e={STATUS_EARLY:1,STATUS_CONFIRMED:2};d.C=e;var f=a("debug")("JsSIP:Dialog"),g=a("./SIPMessage"),h=a("./Constants"),i=a("./Transactions"),j=a("./Dialog/RequestSender");d.prototype={update:function(a,b){this.state=e.STATUS_CONFIRMED,f("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===b&&(this.route_set=a.getHeaders("record-route").reverse())},terminate:function(){f("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(a,b,c){var d,e;return b=b&&b.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),d=a===h.CANCEL||a===h.ACK?this.local_seqnum:this.local_seqnum+=1,e=new g.OutgoingRequest(a,this.remote_target,this.owner.ua,{cseq:d,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},b,c),e.dialog=this,e},checkInDialogRequest:function(a){var b=this;if(this.remote_seqnum){if(a.cseq<this.remote_seqnum)return a.method!==h.ACK&&a.reply(500),!1;a.cseq>this.remote_seqnum&&(this.remote_seqnum=a.cseq)}else this.remote_seqnum=a.cseq;if(a.method===h.INVITE||a.method===h.UPDATE&&a.body){if(!0===this.uac_pending_reply)a.reply(491);else{if(!0===this.uas_pending_reply){var c=1+(10*Math.random()|0);return a.reply(500,null,["Retry-After:"+c]),!1}this.uas_pending_reply=!0,a.server_transaction.on("stateChanged",function c(){this.state!==i.C.STATUS_ACCEPTED&&this.state!==i.C.STATUS_COMPLETED&&this.state!==i.C.STATUS_TERMINATED||(a.server_transaction.removeListener("stateChanged",c),b.uas_pending_reply=!1)})}a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(){this.state===i.C.STATUS_ACCEPTED&&(b.remote_target=a.parseHeader("contact").uri)})}else a.method===h.NOTIFY&&a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(){this.state===i.C.STATUS_COMPLETED&&(b.remote_target=a.parseHeader("contact").uri)});return!0},sendRequest:function(a,b,c){c=c||{};var d=c.extraHeaders&&c.extraHeaders.slice()||[],e=c.body||null,f=this.createRequest(b,d,e);return new j(this,a,f).send(),f},receiveRequest:function(a){this.checkInDialogRequest(a)&&this.owner.receiveRequest(a)}}},{"./Constants":1,"./Dialog/RequestSender":3,"./SIPMessage":19,"./Transactions":22,debug:35}],3:[function(a,b,c){function d(a,b,c){this.dialog=a,this.applicant=b,this.request=c,this.reattempt=!1,this.reattemptTimer=null}b.exports=d;var e=a("../Constants"),f=a("../Transactions"),g=a("../RTCSession"),h=a("../RequestSender");d.prototype={send:function(){var a=this,b=new h(this,this.dialog.owner.ua);b.send(),(this.request.method===e.INVITE||this.request.method===e.UPDATE&&this.request.body)&&b.clientTransaction.state!==f.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,b.clientTransaction.on("stateChanged",function c(){this.state!==f.C.STATUS_ACCEPTED&&this.state!==f.C.STATUS_COMPLETED&&this.state!==f.C.STATUS_TERMINATED||(b.clientTransaction.removeListener("stateChanged",c),a.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b=this;408===a.status_code||481===a.status_code?this.applicant.onDialogError(a):a.method===e.INVITE&&491===a.status_code?this.reattempt?this.applicant.receiveResponse(a):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){b.applicant.owner.status!==g.C.STATUS_TERMINATED&&(b.reattempt=!0,b.request_sender.send())},1e3)):this.applicant.receiveResponse(a)}}},{"../Constants":1,"../RTCSession":11,"../RequestSender":18,"../Transactions":22}],4:[function(a,b,c){function d(a){this.credentials=a,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.algorithm=null,this.realm=null,this.nonce=null,this.opaque=null,this.stale=null,this.qop=null,this.method=null,this.uri=null,this.ha1=null,this.response=null}b.exports=d;var e=a("debug")("JsSIP:DigestAuthentication"),f=a("debug")("JsSIP:ERROR:DigestAuthentication");f.log=console.warn.bind(console);var g=a("./Utils");d.prototype.get=function(a){switch(a){case"realm":return this.realm;case"ha1":return this.ha1;default:return void f('get() | cannot get "%s" parameter',a)}},d.prototype.authenticate=function(a,b){var c,d;if(this.algorithm=b.algorithm,this.realm=b.realm,this.nonce=b.nonce,this.opaque=b.opaque,this.stale=b.stale,this.algorithm){if("MD5"!==this.algorithm)return f('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.nonce)return f("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this.realm)return f("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this.credentials.password){if(!this.credentials.ha1)return f("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this.credentials.realm!==this.realm)return f('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this.credentials.realm,this.realm),!1}if(b.qop)if(b.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(b.qop.indexOf("auth-int")>-1))return f('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=a.method,this.uri=a.ruri,this.cnonce=g.createRandomToken(12),this.nc+=1,d=Number(this.nc).toString(16),this.ncHex="00000000".substr(0,8-d.length)+d,4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.credentials.password?this.ha1=g.calculateMD5(this.credentials.username+":"+this.realm+":"+this.credentials.password):this.ha1=this.credentials.ha1,"auth"===this.qop?(c=g.calculateMD5(this.method+":"+this.uri),this.response=g.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+c)):"auth-int"===this.qop?(c=g.calculateMD5(this.method+":"+this.uri+":"+g.calculateMD5(this.body?this.body:"")),this.response=g.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+c)):null===this.qop&&(c=g.calculateMD5(this.method+":"+this.uri),this.response=g.calculateMD5(this.ha1+":"+this.nonce+":"+c)),e("authenticate() | response generated"),!0},d.prototype.toString=function(){var a=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return a.push("algorithm="+this.algorithm),a.push('username="'+this.credentials.username+'"'),a.push('realm="'+this.realm+'"'),a.push('nonce="'+this.nonce+'"'),a.push('uri="'+this.uri+'"'),a.push('response="'+this.response+'"'),this.opaque&&a.push('opaque="'+this.opaque+'"'),this.qop&&(a.push("qop="+this.qop),a.push('cnonce="'+this.cnonce+'"'),a.push("nc="+this.ncHex)),"Digest "+a.join(", ")}},{"./Utils":26,debug:35}],5:[function(a,b,c){var d={ConfigurationError:function(){var a=function(a,b){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=a,this.value=b,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return a.prototype=new Error,a}(),InvalidStateError:function(){var a=function(a){this.code=2,this.name="INVALID_STATE_ERROR",this.status=a,this.message="Invalid status: "+a};return a.prototype=new Error,a}(),NotSupportedError:function(){var a=function(a){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=a};return a.prototype=new Error,a}(),NotReadyError:function(){var a=function(a){this.code=4,this.name="NOT_READY_ERROR",this.message=a};return a.prototype=new Error,a}()};b.exports=d},{}],6:[function(a,b,c){b.exports=function(){function b(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var c={parse:function(c,d){function e(a){rd<td||(rd>td&&(td=rd,ud=[]),ud.push(a))}function f(){var a;return"\r\n"===c.substr(rd,2)?(a="\r\n",rd+=2):(a=null,0===sd&&e('"\\r\\n"')),a}function g(){var a;return/^[0-9]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[0-9]")),a}function h(){var a;return/^[a-zA-Z]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[a-zA-Z]")),a}function i(){var a;return/^[0-9a-fA-F]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[0-9a-fA-F]")),a}function j(){var a;return a=m(),null===a&&(a=n()),a}function k(){var a;return/^[\0-\xFF]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\0-\\xFF]")),a}function l(){var a;return/^["]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e('["]')),a}function m(){var a;return 32===c.charCodeAt(rd)?(a=" ",rd++):(a=null,0===sd&&e('" "')),a}function n(){var a;return 9===c.charCodeAt(rd)?(a="\t",rd++):(a=null,0===sd&&e('"\\t"')),a}function o(){var a;return/^[a-zA-Z0-9]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[a-zA-Z0-9]")),a}function p(){var a;return 59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","'))))))))))),a}function q(){var a;return a=o(),null===a&&(a=r()),a}function r(){var a;return 45===c.charCodeAt(rd)?(a="-",rd++):(a=null,0===sd&&e('"-"')),null===a&&(95===c.charCodeAt(rd)?(a="_",rd++):(a=null,0===sd&&e('"_"')),null===a&&(46===c.charCodeAt(rd)?(a=".",rd++):(a=null,0===sd&&e('"."')),null===a&&(33===c.charCodeAt(rd)?(a="!",rd++):(a=null,0===sd&&e('"!"')),null===a&&(126===c.charCodeAt(rd)?(a="~",rd++):(a=null,0===sd&&e('"~"')),null===a&&(42===c.charCodeAt(rd)?(a="*",rd++):(a=null,0===sd&&e('"*"')),null===a&&(39===c.charCodeAt(rd)?(a="'",rd++):(a=null,0===sd&&e('"\'"')),null===a&&(40===c.charCodeAt(rd)?(a="(",rd++):(a=null,0===sd&&e('"("')),null===a&&(41===c.charCodeAt(rd)?(a=")",rd++):(a=null,0===sd&&e('")"')))))))))),a}function s(){var a,b,d,f,g;return f=rd,g=rd,37===c.charCodeAt(rd)?(a="%",rd++):(a=null,0===sd&&e('"%"')),null!==a?(b=i(),null!==b?(d=i(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){return b.join("")}(0,a)),null===a&&(rd=f),a}function t(){var a,b,c,d,e,g;for(d=rd,e=rd,g=rd,a=[],b=j();null!==b;)a.push(b),b=j();if(null!==a?(b=f(),null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==(a=null!==a?a:"")){if(null!==(c=j()))for(b=[];null!==c;)b.push(c),c=j();else b=null;null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return null!==a&&(a=" "),null===a&&(rd=d),a}function u(){var a;return a=t(),a=null!==a?a:""}function v(){var a,b,d,f,g;for(f=rd,g=rd,a=[],b=m(),null===b&&(b=n());null!==b;)a.push(b),null===(b=m())&&(b=n());return null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=":"),null===a&&(rd=f),a}function w(){var a,b,d,e,f,g,h;if(f=rd,g=rd,null!==(b=x()))for(a=[];null!==b;)a.push(b),b=x();else a=null;if(null!==a){for(b=[],h=rd,d=[],e=t();null!==e;)d.push(e),e=t();for(null!==d?(e=x(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h);null!==d;){for(b.push(d),h=rd,d=[],e=t();null!==e;)d.push(e),e=t();null!==d?(e=x(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h)}null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return null!==a&&(a=function(a){return c.substring(rd,a)}(f)),null===a&&(rd=f),a}function x(){var a;return/^[!-~]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[!-~]")),null===a&&(a=y()),a}function y(){var a;return/^[\x80-\uFFFF]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\x80-\\uFFFF]")),a}function z(){var a;return/^[\x80-\xBF]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\x80-\\xBF]")),a}function A(){var a;return a=g(),null===a&&(/^[a-f]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[a-f]"))),a}function B(){var a,b,d;if(d=rd,b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')))))))))))),null!==b)for(a=[];null!==b;)a.push(b),null===(b=o())&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"'))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(rd,a)}(d)),null===a&&(rd=d),a}function C(){var a,b,d;if(d=rd,b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),null===(b=o())&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(rd,a)}(d)),null===a&&(rd=d),a}function D(){var a;return 40===c.charCodeAt(rd)?(a="(",rd++):(a=null,0===sd&&e('"("')),null===a&&(41===c.charCodeAt(rd)?(a=")",rd++):(a=null,0===sd&&e('")"')),null===a&&(60===c.charCodeAt(rd)?(a="<",rd++):(a=null,0===sd&&e('"<"')),null===a&&(62===c.charCodeAt(rd)?(a=">",rd++):(a=null,0===sd&&e('">"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","')),null===a&&(59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(92===c.charCodeAt(rd)?(a="\\",rd++):(a=null,0===sd&&e('"\\\\"')),null===a&&null===(a=l())&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null===a&&(93===c.charCodeAt(rd)?(a="]",rd++):(a=null,0===sd&&e('"]"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(123===c.charCodeAt(rd)?(a="{",rd++):(a=null,0===sd&&e('"{"')),null===a&&(125===c.charCodeAt(rd)?(a="}",rd++):(a=null,0===sd&&e('"}"')),null===a&&null===(a=m())&&(a=n())))))))))))))))),a}function E(){var a,b,d;if(d=rd,b=o(),null===b&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')),null===b&&(40===c.charCodeAt(rd)?(b="(",rd++):(b=null,0===sd&&e('"("')),null===b&&(41===c.charCodeAt(rd)?(b=")",rd++):(b=null,0===sd&&e('")"')),null===b&&(60===c.charCodeAt(rd)?(b="<",rd++):(b=null,0===sd&&e('"<"')),null===b&&(62===c.charCodeAt(rd)?(b=">",rd++):(b=null,0===sd&&e('">"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(92===c.charCodeAt(rd)?(b="\\",rd++):(b=null,0===sd&&e('"\\\\"')),null===b&&null===(b=l())&&(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null===b&&(91===c.charCodeAt(rd)?(b="[",rd++):(b=null,0===sd&&e('"["')),null===b&&(93===c.charCodeAt(rd)?(b="]",rd++):(b=null,0===sd&&e('"]"')),null===b&&(63===c.charCodeAt(rd)?(b="?",rd++):(b=null,0===sd&&e('"?"')),null===b&&(123===c.charCodeAt(rd)?(b="{",rd++):(b=null,0===sd&&e('"{"')),null===b&&(125===c.charCodeAt(rd)?(b="}",rd++):(b=null,0===sd&&e('"}"')))))))))))))))))))))))),null!==b)for(a=[];null!==b;)a.push(b),null===(b=o())&&(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null===b&&(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null===b&&(33===c.charCodeAt(rd)?(b="!",rd++):(b=null,0===sd&&e('"!"')),null===b&&(37===c.charCodeAt(rd)?(b="%",rd++):(b=null,0===sd&&e('"%"')),null===b&&(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null===b&&(95===c.charCodeAt(rd)?(b="_",rd++):(b=null,0===sd&&e('"_"')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(96===c.charCodeAt(rd)?(b="`",rd++):(b=null,0===sd&&e('"`"')),null===b&&(39===c.charCodeAt(rd)?(b="'",rd++):(b=null,0===sd&&e('"\'"')),null===b&&(126===c.charCodeAt(rd)?(b="~",rd++):(b=null,0===sd&&e('"~"')),null===b&&(40===c.charCodeAt(rd)?(b="(",rd++):(b=null,0===sd&&e('"("')),null===b&&(41===c.charCodeAt(rd)?(b=")",rd++):(b=null,0===sd&&e('")"')),null===b&&(60===c.charCodeAt(rd)?(b="<",rd++):(b=null,0===sd&&e('"<"')),null===b&&(62===c.charCodeAt(rd)?(b=">",rd++):(b=null,0===sd&&e('">"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(92===c.charCodeAt(rd)?(b="\\",rd++):(b=null,0===sd&&e('"\\\\"')),null===b&&null===(b=l())&&(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null===b&&(91===c.charCodeAt(rd)?(b="[",rd++):(b=null,0===sd&&e('"["')),null===b&&(93===c.charCodeAt(rd)?(b="]",rd++):(b=null,0===sd&&e('"]"')),null===b&&(63===c.charCodeAt(rd)?(b="?",rd++):(b=null,0===sd&&e('"?"')),null===b&&(123===c.charCodeAt(rd)?(b="{",rd++):(b=null,0===sd&&e('"{"')),null===b&&(125===c.charCodeAt(rd)?(b="}",rd++):(b=null,0===sd&&e('"}"'))))))))))))))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(rd,a)}(d)),null===a&&(rd=d),a}function F(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(42===c.charCodeAt(rd)?(b="*",rd++):(b=null,0===sd&&e('"*"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a="*"),null===a&&(rd=f),a}function G(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a="/"),null===a&&(rd=f),a}function H(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a="="),null===a&&(rd=f),a}function I(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(40===c.charCodeAt(rd)?(b="(",rd++):(b=null,0===sd&&e('"("')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a="("),null===a&&(rd=f),a}function J(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(41===c.charCodeAt(rd)?(b=")",rd++):(b=null,0===sd&&e('")"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=")"),null===a&&(rd=f),a}function K(){var a,b,d,f;return d=rd,f=rd,62===c.charCodeAt(rd)?(a=">",rd++):(a=null,0===sd&&e('">"')),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=">"),null===a&&(rd=d),a}function L(){var a,b,d,f;return d=rd,f=rd,a=u(),null!==a?(60===c.charCodeAt(rd)?(b="<",rd++):(b=null,0===sd&&e('"<"')),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a="<"),null===a&&(rd=d),a}function M(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=","),null===a&&(rd=f),a}function N(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=";"),null===a&&(rd=f),a}function O(){var a,b,d,f,g;return f=rd,g=rd,a=u(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=":"),null===a&&(rd=f),a}function P(){var a,b,c,d;return c=rd,d=rd,a=u(),null!==a?(b=l(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),null!==a&&(a='"'),null===a&&(rd=c),a}function Q(){var a,b,c,d;return c=rd,d=rd,a=l(),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),null!==a&&(a='"'),null===a&&(rd=c),a}function R(){var a,b,c,d;if(d=rd,null!==(a=I())){for(b=[],c=S(),null===c&&null===(c=W())&&(c=R());null!==c;)b.push(c),null===(c=S())&&null===(c=W())&&(c=R());null!==b?(c=J(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)}else a=null,rd=d;return a}function S(){var a;return/^[!-']/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[!-']")),null===a&&(/^[*-[]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[*-[]")),null===a&&(/^[\]-~]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\]-~]")),null===a&&null===(a=y())&&(a=t()))),a}function T(){var a,b,d,e,f,g;if(f=rd,g=rd,null!==(a=u()))if(null!==(b=l())){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),null===(e=V())&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,rd=g)):(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;return null!==a&&(a=function(a){return c.substring(rd,a)}(f)),null===a&&(rd=f),a}function U(){var a,b,d,e,f,g;if(f=rd,g=rd,null!==(a=u()))if(null!==(b=l())){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),null===(e=V())&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,rd=g)):(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;return null!==a&&(a=function(a){return c.substring(rd-1,a+1)}(f)),null===a&&(rd=f),a}function V(){var a;return a=t(),null===a&&(33===c.charCodeAt(rd)?(a="!",rd++):(a=null,0===sd&&e('"!"')),null===a&&(/^[#-[]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[#-[]")),null===a&&(/^[\]-~]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[\\]-~]")),null===a&&(a=y())))),a}function W(){var a,b,d;return d=rd,92===c.charCodeAt(rd)?(a="\\",rd++):(a=null,0===sd&&e('"\\\\"')),null!==a?(/^[\0-\t]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[\\0-\\t]")),null===b&&(/^[\x0B-\f]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[\\x0B-\\f]")),null===b&&(/^[\x0E-]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[\\x0E-]")))),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function X(){var a,b,d,f,g,h;return g=rd,h=rd,a=Z(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=aa(),d=null!==d?d:"",null!==d?(f=ea(),null!==f?a=[a,b,d,f]:(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h),null!==a&&(a=function(a){try{xd.uri=new vd(xd.scheme,xd.user,xd.host,xd.port),delete xd.scheme,delete xd.user,delete xd.host,delete xd.host_type,delete xd.port}catch(a){xd=-1}}()),null===a&&(rd=g),a}function Y(){var a,b,f,g,h,i,j,k;return j=rd,k=rd,a=Z(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(f=aa(),f=null!==f?f:"",null!==f?(g=ea(),null!==g?(h=qa(),null!==h?(i=Da(),i=null!==i?i:"",null!==i?a=[a,b,f,g,h,i]:(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k),null!==a&&(a=function(a){try{xd.uri=new vd(xd.scheme,xd.user,xd.host,xd.port,xd.uri_params,xd.uri_headers),delete xd.scheme,delete xd.user,delete xd.host,delete xd.host_type,delete xd.port,delete xd.uri_params,"SIP_URI"===d&&(xd=xd.uri)}catch(a){xd=-1}}()),null===a&&(rd=j),a}function Z(){var a;return a=$(),null===a&&(a=_()),a}function $(){var a,b;return b=rd,"sips"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"sips"')),null!==a&&(a=function(a,b){xd.scheme=b.toLowerCase()}(0,a)),null===a&&(rd=b),a}function _(){var a,b;return b=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"sip"')),null!==a&&(a=function(a,b){xd.scheme=b.toLowerCase()}(0,a)),null===a&&(rd=b),a}function aa(){var a,b,d,f,g,h;return f=rd,g=rd,a=ba(),null!==a?(h=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=da(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?(64===c.charCodeAt(rd)?(d="@",rd++):(d=null,0===sd&&e('"@"')),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd.user=decodeURIComponent(c.substring(rd-1,a))}(f)),null===a&&(rd=f),a}function ba(){var a,b;if(b=q(),null===b&&null===(b=s())&&(b=ca()),null!==b)for(a=[];null!==b;)a.push(b),null===(b=q())&&null===(b=s())&&(b=ca());else a=null;return a}function ca(){var a;return 38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","')),null===a&&(59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"'))))))))),a}function da(){var a,b,d;for(d=rd,a=[],b=q(),null===b&&null===(b=s())&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')))))));null!==b;)a.push(b),null===(b=q())&&null===(b=s())&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')),null===b&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')))))));return null!==a&&(a=function(a){xd.password=c.substring(rd,a)}(d)),null===a&&(rd=d),a}function ea(){var a,b,d,f,g;return f=rd,a=fa(),null!==a?(g=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,rd=g)):(b=null,rd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),a}function fa(){var a,b;return b=rd,a=ga(),null===a&&null===(a=na())&&(a=ja()),null!==a&&(a=function(a){return xd.host=c.substring(rd,a).toLowerCase(),xd.host}(b)),null===a&&(rd=b),a}function ga(){var a,b,d,f,g,h;for(f=rd,g=rd,a=[],h=rd,b=ha(),null!==b?(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h);null!==b;)a.push(b),h=rd,b=ha(),null!==b?(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h);return null!==a?(b=ia(),null!==b?(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return xd.host_type="domain",c.substring(rd,a)}(f)),null===a&&(rd=f),a}function ha(){var a,b,d,f;if(f=rd,null!==(a=o())){for(b=[],d=o(),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==d;)b.push(d),null===(d=o())&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return a}function ia(){var a,b,d,f;if(f=rd,null!==(a=h())){for(b=[],d=o(),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==d;)b.push(d),null===(d=o())&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(95===c.charCodeAt(rd)?(d="_",rd++):(d=null,0===sd&&e('"_"'))));null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return a}function ja(){var a,b,d,f,g;return f=rd,g=rd,91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null!==a?(b=ka(),null!==b?(93===c.charCodeAt(rd)?(d="]",rd++):(d=null,0===sd&&e('"]"')),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){return xd.host_type="IPv6",c.substring(rd,a)}(f)),null===a&&(rd=f),a}function ka(){var a,b,d,f,g,h,i,j,k,l,m,n,o,p,q,r;return p=rd,q=rd,a=la(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?(58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?(58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?(58===c.charCodeAt(rd)?(j=":",rd++):(j=null,0===sd&&e('":"')),null!==j?(k=la(),null!==k?(58===c.charCodeAt(rd)?(l=":",rd++):(l=null,0===sd&&e('":"')),null!==l?(m=la(),null!==m?(58===c.charCodeAt(rd)?(n=":",rd++):(n=null,0===sd&&e('":"')),null!==n?(o=ma(),null!==o?a=[a,b,d,f,g,h,i,j,k,l,m,n,o]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?(58===c.charCodeAt(rd)?(k=":",rd++):(k=null,0===sd&&e('":"')),null!==k?(l=la(),null!==l?(58===c.charCodeAt(rd)?(m=":",rd++):(m=null,0===sd&&e('":"')),null!==m?(n=ma(),null!==n?a=[a,b,d,f,g,h,i,j,k,l,m,n]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?(58===c.charCodeAt(rd)?(k=":",rd++):(k=null,0===sd&&e('":"')),null!==k?(l=ma(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=ma(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=ma(),null!==h?a=[a,b,d,f,g,h]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?(58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=ma(),null!==f?a=[a,b,d,f]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=ma(),null!==b?a=[a,b]:(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,"::"===c.substr(rd,2)?(a="::",rd+=2):(a=null,0===sd&&e('"::"')),null!==a?(b=la(),null!==b?a=[a,b]:(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?("::"===c.substr(rd,2)?(b="::",rd+=2):(b=null,0===sd&&e('"::"')),null!==b?(d=la(),null!==d?(58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?(58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?(58===c.charCodeAt(rd)?(j=":",rd++):(j=null,0===sd&&e('":"')),null!==j?(k=la(),null!==k?(58===c.charCodeAt(rd)?(l=":",rd++):(l=null,0===sd&&e('":"')),null!==l?(m=ma(),null!==m?a=[a,b,d,f,g,h,i,j,k,l,m]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?("::"===c.substr(rd,2)?(d="::",rd+=2):(d=null,0===sd&&e('"::"')),null!==d?(f=la(),null!==f?(58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?(58===c.charCodeAt(rd)?(k=":",rd++):(k=null,0===sd&&e('":"')),null!==k?(l=ma(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?("::"===c.substr(rd,2)?(f="::",rd+=2):(f=null,0===sd&&e('"::"')),null!==f?(g=la(),null!==g?(58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?(58===c.charCodeAt(rd)?(j=":",rd++):(j=null,0===sd&&e('":"')),null!==j?(k=ma(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?("::"===c.substr(rd,2)?(g="::",rd+=2):(g=null,0===sd&&e('"::"')),null!==g?(h=la(),null!==h?(58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=ma(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?(r=rd,58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?g=[g,h]:(g=null,rd=r)):(g=null,rd=r),g=null!==g?g:"",null!==g?("::"===c.substr(rd,2)?(h="::",rd+=2):(h=null,0===sd&&e('"::"')),null!==h?(i=ma(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?(r=rd,58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?g=[g,h]:(g=null,rd=r)):(g=null,rd=r),g=null!==g?g:"",null!==g?(r=rd,58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?h=[h,i]:(h=null,rd=r)):(h=null,rd=r),h=null!==h?h:"",null!==h?("::"===c.substr(rd,2)?(i="::",rd+=2):(i=null,0===sd&&e('"::"')),null!==i?(j=la(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q),null===a&&(q=rd,a=la(),null!==a?(r=rd,58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?b=[b,d]:(b=null,rd=r)):(b=null,rd=r),b=null!==b?b:"",null!==b?(r=rd,58===c.charCodeAt(rd)?(d=":",rd++):(d=null,0===sd&&e('":"')),null!==d?(f=la(),null!==f?d=[d,f]:(d=null,rd=r)):(d=null,rd=r),d=null!==d?d:"",null!==d?(r=rd,58===c.charCodeAt(rd)?(f=":",rd++):(f=null,0===sd&&e('":"')),null!==f?(g=la(),null!==g?f=[f,g]:(f=null,rd=r)):(f=null,rd=r),f=null!==f?f:"",null!==f?(r=rd,58===c.charCodeAt(rd)?(g=":",rd++):(g=null,0===sd&&e('":"')),null!==g?(h=la(),null!==h?g=[g,h]:(g=null,rd=r)):(g=null,rd=r),g=null!==g?g:"",null!==g?(r=rd,58===c.charCodeAt(rd)?(h=":",rd++):(h=null,0===sd&&e('":"')),null!==h?(i=la(),null!==i?h=[h,i]:(h=null,rd=r)):(h=null,rd=r),h=null!==h?h:"",null!==h?(r=rd,58===c.charCodeAt(rd)?(i=":",rd++):(i=null,0===sd&&e('":"')),null!==i?(j=la(),null!==j?i=[i,j]:(i=null,rd=r)):(i=null,rd=r),i=null!==i?i:"",null!==i?("::"===c.substr(rd,2)?(j="::",rd+=2):(j=null,0===sd&&e('"::"')),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q)):(a=null,rd=q))))))))))))))),null!==a&&(a=function(a){return xd.host_type="IPv6",c.substring(rd,a)}(p)),null===a&&(rd=p),a}function la(){var a,b,c,d,e;return e=rd,a=i(),null!==a?(b=i(),b=null!==b?b:"",null!==b?(c=i(),c=null!==c?c:"",null!==c?(d=i(),d=null!==d?d:"",null!==d?a=[a,b,c,d]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),a}function ma(){var a,b,d,f;return f=rd,a=la(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=la(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),null===a&&(a=na()),a}function na(){var a,b,d,f,g,h,i,j,k;return j=rd,k=rd,a=oa(),null!==a?(46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null!==b?(d=oa(),null!==d?(46===c.charCodeAt(rd)?(f=".",rd++):(f=null,0===sd&&e('"."')),null!==f?(g=oa(),null!==g?(46===c.charCodeAt(rd)?(h=".",rd++):(h=null,0===sd&&e('"."')),null!==h?(i=oa(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k)):(a=null,rd=k),null!==a&&(a=function(a){return xd.host_type="IPv4",c.substring(rd,a)}(j)),null===a&&(rd=j),a}function oa(){var a,b,d,f;return f=rd,"25"===c.substr(rd,2)?(a="25",rd+=2):(a=null,0===sd&&e('"25"')),null!==a?(/^[0-5]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[0-5]")),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null===a&&(f=rd,50===c.charCodeAt(rd)?(a="2",rd++):(a=null,0===sd&&e('"2"')),null!==a?(/^[0-4]/.test(c.charAt(rd))?(b=c.charAt(rd),rd++):(b=null,0===sd&&e("[0-4]")),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),null===a&&(f=rd,49===c.charCodeAt(rd)?(a="1",rd++):(a=null,0===sd&&e('"1"')),null!==a?(b=g(),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),null===a&&(f=rd,/^[1-9]/.test(c.charAt(rd))?(a=c.charAt(rd),rd++):(a=null,0===sd&&e("[1-9]")),null!==a?(b=g(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null===a&&(a=g())))),a}function pa(){var a,b,c,d,e,f,h;return f=rd,h=rd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h),null!==a&&(a=function(a,b){return b=parseInt(b.join("")),xd.port=b,b}(0,a)),null===a&&(rd=f),a}function qa(){var a,b,d,f;for(a=[],f=rd,59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null!==b?(d=ra(),null!==d?b=[b,d]:(b=null,rd=f)):(b=null,rd=f);null!==b;)a.push(b),f=rd,59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null!==b?(d=ra(),null!==d?b=[b,d]:(b=null,rd=f)):(b=null,rd=f);return a}function ra(){var a;return a=sa(),null===a&&null===(a=ta())&&null===(a=ua())&&null===(a=va())&&null===(a=wa())&&null===(a=xa())&&(a=ya()),a}function sa(){var a,b,d,f;return d=rd,f=rd,"transport="===c.substr(rd,10).toLowerCase()?(a=c.substr(rd,10),rd+=10):(a=null,0===sd&&e('"transport="')),null!==a?("udp"===c.substr(rd,3).toLowerCase()?(b=c.substr(rd,3),rd+=3):(b=null,0===sd&&e('"udp"')),null===b&&("tcp"===c.substr(rd,3).toLowerCase()?(b=c.substr(rd,3),rd+=3):(b=null,0===sd&&e('"tcp"')),null===b&&("sctp"===c.substr(rd,4).toLowerCase()?(b=c.substr(rd,4),rd+=4):(b=null,0===sd&&e('"sctp"')),null===b&&("tls"===c.substr(rd,3).toLowerCase()?(b=c.substr(rd,3),rd+=3):(b=null,0===sd&&e('"tls"')),null===b&&(b=B())))),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.transport=b.toLowerCase()}(0,a[1])),null===a&&(rd=d),a}function ta(){var a,b,d,f;return d=rd,f=rd,"user="===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"user="')),null!==a?("phone"===c.substr(rd,5).toLowerCase()?(b=c.substr(rd,5),rd+=5):(b=null,0===sd&&e('"phone"')),null===b&&("ip"===c.substr(rd,2).toLowerCase()?(b=c.substr(rd,2),rd+=2):(b=null,0===sd&&e('"ip"')),null===b&&(b=B())),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.user=b.toLowerCase()}(0,a[1])),null===a&&(rd=d),a}function ua(){var a,b,d,f;return d=rd,f=rd,"method="===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"method="')),null!==a?(b=jb(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.method=b}(0,a[1])),null===a&&(rd=d),a}function va(){var a,b,d,f;return d=rd,f=rd,"ttl="===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"ttl="')),null!==a?(b=Vc(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.params||(xd.params={}),xd.params.ttl=b}(0,a[1])),null===a&&(rd=d),a}function wa(){var a,b,d,f;return d=rd,f=rd,"maddr="===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"maddr="')),null!==a?(b=fa(),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),null!==a&&(a=function(a,b){xd.uri_params||(xd.uri_params={}),xd.uri_params.maddr=b}(0,a[1])),null===a&&(rd=d),a}function xa(){var a,b,d,f,g,h;return f=rd,g=rd,"lr"===c.substr(rd,2).toLowerCase()?(a=c.substr(rd,2),rd+=2):(a=null,0===sd&&e('"lr"')),null!==a?(h=rd,61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=B(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd.uri_params||(xd.uri_params={}),xd.uri_params.lr=void 0}()),null===a&&(rd=f),a}function ya(){var a,b,d,f,g,h;return f=rd,g=rd,a=za(),null!==a?(h=rd,61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=Aa(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b,c){xd.uri_params||(xd.uri_params={}),c=void 0===c?void 0:c[1],xd.uri_params[b.toLowerCase()]=c}(0,a[0],a[1])),null===a&&(rd=f),a}function za(){var a,b,c;if(c=rd,null!==(b=Ba()))for(a=[];null!==b;)a.push(b),b=Ba();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(0,a)),null===a&&(rd=c),a}function Aa(){var a,b,c;if(c=rd,null!==(b=Ba()))for(a=[];null!==b;)a.push(b),b=Ba();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(0,a)),null===a&&(rd=c),a}function Ba(){var a;return a=Ca(),null===a&&null===(a=q())&&(a=s()),a}function Ca(){var a;return 91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null===a&&(93===c.charCodeAt(rd)?(a="]",rd++):(a=null,0===sd&&e('"]"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')))))))),a}function Da(){var a,b,d,f,g,h,i;if(h=rd,63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null!==a)if(null!==(b=Ea())){for(d=[],i=rd,38===c.charCodeAt(rd)?(f="&",rd++):(f=null,0===sd&&e('"&"')),null!==f?(g=Ea(),null!==g?f=[f,g]:(f=null,rd=i)):(f=null,rd=i);null!==f;)d.push(f),i=rd,38===c.charCodeAt(rd)?(f="&",rd++):(f=null,0===sd&&e('"&"')),null!==f?(g=Ea(),null!==g?f=[f,g]:(f=null,rd=i)):(f=null,rd=i);null!==d?a=[a,b,d]:(a=null,rd=h)}else a=null,rd=h;else a=null,rd=h;return a}function Ea(){var a,b,d,f,g;return f=rd,g=rd,a=Fa(),null!==a?(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null!==b?(d=Ga(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b,c){b=b.join("").toLowerCase(),c=c.join(""),xd.uri_headers||(xd.uri_headers={}),xd.uri_headers[b]?xd.uri_headers[b].push(c):xd.uri_headers[b]=[c]}(0,a[0],a[2])),null===a&&(rd=f),a}function Fa(){var a,b;if(b=Ha(),null===b&&null===(b=q())&&(b=s()),null!==b)for(a=[];null!==b;)a.push(b),null===(b=Ha())&&null===(b=q())&&(b=s());else a=null;return a}function Ga(){var a,b;for(a=[],b=Ha(),null===b&&null===(b=q())&&(b=s());null!==b;)a.push(b),null===(b=Ha())&&null===(b=q())&&(b=s());return a}function Ha(){var a;return 91===c.charCodeAt(rd)?(a="[",rd++):(a=null,0===sd&&e('"["')),null===a&&(93===c.charCodeAt(rd)?(a="]",rd++):(a=null,0===sd&&e('"]"')),null===a&&(47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')))))))),a}function Ia(){var a;return a=kb(),null===a&&(a=Ja()),a}function Ja(){var a,b,c,d,e,f;return f=rd,a=jb(),null!==a?(b=m(),null!==b?(c=Ka(),null!==c?(d=m(),null!==d?(e=_a(),null!==e?a=[a,b,c,d,e]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Ka(){var a;return a=Y(),null===a&&(a=La()),a}function La(){var a,b,d,f;return f=rd,a=Wa(),null!==a?(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null!==b?(d=Ma(),null===d&&(d=Pa()),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Ma(){var a,b,d,f,g;return f=rd,a=Na(),null===a&&(a=Oa()),null!==a?(g=rd,63===c.charCodeAt(rd)?(b="?",rd++):(b=null,0===sd&&e('"?"')),null!==b?(d=$a(),null!==d?b=[b,d]:(b=null,rd=g)):(b=null,rd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),a}function Na(){var a,b,d,f;return f=rd,"//"===c.substr(rd,2)?(a="//",rd+=2):(a=null,0===sd&&e('"//"')),null!==a?(b=Xa(),null!==b?(d=Oa(),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Oa(){var a,b,d;return d=rd,47===c.charCodeAt(rd)?(a="/",rd++):(a=null,0===sd&&e('"/"')),null!==a?(b=Sa(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function Pa(){var a,b,c,d;if(d=rd,null!==(a=Ra())){for(b=[],c=Qa();null!==c;)b.push(c),c=Qa();null!==b?a=[a,b]:(a=null,rd=d)}else a=null,rd=d;return a}function Qa(){var a;return a=p(),null===a&&null===(a=q())&&(a=s()),a}function Ra(){var a;return a=q(),null===a&&null===(a=s())&&(59===c.charCodeAt(rd)?(a=";",rd++):(a=null,0===sd&&e('";"')),null===a&&(63===c.charCodeAt(rd)?(a="?",rd++):(a=null,0===sd&&e('"?"')),null===a&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","'))))))))))),a}function Sa(){var a,b,d,f,g,h;if(g=rd,null!==(a=Ta())){for(b=[],h=rd,47===c.charCodeAt(rd)?(d="/",rd++):(d=null,0===sd&&e('"/"')),null!==d?(f=Ta(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,47===c.charCodeAt(rd)?(d="/",rd++):(d=null,0===sd&&e('"/"')),null!==d?(f=Ta(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return a}function Ta(){var a,b,d,f,g,h;for(g=rd,a=[],b=Va();null!==b;)a.push(b),b=Va();if(null!==a){for(b=[],h=rd,59===c.charCodeAt(rd)?(d=";",rd++):(d=null,0===sd&&e('";"')),null!==d?(f=Ua(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,59===c.charCodeAt(rd)?(d=";",rd++):(d=null,0===sd&&e('";"')),null!==d?(f=Ua(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return a}function Ua(){var a,b;for(a=[],b=Va();null!==b;)a.push(b),b=Va();return a}function Va(){var a;return a=q(),null===a&&null===(a=s())&&(58===c.charCodeAt(rd)?(a=":",rd++):(a=null,0===sd&&e('":"')),null===a&&(64===c.charCodeAt(rd)?(a="@",rd++):(a=null,0===sd&&e('"@"')),null===a&&(38===c.charCodeAt(rd)?(a="&",rd++):(a=null,0===sd&&e('"&"')),null===a&&(61===c.charCodeAt(rd)?(a="=",rd++):(a=null,0===sd&&e('"="')),null===a&&(43===c.charCodeAt(rd)?(a="+",rd++):(a=null,0===sd&&e('"+"')),null===a&&(36===c.charCodeAt(rd)?(a="$",rd++):(a=null,0===sd&&e('"$"')),null===a&&(44===c.charCodeAt(rd)?(a=",",rd++):(a=null,0===sd&&e('","'))))))))),a}function Wa(){var a,b,d,f,i;if(f=rd,i=rd,null!==(a=h())){for(b=[],d=h(),null===d&&null===(d=g())&&(43===c.charCodeAt(rd)?(d="+",rd++):(d=null,0===sd&&e('"+"')),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')))));null!==d;)b.push(d),null===(d=h())&&null===(d=g())&&(43===c.charCodeAt(rd)?(d="+",rd++):(d=null,0===sd&&e('"+"')),null===d&&(45===c.charCodeAt(rd)?(d="-",rd++):(d=null,0===sd&&e('"-"')),null===d&&(46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')))));null!==b?a=[a,b]:(a=null,rd=i)}else a=null,rd=i;return null!==a&&(a=function(a){xd.scheme=c.substring(rd,a)}(f)),null===a&&(rd=f),a}function Xa(){var a;return a=Ya(),null===a&&(a=Za()),a}function Ya(){var a,b,d,f;return d=rd,f=rd,a=aa(),null!==a?(64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null!==b?a=[a,b]:(a=null,rd=f)):(a=null,rd=f),a=null!==a?a:"",null!==a?(b=ea(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a=null!==a?a:""}function Za(){var a,b;if(b=q(),null===b&&null===(b=s())&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')),null===b&&(59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null===b&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"')))))))))),null!==b)for(a=[];null!==b;)a.push(b),null===(b=q())&&null===(b=s())&&(36===c.charCodeAt(rd)?(b="$",rd++):(b=null,0===sd&&e('"$"')),null===b&&(44===c.charCodeAt(rd)?(b=",",rd++):(b=null,0===sd&&e('","')),null===b&&(59===c.charCodeAt(rd)?(b=";",rd++):(b=null,0===sd&&e('";"')),null===b&&(58===c.charCodeAt(rd)?(b=":",rd++):(b=null,0===sd&&e('":"')),null===b&&(64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null===b&&(38===c.charCodeAt(rd)?(b="&",rd++):(b=null,0===sd&&e('"&"')),null===b&&(61===c.charCodeAt(rd)?(b="=",rd++):(b=null,0===sd&&e('"="')),null===b&&(43===c.charCodeAt(rd)?(b="+",rd++):(b=null,0===sd&&e('"+"'))))))))));else a=null;return a}function $a(){var a,b;for(a=[],b=Qa();null!==b;)a.push(b),b=Qa();return a}function _a(){var a,b,d,f,h,i,j,k;if(j=rd,k=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"SIP"')),null!==a)if(47===c.charCodeAt(rd)?(b="/",rd++):(b=null,0===sd&&e('"/"')),null!==b){if(null!==(f=g()))for(d=[];null!==f;)d.push(f),f=g();else d=null;if(null!==d)if(46===c.charCodeAt(rd)?(f=".",rd++):(f=null,0===sd&&e('"."')),null!==f){if(null!==(i=g()))for(h=[];null!==i;)h.push(i),i=g();else h=null;null!==h?a=[a,b,d,f,h]:(a=null,rd=k)}else a=null,rd=k;else a=null,rd=k}else a=null,rd=k;else a=null,rd=k;return null!==a&&(a=function(a){xd.sip_version=c.substring(rd,a)}(j)),null===a&&(rd=j),a}function ab(){var a;return"INVITE"===c.substr(rd,6)?(a="INVITE",rd+=6):(a=null,0===sd&&e('"INVITE"')),a}function bb(){var a;return"ACK"===c.substr(rd,3)?(a="ACK",rd+=3):(a=null,0===sd&&e('"ACK"')),a}function cb(){var a;return"OPTIONS"===c.substr(rd,7)?(a="OPTIONS",rd+=7):(a=null,0===sd&&e('"OPTIONS"')),a}function db(){var a;return"BYE"===c.substr(rd,3)?(a="BYE",rd+=3):(a=null,0===sd&&e('"BYE"')),a}function eb(){var a;return"CANCEL"===c.substr(rd,6)?(a="CANCEL",rd+=6):(a=null,0===sd&&e('"CANCEL"')),a}function fb(){var a;return"REGISTER"===c.substr(rd,8)?(a="REGISTER",rd+=8):(a=null,0===sd&&e('"REGISTER"')),a}function gb(){var a;return"SUBSCRIBE"===c.substr(rd,9)?(a="SUBSCRIBE",rd+=9):(a=null,0===sd&&e('"SUBSCRIBE"')),a}function hb(){var a;return"NOTIFY"===c.substr(rd,6)?(a="NOTIFY",rd+=6):(a=null,0===sd&&e('"NOTIFY"')),a}function ib(){var a;return"REFER"===c.substr(rd,5)?(a="REFER",rd+=5):(a=null,0===sd&&e('"REFER"')),a}function jb(){var a,b;return b=rd,a=ab(),null===a&&null===(a=bb())&&null===(a=cb())&&null===(a=db())&&null===(a=eb())&&null===(a=fb())&&null===(a=gb())&&null===(a=hb())&&null===(a=ib())&&(a=B()),null!==a&&(a=function(a){return xd.method=c.substring(rd,a),xd.method}(b)),null===a&&(rd=b),a}function kb(){var a,b,c,d,e,f;return f=rd,a=_a(),null!==a?(b=m(),null!==b?(c=lb(),null!==c?(d=m(),null!==d?(e=nb(),null!==e?a=[a,b,c,d,e]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function lb(){var a,b;return b=rd,a=mb(),null!==a&&(a=function(a,b){xd.status_code=parseInt(b.join(""))}(0,a)),null===a&&(rd=b),a}function mb(){var a,b,c,d;return d=rd,a=g(),null!==a?(b=g(),null!==b?(c=g(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function nb(){var a,b,d;for(d=rd,a=[],b=p(),null===b&&null===(b=q())&&null===(b=s())&&null===(b=y())&&null===(b=z())&&null===(b=m())&&(b=n());null!==b;)a.push(b),null===(b=p())&&null===(b=q())&&null===(b=s())&&null===(b=y())&&null===(b=z())&&null===(b=m())&&(b=n());return null!==a&&(a=function(a){xd.reason_phrase=c.substring(rd,a)}(d)),null===a&&(rd=d),a}function ob(){var a,b,c,d,e,f;if(e=rd,null!==(a=Vb())){for(b=[],f=rd,c=M(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function pb(){var a,b,d,f,g,h;return f=rd,g=rd,a=E(),null!==a?(h=rd,64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd=c.substring(rd,a)}(f)),null===a&&(rd=f),a}function qb(){var a,b,c,d,e,f,g;if(e=rd,null===(a=F()))if(f=rd,null!==(a=rb())){for(b=[],g=rd,c=M(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=M(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b,c;for(c=xd.multi_header.length,b=0;b<c;b++)if(null===xd.multi_header[b].parsed){xd=null;break}xd=null!==xd?xd.multi_header:-1}()),null===a&&(rd=e),a}function rb(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=ub(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=ub(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b;xd.multi_header||(xd.multi_header=[]);try{b=new wd(xd.uri,xd.display_name,xd.params),delete xd.uri,delete xd.display_name,delete xd.params}catch(a){b=null}xd.multi_header.push({possition:rd,offset:a,parsed:b})}(e)),null===a&&(rd=e),a}function sb(){var a,b,c,d,e;return e=rd,a=tb(),a=null!==a?a:"",null!==a?(b=L(),null!==b?(c=Y(),null!==c?(d=K(),null!==d?a=[a,b,c,d]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),a}function tb(){var a,b,d,e,f,g,h;if(f=rd,g=rd,null!==(a=B())){for(b=[],h=rd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return null===a&&(a=T()),null!==a&&(a=function(a,b){b=c.substring(rd,a).trim(),'"'===b[0]&&(b=b.substring(1,b.length-1)),xd.display_name=b}(f,a)),null===a&&(rd=f),a}function ub(){var a;return a=vb(),null===a&&null===(a=wb())&&(a=zb()),a}function vb(){var a,b,d,f,g;return f=rd,g=rd,"q"===c.substr(rd,1).toLowerCase()?(a=c.substr(rd,1),rd++):(a=null,0===sd&&e('"q"')),null!==a?(b=H(),null!==b?(d=yb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.params||(xd.params={}),xd.params.q=b}(0,a[2])),null===a&&(rd=f),a}function wb(){var a,b,d,f,g;return f=rd,g=rd,"expires"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.params||(xd.params={}),xd.params.expires=b}(0,a[2])),null===a&&(rd=f),a}function xb(){var a,b,c;if(c=rd,null!==(b=g()))for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){return parseInt(b.join(""))}(0,a)),null===a&&(rd=c),a}function yb(){var a,b,d,f,h,i,j,k;return i=rd,j=rd,48===c.charCodeAt(rd)?(a="0",rd++):(a=null,0===sd&&e('"0"')),null!==a?(k=rd,46===c.charCodeAt(rd)?(b=".",rd++):(b=null,0===sd&&e('"."')),null!==b?(d=g(),d=null!==d?d:"",null!==d?(f=g(),f=null!==f?f:"",null!==f?(h=g(),h=null!==h?h:"",null!==h?b=[b,d,f,h]:(b=null,rd=k)):(b=null,rd=k)):(b=null,rd=k)):(b=null,rd=k),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=j)):(a=null,rd=j),null!==a&&(a=function(a){return parseFloat(c.substring(rd,a))}(i)),null===a&&(rd=i),a}function zb(){var a,b,c,d,e,f;return d=rd,e=rd,a=B(),null!==a?(f=rd,b=H(),null!==b?(c=Ab(),null!==c?b=[b,c]:(b=null,rd=f)):(b=null,rd=f),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=e)):(a=null,rd=e),null!==a&&(a=function(a,b,c){xd.params||(xd.params={}),c=void 0===c?void 0:c[1],xd.params[b.toLowerCase()]=c}(0,a[0],a[1])),null===a&&(rd=d),a}function Ab(){var a;return a=B(),null===a&&null===(a=fa())&&(a=T()),a}function Bb(){var a,b,c,d,e,f;if(e=rd,null!==(a=Cb())){for(b=[],f=rd,c=N(),null!==c?(d=Db(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=Db(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Cb(){var a;return"render"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"render"')),null===a&&("session"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"session"')),null===a&&("icon"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"icon"')),null===a&&("alert"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"alert"')),null===a&&(a=B())))),a}function Db(){var a;return a=Eb(),null===a&&(a=zb()),a}function Eb(){var a,b,d,f;return f=rd,"handling"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"handling"')),null!==a?(b=H(),null!==b?("optional"===c.substr(rd,8).toLowerCase()?(d=c.substr(rd,8),rd+=8):(d=null,0===sd&&e('"optional"')),null===d&&("required"===c.substr(rd,8).toLowerCase()?(d=c.substr(rd,8),rd+=8):(d=null,0===sd&&e('"required"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Fb(){var a,b,c,d,e,f;if(e=rd,null!==(a=B())){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Gb(){var a,b,c;if(c=rd,null!==(b=g()))for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){xd=parseInt(b.join(""))}(0,a)),null===a&&(rd=c),a}function Hb(){var a,b;return b=rd,a=Ib(),null!==a&&(a=function(a){xd=c.substring(rd,a)}(b)),null===a&&(rd=b),a}function Ib(){var a,b,c,d,e,f,g,h;if(g=rd,null!==(a=Jb()))if(null!==(b=G()))if(null!==(c=Ob())){for(d=[],h=rd,e=N(),null!==e?(f=Pb(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==e;)d.push(e),h=rd,e=N(),null!==e?(f=Pb(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==d?a=[a,b,c,d]:(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;else a=null,rd=g;return a}function Jb(){var a;return a=Kb(),null===a&&(a=Lb()),a}function Kb(){var a;return"text"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"text"')),null===a&&("image"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"image"')),null===a&&("audio"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"audio"')),null===a&&("video"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"video"')),null===a&&("application"===c.substr(rd,11).toLowerCase()?(a=c.substr(rd,11),rd+=11):(a=null,0===sd&&e('"application"')),null===a&&(a=Mb()))))),a}function Lb(){var a;return"message"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"message"')),null===a&&("multipart"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"multipart"')),null===a&&(a=Mb())),a}function Mb(){var a;return a=B(),null===a&&(a=Nb()),a}function Nb(){var a,b,d;return d=rd,"x-"===c.substr(rd,2).toLowerCase()?(a=c.substr(rd,2),rd+=2):(a=null,0===sd&&e('"x-"')),null!==a?(b=B(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function Ob(){var a;return a=Mb(),null===a&&(a=B()),a}function Pb(){var a,b,c,d;return d=rd,a=B(),null!==a?(b=H(),null!==b?(c=Qb(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function Qb(){var a;return a=B(),null===a&&(a=T()),a}function Rb(){var a,b,c,d;return d=rd,a=Sb(),null!==a?(b=t(),null!==b?(c=jb(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function Sb(){var a,b,c;if(c=rd,null!==(b=g()))for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){xd.value=parseInt(b.join(""))}(0,a)),null===a&&(rd=c),a}function Tb(){var a,b;return b=rd,a=xb(),null!==a&&(a=function(a,b){xd=b}(0,a)),null===a&&(rd=b),a}function Ub(){var a,b,c,d,e,f,g;if(e=rd,f=rd,null!==(a=Vb())){for(b=[],g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a,b){xd.event=b.join("").toLowerCase()}(0,a[0])),null===a&&(rd=e),a}function Vb(){var a,b,d,f,g,h;if(g=rd,null!==(a=C())){for(b=[],h=rd,46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==d;)b.push(d),h=rd,46===c.charCodeAt(rd)?(d=".",rd++):(d=null,0===sd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,rd=h)):(d=null,rd=h);null!==b?a=[a,b]:(a=null,rd=g)}else a=null,rd=g;return a}function Wb(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=Xb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=Xb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b=xd.tag;try{xd=new wd(xd.uri,xd.display_name,xd.params),b&&xd.setParam("tag",b)}catch(a){xd=-1}}()),null===a&&(rd=e),a}function Xb(){var a;return a=Yb(),null===a&&(a=zb()),a}function Yb(){var a,b,d,f,g;return f=rd,g=rd,"tag"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.tag=b}(0,a[2])),null===a&&(rd=f),a}function Zb(){var a,b,c;if(c=rd,null!==(b=g()))for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){xd=parseInt(b.join(""))}(0,a)),null===a&&(rd=c),a}function $b(){var a,b;return b=rd,a=xb(),null!==a&&(a=function(a,b){xd=b}(0,a)),null===a&&(rd=b),a}function _b(){var a,b,c,d,e,f,g,h,i,j;for(h=rd,i=rd,a=[],b=tb();null!==b;)a.push(b),b=tb();if(null!==a)if(null!==(b=L()))if(null!==(c=Y()))if(null!==(d=K())){for(e=[],j=rd,f=N(),null!==f?(g=zb(),null!==g?f=[f,g]:(f=null,rd=j)):(f=null,rd=j);null!==f;)e.push(f),j=rd,f=N(),null!==f?(g=zb(),null!==g?f=[f,g]:(f=null,rd=j)):(f=null,rd=j);null!==e?a=[a,b,c,d,e]:(a=null,rd=i)}else a=null,rd=i;else a=null,rd=i;else a=null,rd=i;else a=null,rd=i;return null!==a&&(a=function(a){try{xd=new wd(xd.uri,xd.display_name,xd.params)}catch(a){xd=-1}}()),null===a&&(rd=h),a}function ac(){return bc()}function bc(){var a,b,d,f,g,h,i,j;if(i=rd,"digest"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"Digest"')),null!==a)if(null!==(b=t()))if(null!==(d=ec())){for(f=[],j=rd,g=M(),null!==g?(h=ec(),null!==h?g=[g,h]:(g=null,rd=j)):(g=null,rd=j);null!==g;)f.push(g),j=rd,g=M(),null!==g?(h=ec(),null!==h?g=[g,h]:(g=null,rd=j)):(g=null,rd=j);null!==f?a=[a,b,d,f]:(a=null,rd=i)}else a=null,rd=i;else a=null,rd=i;else a=null,rd=i;return null===a&&(a=cc()),a}function cc(){var a,b,c,d,e,f,g,h;if(g=rd,null!==(a=B()))if(null!==(b=t()))if(null!==(c=dc())){for(d=[],h=rd,e=M(),null!==e?(f=dc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==e;)d.push(e),h=rd,e=M(),null!==e?(f=dc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==d?a=[a,b,c,d]:(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;else a=null,rd=g;return a}function dc(){var a,b,c,d;return d=rd,a=B(),null!==a?(b=H(),null!==b?(c=B(),null===c&&(c=T()),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function ec(){var a;return a=fc(),null===a&&null===(a=hc())&&null===(a=jc())&&null===(a=lc())&&null===(a=mc())&&null===(a=nc())&&null===(a=oc())&&(a=dc()),a}function fc(){var a,b,d,f;return f=rd,"realm"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"realm"')),null!==a?(b=H(),null!==b?(d=gc(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function gc(){var a,b;return b=rd,a=U(),null!==a&&(a=function(a,b){xd.realm=b}(0,a)),null===a&&(rd=b),a}function hc(){var a,b,d,f,g,h,i,j,k;if(j=rd,"domain"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"domain"')),null!==a)if(null!==(b=H()))if(null!==(d=P()))if(null!==(f=ic())){if(g=[],k=rd,null!==(i=m()))for(h=[];null!==i;)h.push(i),i=m();else h=null;for(null!==h?(i=ic(),null!==i?h=[h,i]:(h=null,rd=k)):(h=null,rd=k);null!==h;){if(g.push(h),k=rd,null!==(i=m()))for(h=[];null!==i;)h.push(i),i=m();else h=null;null!==h?(i=ic(),null!==i?h=[h,i]:(h=null,rd=k)):(h=null,rd=k)}null!==g?(h=Q(),null!==h?a=[a,b,d,f,g,h]:(a=null,rd=j)):(a=null,rd=j)}else a=null,rd=j;else a=null,rd=j;else a=null,rd=j;else a=null,rd=j;return a}function ic(){var a;return a=La(),null===a&&(a=Oa()),a}function jc(){var a,b,d,f;return f=rd,"nonce"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"nonce"')),null!==a?(b=H(),null!==b?(d=kc(),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function kc(){var a,b;return b=rd,a=U(),null!==a&&(a=function(a,b){xd.nonce=b}(0,a)),null===a&&(rd=b),a}function lc(){var a,b,d,f,g;return f=rd,g=rd,"opaque"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"opaque"')),null!==a?(b=H(),null!==b?(d=U(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.opaque=b}(0,a[2])),null===a&&(rd=f),a}function mc(){var a,b,d,f,g;return f=rd,"stale"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"stale"')),null!==a?(b=H(),null!==b?(g=rd,"true"===c.substr(rd,4).toLowerCase()?(d=c.substr(rd,4),rd+=4):(d=null,0===sd&&e('"true"')),null!==d&&(d=function(a){xd.stale=!0}()),null===d&&(rd=g),null===d&&(g=rd,"false"===c.substr(rd,5).toLowerCase()?(d=c.substr(rd,5),rd+=5):(d=null,0===sd&&e('"false"')),null!==d&&(d=function(a){xd.stale=!1}()),null===d&&(rd=g)),null!==d?a=[a,b,d]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function nc(){var a,b,d,f,g;return f=rd,g=rd,"algorithm"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"algorithm"')),null!==a?(b=H(),null!==b?("md5"===c.substr(rd,3).toLowerCase()?(d=c.substr(rd,3),rd+=3):(d=null,0===sd&&e('"MD5"')),null===d&&("md5-sess"===c.substr(rd,8).toLowerCase()?(d=c.substr(rd,8),rd+=8):(d=null,0===sd&&e('"MD5-sess"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.algorithm=b.toUpperCase()}(0,a[2])),null===a&&(rd=f),a}function oc(){var a,b,d,f,g,h,i,j,k,l;if(j=rd,"qop"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"qop"')),null!==a)if(null!==(b=H()))if(null!==(d=P())){if(k=rd,null!==(f=pc())){for(g=[],l=rd,44===c.charCodeAt(rd)?(h=",",rd++):(h=null,0===sd&&e('","')),null!==h?(i=pc(),null!==i?h=[h,i]:(h=null,rd=l)):(h=null,rd=l);null!==h;)g.push(h),l=rd,44===c.charCodeAt(rd)?(h=",",rd++):(h=null,0===sd&&e('","')),null!==h?(i=pc(),null!==i?h=[h,i]:(h=null,rd=l)):(h=null,rd=l);null!==g?f=[f,g]:(f=null,rd=k)}else f=null,rd=k;null!==f?(g=Q(),null!==g?a=[a,b,d,f,g]:(a=null,rd=j)):(a=null,rd=j)}else a=null,rd=j;else a=null,rd=j;else a=null,rd=j;return a}function pc(){var a,b;return b=rd,"auth-int"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"auth-int"')),null===a&&("auth"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"auth"')),null===a&&(a=B())),null!==a&&(a=function(a,b){xd.qop||(xd.qop=[]),xd.qop.push(b.toLowerCase())}(0,a)),null===a&&(rd=b),a}function qc(){var a,b,c,d,e,f;if(e=rd,null!==(a=B())){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function rc(){var a,b,c,d,e,f,g;if(e=rd,f=rd,null!==(a=sc())){for(b=[],g=rd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b,c;for(c=xd.multi_header.length,b=0;b<c;b++)if(null===xd.multi_header[b].parsed){xd=null;break}xd=null!==xd?xd.multi_header:-1}()),null===a&&(rd=e),a}function sc(){var a,b,c,d,e,f,g;if(e=rd,f=rd,null!==(a=sb())){for(b=[],g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b;xd.multi_header||(xd.multi_header=[]);try{b=new wd(xd.uri,xd.display_name,xd.params),delete xd.uri,delete xd.display_name,delete xd.params}catch(a){b=null}xd.multi_header.push({possition:rd,offset:a,parsed:b})}(e)),null===a&&(rd=e),a}function tc(){var a,b,d,f,g,h,i;if(g=rd,h=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"SIP"')),null===a&&(a=B()),null!==a){for(b=[],i=rd,d=N(),null!==d?(f=uc(),null!==f?d=[d,f]:(d=null,rd=i)):(d=null,rd=i);null!==d;)b.push(d),i=rd,d=N(),null!==d?(f=uc(),null!==f?d=[d,f]:(d=null,rd=i)):(d=null,rd=i);null!==b?a=[a,b]:(a=null,rd=h)}else a=null,rd=h;return null!==a&&(a=function(a,b){if(xd.protocol=b.toLowerCase(),xd.params||(xd.params={}),xd.params.text&&'"'===xd.params.text[0]){var c=xd.params.text;xd.text=c.substring(1,c.length-1),delete xd.params.text}}(0,a[0])),null===a&&(rd=g),a}function uc(){var a;return a=vc(),null===a&&(a=zb()),a}function vc(){var a,b,d,f,h,i;if(h=rd,i=rd,"cause"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"cause"')),null!==a)if(null!==(b=H())){if(null!==(f=g()))for(d=[];null!==f;)d.push(f),f=g();else d=null;null!==d?a=[a,b,d]:(a=null,rd=i)}else a=null,rd=i;else a=null,rd=i;return null!==a&&(a=function(a,b){xd.cause=parseInt(b.join(""))}(0,a[2])),null===a&&(rd=h),a}function wc(){var a,b,c,d,e,f;if(e=rd,null!==(a=B())){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function xc(){var a,b,c,d,e,f;if(e=rd,null!==(a=yc())){for(b=[],f=rd,c=M(),null!==c?(d=yc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=yc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function yc(){var a,b,c,d,e,f;if(e=rd,null!==(a=sb())){for(b=[],f=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function zc(){var a,b,c,d,e,f;if(e=rd,null!==(a=Ac())){for(b=[],f=rd,c=N(),null!==c?(d=Bc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=Bc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Ac(){var a,b;return b=rd,"active"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"active"')),null===a&&("pending"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"pending"')),null===a&&("terminated"===c.substr(rd,10).toLowerCase()?(a=c.substr(rd,10),rd+=10):(a=null,0===sd&&e('"terminated"')),null===a&&(a=B()))),null!==a&&(a=function(a){xd.state=c.substring(rd,a)}(b)),null===a&&(rd=b),a}function Bc(){var a,b,d,f,g;return f=rd,g=rd,"reason"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"reason"')),null!==a?(b=H(),null!==b?(d=Cc(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){void 0!==b&&(xd.reason=b)}(0,a[2])),null===a&&(rd=f),null===a&&(f=rd,g=rd,"expires"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){void 0!==b&&(xd.expires=b)}(0,a[2])),null===a&&(rd=f),null===a&&(f=rd,g=rd,"retry_after"===c.substr(rd,11).toLowerCase()?(a=c.substr(rd,11),rd+=11):(a=null,0===sd&&e('"retry_after"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){void 0!==b&&(xd.retry_after=b)}(0,a[2])),null===a&&(rd=f),null===a&&(a=zb()))),a}function Cc(){var a;return"deactivated"===c.substr(rd,11).toLowerCase()?(a=c.substr(rd,11),rd+=11):(a=null,0===sd&&e('"deactivated"')),null===a&&("probation"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"probation"')),null===a&&("rejected"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"rejected"')),null===a&&("timeout"===c.substr(rd,7).toLowerCase()?(a=c.substr(rd,7),rd+=7):(a=null,0===sd&&e('"timeout"')),null===a&&("giveup"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"giveup"')),null===a&&("noresource"===c.substr(rd,10).toLowerCase()?(a=c.substr(rd,10),rd+=10):(a=null,0===sd&&e('"noresource"')),null===a&&("invariant"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"invariant"')),null===a&&(a=B()))))))),a}function Dc(){var a;return a=w(),a=null!==a?a:""}function Ec(){var a,b,c,d,e,f;if(e=rd,null!==(a=B())){for(b=[],f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a=null!==a?a:""}function Fc(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=Gc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=Gc(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){var b=xd.tag;try{xd=new wd(xd.uri,xd.display_name,xd.params),b&&xd.setParam("tag",b)}catch(a){xd=-1}}()),null===a&&(rd=e),a}function Gc(){var a;return a=Yb(),null===a&&(a=zb()),a}function Hc(){var a,b,c,d,e,f;if(e=rd,null!==(a=Ic())){for(b=[],f=rd,c=M(),null!==c?(d=Ic(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=M(),null!==c?(d=Ic(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Ic(){var a,b,c,d,e,f,g,h;if(g=rd,null!==(a=Pc()))if(null!==(b=t()))if(null!==(c=Sc())){for(d=[],h=rd,e=N(),null!==e?(f=Jc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==e;)d.push(e),h=rd,e=N(),null!==e?(f=Jc(),null!==f?e=[e,f]:(e=null,rd=h)):(e=null,rd=h);null!==d?a=[a,b,c,d]:(a=null,rd=g)}else a=null,rd=g;else a=null,rd=g;else a=null,rd=g;return a}function Jc(){var a;return a=Kc(),null===a&&null===(a=Lc())&&null===(a=Mc())&&null===(a=Nc())&&null===(a=Oc())&&(a=zb()),a}function Kc(){var a,b,d,f,g;return f=rd,g=rd,"ttl"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"ttl"')),null!==a?(b=H(),null!==b?(d=Vc(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.ttl=b}(0,a[2])),null===a&&(rd=f),a}function Lc(){var a,b,d,f,g;return f=rd,g=rd,"maddr"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"maddr"')),null!==a?(b=H(),null!==b?(d=fa(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.maddr=b}(0,a[2])),null===a&&(rd=f),a}function Mc(){var a,b,d,f,g;return f=rd,g=rd,"received"===c.substr(rd,8).toLowerCase()?(a=c.substr(rd,8),rd+=8):(a=null,0===sd&&e('"received"')),null!==a?(b=H(),null!==b?(d=na(),null===d&&(d=ka()),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.received=b}(0,a[2])),null===a&&(rd=f),a}function Nc(){var a,b,d,f,g;return f=rd,g=rd,"branch"===c.substr(rd,6).toLowerCase()?(a=c.substr(rd,6),rd+=6):(a=null,0===sd&&e('"branch"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.branch=b}(0,a[2])),null===a&&(rd=f),a}function Oc(){var a,b,d,f,h,i,j;if(h=rd,i=rd,"rport"===c.substr(rd,5).toLowerCase()?(a=c.substr(rd,5),rd+=5):(a=null,0===sd&&e('"rport"')),null!==a){if(j=rd,null!==(b=H())){for(d=[],f=g();null!==f;)d.push(f),f=g();null!==d?b=[b,d]:(b=null,rd=j)}else b=null,rd=j;b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=i)}else a=null,rd=i;return null!==a&&(a=function(a){"undefined"!=typeof response_port&&(xd.rport=response_port.join(""))}()),null===a&&(rd=h),a}function Pc(){var a,b,c,d,e,f;return f=rd,a=Qc(),null!==a?(b=G(),null!==b?(c=B(),null!==c?(d=G(),null!==d?(e=Rc(),null!==e?a=[a,b,c,d,e]:(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f)):(a=null,rd=f),a}function Qc(){var a,b;return b=rd,"sip"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"SIP"')),null===a&&(a=B()),null!==a&&(a=function(a,b){xd.protocol=b}(0,a)),null===a&&(rd=b),a}function Rc(){var a,b;return b=rd,"udp"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"UDP"')),null===a&&("tcp"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"TCP"')),null===a&&("tls"===c.substr(rd,3).toLowerCase()?(a=c.substr(rd,3),rd+=3):(a=null,0===sd&&e('"TLS"')),null===a&&("sctp"===c.substr(rd,4).toLowerCase()?(a=c.substr(rd,4),rd+=4):(a=null,0===sd&&e('"SCTP"')),null===a&&(a=B())))),null!==a&&(a=function(a,b){xd.transport=b}(0,a)),null===a&&(rd=b),a}function Sc(){var a,b,c,d,e;return d=rd,a=Tc(),null!==a?(e=rd,b=O(),null!==b?(c=Uc(),null!==c?b=[b,c]:(b=null,rd=e)):(b=null,rd=e),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function Tc(){var a,b;return b=rd,a=na(),null===a&&null===(a=ja())&&(a=ga()),null!==a&&(a=function(a){xd.host=c.substring(rd,a)}(b)),null===a&&(rd=b),a}function Uc(){var a,b,c,d,e,f,h;return f=rd,h=rd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h)):(a=null,rd=h),null!==a&&(a=function(a,b){xd.port=parseInt(b.join(""))}(0,a)),null===a&&(rd=f),a}function Vc(){var a,b,c,d,e;return d=rd,e=rd,a=g(),null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),null!==a&&(a=function(a,b){return parseInt(b.join(""))}(0,a)),null===a&&(rd=d),a}function Wc(){return bc()}function Xc(){var a,b,c,d,e,f;if(e=rd,null!==(a=Yc())){for(b=[],f=rd,c=N(),null!==c?(d=Zc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=Zc(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function Yc(){var a,b;return b=rd,a=xb(),null!==a&&(a=function(a,b){xd.expires=b}(0,a)),null===a&&(rd=b),a}function Zc(){var a;return a=$c(),null===a&&(a=zb()),a}function $c(){var a,b,d,f,g;return f=rd,g=rd,"refresher"===c.substr(rd,9).toLowerCase()?(a=c.substr(rd,9),rd+=9):(a=null,0===sd&&e('"refresher"')),null!==a?(b=H(),null!==b?("uac"===c.substr(rd,3).toLowerCase()?(d=c.substr(rd,3),rd+=3):(d=null,0===sd&&e('"uac"')),null===d&&("uas"===c.substr(rd,3).toLowerCase()?(d=c.substr(rd,3),rd+=3):(d=null,0===sd&&e('"uas"'))),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.refresher=b.toLowerCase()}(0,a[2])),null===a&&(rd=f),a}function _c(){var a,b,c,d;return d=rd,a=B(),null!==a?(b=v(),null!==b?(c=ad(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function ad(){var a,b;for(a=[],b=x(),null===b&&null===(b=z())&&(b=t());null!==b;)a.push(b),null===(b=x())&&null===(b=z())&&(b=t());return a}function bd(){var a,b;for(a=[],b=k();null!==b;)a.push(b),b=k();return a}function cd(){var a,b,d;return d=rd,"uuid:"===c.substr(rd,5)?(a="uuid:",rd+=5):(a=null,0===sd&&e('"uuid:"')),null!==a?(b=dd(),null!==b?a=[a,b]:(a=null,rd=d)):(a=null,rd=d),a}function dd(){var a,b,d,f,g,h,i,j,k,l,m;return l=rd,m=rd,a=fd(),null!==a?(45===c.charCodeAt(rd)?(b="-",rd++):(b=null,0===sd&&e('"-"')),null!==b?(d=ed(),null!==d?(45===c.charCodeAt(rd)?(f="-",rd++):(f=null,0===sd&&e('"-"')),null!==f?(g=ed(),null!==g?(45===c.charCodeAt(rd)?(h="-",rd++):(h=null,0===sd&&e('"-"')),null!==h?(i=ed(),null!==i?(45===c.charCodeAt(rd)?(j="-",rd++):(j=null,0===sd&&e('"-"')),null!==j?(k=gd(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m)):(a=null,rd=m),null!==a&&(a=function(a,b){xd=c.substring(rd+5,a)}(l,a[0])),null===a&&(rd=l),a}function ed(){var a,b,c,d,e;return e=rd,a=i(),null!==a?(b=i(),null!==b?(c=i(),null!==c?(d=i(),null!==d?a=[a,b,c,d]:(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e)):(a=null,rd=e),a}function fd(){var a,b,c;return c=rd,a=ed(),null!==a?(b=ed(),null!==b?a=[a,b]:(a=null,rd=c)):(a=null,rd=c),a}function gd(){var a,b,c,d;return d=rd,a=ed(),null!==a?(b=ed(),null!==b?(c=ed(),null!==c?a=[a,b,c]:(a=null,rd=d)):(a=null,rd=d)):(a=null,rd=d),a}function hd(){var a,b,c,d,e,f,g;if(e=rd,f=rd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==c;)b.push(c),g=rd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,rd=g)):(c=null,rd=g);null!==b?a=[a,b]:(a=null,rd=f)}else a=null,rd=f;return null!==a&&(a=function(a){try{xd=new wd(xd.uri,xd.display_name,xd.params)}catch(a){xd=-1}}()),null===a&&(rd=e),a}function id(){var a,b,c,d,e,f;if(e=rd,null!==(a=jd())){for(b=[],f=rd,c=N(),null!==c?(d=kd(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==c;)b.push(c),f=rd,c=N(),null!==c?(d=kd(),null!==d?c=[c,d]:(c=null,rd=f)):(c=null,rd=f);null!==b?a=[a,b]:(a=null,rd=e)}else a=null,rd=e;return a}function jd(){var a,b,d,f,g,h;return f=rd,g=rd,a=E(),null!==a?(h=rd,64===c.charCodeAt(rd)?(b="@",rd++):(b=null,0===sd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,rd=h)):(b=null,rd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a){xd.call_id=c.substring(rd,a)}(f)),null===a&&(rd=f),a}function kd(){var a;return a=ld(),null===a&&null===(a=md())&&null===(a=nd())&&(a=zb()),a}function ld(){var a,b,d,f,g;return f=rd,g=rd,"to-tag"===c.substr(rd,6)?(a="to-tag",rd+=6):(a=null,0===sd&&e('"to-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.to_tag=b}(0,a[2])),null===a&&(rd=f),a}function md(){var a,b,d,f,g;return f=rd,g=rd,"from-tag"===c.substr(rd,8)?(a="from-tag",rd+=8):(a=null,0===sd&&e('"from-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,rd=g)):(a=null,rd=g)):(a=null,rd=g),null!==a&&(a=function(a,b){xd.from_tag=b}(0,a[2])),null===a&&(rd=f),a}function nd(){var a,b;return b=rd,"early-only"===c.substr(rd,10)?(a="early-only",rd+=10):(a=null,0===sd&&e('"early-only"')),null!==a&&(a=function(a){xd.early_only=!0}()),null===a&&(rd=b),a}function od(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function pd(){for(var a=1,b=1,d=!1,e=0;e<Math.max(rd,td);e++){var f=c.charAt(e);"\n"===f?(d||a++,b=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,b=1,d=!0):(b++,d=!1)}return{line:a,column:b}}var qd={CRLF:f,DIGIT:g,ALPHA:h,HEXDIG:i,WSP:j,OCTET:k,DQUOTE:l,SP:m,HTAB:n,alphanum:o,reserved:p,unreserved:q,mark:r,escaped:s,LWS:t,SWS:u,HCOLON:v,TEXT_UTF8_TRIM:w,TEXT_UTF8char:x,UTF8_NONASCII:y,UTF8_CONT:z,LHEX:A,token:B,token_nodot:C,separators:D,word:E,STAR:F,SLASH:G,EQUAL:H,LPAREN:I,RPAREN:J,RAQUOT:K,LAQUOT:L,COMMA:M,SEMI:N,COLON:O,LDQUOT:P,RDQUOT:Q,comment:R,ctext:S,quoted_string:T,quoted_string_clean:U,qdtext:V,quoted_pair:W,SIP_URI_noparams:X,SIP_URI:Y,uri_scheme:Z,uri_scheme_sips:$,uri_scheme_sip:_,userinfo:aa,user:ba,user_unreserved:ca,password:da,hostport:ea,host:fa,hostname:ga,domainlabel:ha,toplabel:ia,IPv6reference:ja,IPv6address:ka,h16:la,ls32:ma,IPv4address:na,dec_octet:oa,port:pa,uri_parameters:qa,uri_parameter:ra,transport_param:sa,user_param:ta,method_param:ua,ttl_param:va,maddr_param:wa,lr_param:xa,other_param:ya,pname:za,pvalue:Aa,paramchar:Ba,param_unreserved:Ca,headers:Da,header:Ea,hname:Fa,hvalue:Ga,hnv_unreserved:Ha,Request_Response:Ia,Request_Line:Ja,Request_URI:Ka,absoluteURI:La,hier_part:Ma,net_path:Na,abs_path:Oa,opaque_part:Pa,uric:Qa,uric_no_slash:Ra,path_segments:Sa,segment:Ta,param:Ua,pchar:Va,scheme:Wa,authority:Xa,srvr:Ya,reg_name:Za,query:$a,SIP_Version:_a,INVITEm:ab,ACKm:bb,OPTIONSm:cb,BYEm:db,CANCELm:eb,REGISTERm:fb,SUBSCRIBEm:gb,NOTIFYm:hb,REFERm:ib,Method:jb,Status_Line:kb,Status_Code:lb,extension_code:mb,Reason_Phrase:nb,Allow_Events:ob,Call_ID:pb,Contact:qb,contact_param:rb,name_addr:sb,display_name:tb,contact_params:ub,c_p_q:vb,c_p_expires:wb,delta_seconds:xb,qvalue:yb,generic_param:zb,gen_value:Ab,Content_Disposition:Bb,disp_type:Cb,disp_param:Db,handling_param:Eb,Content_Encoding:Fb,Content_Length:Gb,Content_Type:Hb,media_type:Ib,m_type:Jb,discrete_type:Kb,composite_type:Lb,extension_token:Mb,x_token:Nb,m_subtype:Ob,m_parameter:Pb,m_value:Qb,CSeq:Rb,CSeq_value:Sb,Expires:Tb,Event:Ub,event_type:Vb,From:Wb,from_param:Xb,tag_param:Yb,Max_Forwards:Zb,Min_Expires:$b,Name_Addr_Header:_b,Proxy_Authenticate:ac,challenge:bc,other_challenge:cc,auth_param:dc,digest_cln:ec,realm:fc,realm_value:gc,domain:hc,URI:ic,nonce:jc,nonce_value:kc,opaque:lc,stale:mc,algorithm:nc,qop_options:oc,qop_value:pc,Proxy_Require:qc,Record_Route:rc,rec_route:sc,Reason:tc,reason_param:uc,reason_cause:vc,Require:wc,Route:xc,route_param:yc,Subscription_State:zc,substate_value:Ac,subexp_params:Bc,event_reason_value:Cc,Subject:Dc,Supported:Ec,To:Fc,to_param:Gc,Via:Hc,via_param:Ic,via_params:Jc,via_ttl:Kc,via_maddr:Lc,via_received:Mc,via_branch:Nc,response_port:Oc,sent_protocol:Pc,protocol_name:Qc,transport:Rc,sent_by:Sc,via_host:Tc,via_port:Uc,ttl:Vc,WWW_Authenticate:Wc,Session_Expires:Xc,s_e_expires:Yc,s_e_params:Zc,s_e_refresher:$c,extension_header:_c,header_value:ad,message_body:bd,uuid_URI:cd,uuid:dd,hex4:ed,hex8:fd,hex12:gd,Refer_To:hd,Replaces:id,call_id:jd,replaces_param:kd,to_tag:ld,from_tag:md,early_flag:nd};if(void 0!==d){if(void 0===qd[d])throw new Error("Invalid rule name: "+b(d)+".")}else d="CRLF";var rd=0,sd=0,td=0,ud=[],vd=a("./URI"),wd=a("./NameAddrHeader"),xd={};if(null===qd[d]()||rd!==c.length){var yd=Math.max(rd,td),zd=yd<c.length?c.charAt(yd):null,Ad=pd();return new this.SyntaxError(od(ud),zd,yd,Ad.line,Ad.column),-1}return xd},toSource:function(){return this._source}};return c.SyntaxError=function(a,c,d,e,f){function g(a,c){var d,e;switch(a.length){case 0:d="end of input";break;case 1:d=a[0];break;default:d=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}return e=c?b(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=a,this.found=c,this.message=g(a,c),this.offset=d,this.line=e,this.column=f},c.SyntaxError.prototype=Error.prototype,c}()},{"./NameAddrHeader":9,"./URI":25}],7:[function(a,b,c){var d=a("debug")("JsSIP"),e=a("webrtc-adapter"),f=a("../package.json");d("version %s",f.version);var g=a("./Constants"),h=a("./Exceptions"),i=a("./Utils"),j=a("./UA"),k=a("./URI"),l=a("./NameAddrHeader"),m=a("./Grammar"),n=a("./WebSocketInterface"),o=b.exports={C:g,Exceptions:h,Utils:i,UA:j,URI:k,NameAddrHeader:l,WebSocketInterface:n,Grammar:m,debug:a("debug"),adapter:e};Object.defineProperties(o,{name:{get:function(){return f.title}},version:{get:function(){return f.version}}})},{"../package.json":51,"./Constants":1,"./Exceptions":5,"./Grammar":6,"./NameAddrHeader":9,"./UA":24,"./URI":25,"./Utils":26,"./WebSocketInterface":27,debug:35,"webrtc-adapter":42}],8:[function(a,b,c){function d(a){this.ua=a,this.data={},f.EventEmitter.call(this)}b.exports=d;var e=a("util"),f=a("events"),g=a("./Constants"),h=a("./SIPMessage"),i=a("./Utils"),j=a("./RequestSender"),k=a("./Transactions"),l=a("./Exceptions");e.inherits(d,f.EventEmitter),d.prototype.send=function(a,b,c){var d,e,f,i,k,l=a;if(void 0===a||void 0===b)throw new TypeError("Not enough arguments");if(!(a=this.ua.normalizeTarget(a)))throw new TypeError("Invalid target: "+l);c=c||{},k=c.extraHeaders&&c.extraHeaders.slice()||[],i=c.eventHandlers||{},f=c.contentType||"text/plain",this.content_type=f;for(e in i)this.on(e,i[e]);this.closed=!1,this.ua.applicants[this]=this,k.push("Content-Type: "+f),this.request=new h.OutgoingRequest(g.MESSAGE,a,this.ua,null,k),b?(this.request.body=b,this.content=b):this.content=null,d=new j(this,this.ua),this.newMessage("local",this.request),d.send()},d.prototype.receiveResponse=function(a){var b;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:a});break;default:delete this.ua.applicants[this],b=i.sipErrorCause(a.status_code),this.emit("failed",{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:g.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:g.causes.CONNECTION_ERROR})},d.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},d.prototype.init_incoming=function(a){var b;this.request=a,this.content_type=a.getHeader("Content-Type"),a.body?this.content=a.body:this.content=null,this.newMessage("remote",a),!(b=this.ua.transactions.nist[a.via_branch])||b.state!==k.C.STATUS_TRYING&&b.state!==k.C.STATUS_PROCEEDING||a.reply(200)},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders&&a.extraHeaders.slice()||[],c=a.body;if("incoming"!==this.direction)throw new l.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,b,c)},d.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders&&a.extraHeaders.slice()||[],e=a.body;if("incoming"!==this.direction)throw new l.NotSupportedError('"reject" not supported for outgoing Message');if(b<300||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e)},d.prototype.newMessage=function(a,b){"remote"===a?(this.direction="incoming",this.local_identity=b.to,this.remote_identity=b.from):"local"===a&&(this.direction="outgoing",this.local_identity=b.from,this.remote_identity=b.to),this.ua.newMessage({originator:a,message:this,request:b})}},{"./Constants":1,"./Exceptions":5,"./RequestSender":18,"./SIPMessage":19,"./Transactions":22,"./Utils":26,events:29,util:33}],9:[function(a,b,c){function d(a,b,c){var d;if(!(a&&a instanceof e))throw new TypeError('missing or invalid "uri" parameter');this.uri=a,this.parameters={};for(d in c)this.setParam(d,c[d]);Object.defineProperties(this,{display_name:{get:function(){return b},set:function(a){b=0===a?"0":a}}})}b.exports=d;var e=a("./URI"),f=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]=void 0===b||null===b?null:b.toString())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1},deleteParam:function(a){var b;if(a=a.toLowerCase(),this.parameters.hasOwnProperty(a))return b=this.parameters[a],delete this.parameters[a],b},clearParams:function(){this.parameters={}},clone:function(){return new d(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var a,b;a=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",a+="<"+this.uri.toString()+">";for(b in this.parameters)a+=";"+b,null!==this.parameters[b]&&(a+="="+this.parameters[b]);return a}},d.parse=function(a){return a=f.parse(a,"Name_Addr_Header"),-1!==a?a:void 0}},{"./Grammar":6,"./URI":25}],10:[function(a,b,c){function d(a,b){var c=b,d=0,e=0;if(a.substring(c,c+2).match(/(^\r\n)/))return-2;for(;0===d;){if(-1===(e=a.indexOf("\r\n",c)))return e;!a.substring(e+2,e+4).match(/(^\r\n)/)&&a.charAt(e+2).match(/(^\s+)/)?c=e+2:d=e}return d}function e(a,b,c,d){var e,f,g,j,k=b.indexOf(":",c),l=b.substring(c,k).trim(),m=b.substring(k+1,d).trim();switch(l.toLowerCase()){case"via":case"v":a.addHeader("via",m),1===a.getHeaders("via").length?(j=a.parseHeader("Via"))&&(a.via=j,a.via_branch=j.branch):j=0;break;case"from":case"f":a.setHeader("from",m),j=a.parseHeader("from"),j&&(a.from=j,a.from_tag=j.getParam("tag"));break;case"to":case"t":a.setHeader("to",m),j=a.parseHeader("to"),j&&(a.to=j,a.to_tag=j.getParam("tag"));break;case"record-route":if(-1===(j=h.parse(m,"Record_Route")))j=void 0;else for(g=j.length,f=0;f<g;f++)e=j[f],a.addHeader("record-route",m.substring(e.possition,e.offset)),a.headers["Record-Route"][a.getHeaders("record-route").length-1].parsed=e.parsed;break;case"call-id":case"i":a.setHeader("call-id",m),j=a.parseHeader("call-id"),j&&(a.call_id=m);break;case"contact":case"m":if(-1===(j=h.parse(m,"Contact")))j=void 0;else for(g=j.length,f=0;f<g;f++)e=j[f],a.addHeader("contact",m.substring(e.possition,e.offset)),a.headers.Contact[a.getHeaders("contact").length-1].parsed=e.parsed;break;case"content-length":case"l":a.setHeader("content-length",m),j=a.parseHeader("content-length");break;case"content-type":case"c":a.setHeader("content-type",m),j=a.parseHeader("content-type");break;case"cseq":a.setHeader("cseq",m),j=a.parseHeader("cseq"),j&&(a.cseq=j.value),a instanceof i.IncomingResponse&&(a.method=j.method);break;case"max-forwards":a.setHeader("max-forwards",m),j=a.parseHeader("max-forwards");break;case"www-authenticate":a.setHeader("www-authenticate",m),j=a.parseHeader("www-authenticate");break;case"proxy-authenticate":a.setHeader("proxy-authenticate",m),j=a.parseHeader("proxy-authenticate");break;case"session-expires":case"x":a.setHeader("session-expires",m),j=a.parseHeader("session-expires"),j&&(a.session_expires=j.expires,a.session_expires_refresher=j.refresher);break;case"refer-to":case"r":a.setHeader("refer-to",m),j=a.parseHeader("refer-to"),j&&(a.refer_to=j);break;case"replaces":a.setHeader("replaces",m),j=a.parseHeader("replaces"),j&&(a.replaces=j);break;case"event":case"o":a.setHeader("event",m),j=a.parseHeader("event"),j&&(a.event=j);break;default:a.setHeader(l,m),j=0}return void 0!==j||{error:'error parsing header "'+l+'"'}}var f={};b.exports=f;var g=a("debug")("JsSIP:ERROR:Parser");g.log=console.warn.bind(console);var h=a("./Grammar"),i=a("./SIPMessage");f.parseMessage=function(a,b){var c,f,j,k,l,m=0,n=a.indexOf("\r\n");if(-1===n)return void g("parseMessage() | no CRLF found, not a SIP message");if(f=a.substring(0,n),-1===(l=h.parse(f,"Request_Response")))return void g('parseMessage() | error parsing first line of SIP message: "'+f+'"');for(l.status_code?(c=new i.IncomingResponse,c.status_code=l.status_code,c.reason_phrase=l.reason_phrase):(c=new i.IncomingRequest(b),c.method=l.method,c.ruri=l.uri),c.data=a,m=n+2;;){if(-2===(n=d(a,m))){k=m+2;break}if(-1===n)return void g("parseMessage() | malformed message");if(!0!==(l=e(c,a,m,n)))return void g("parseMessage() |",l.error);m=n+2}return c.hasHeader("content-length")?(j=c.getHeader("content-length"),c.body=a.substr(k,j)):c.body=a.substring(k),c}},{"./Grammar":6,"./SIPMessage":19,debug:35}],11:[function(a,b,c){function d(a){V("new"),this.ua=a,this.status=S.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:Y.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.referSubscribers={},this.data={},this.causes=Y.causes,U.EventEmitter.call(this)}function e(a,b){var c=this,d=aa.T1;this.timers.invite2xxTimer=setTimeout(function e(){c.status===S.STATUS_WAITING_FOR_ACK&&(a.reply(200,null,["Contact: "+c.contact],b),d<aa.T2&&(d*=2)>aa.T2&&(d=aa.T2),c.timers.invite2xxTimer=setTimeout(e,d))},d)}function f(){var a=this;this.timers.ackTimer=setTimeout(function(){a.status===S.STATUS_WAITING_FOR_ACK&&(V("no ACK received, terminating the session"),clearTimeout(a.timers.invite2xxTimer),z.call(a,Y.BYE),M.call(a,"remote",null,Y.causes.NO_ACK))},aa.TIMER_H)}function g(a,b){var c=this;this.connection=new RTCPeerConnection(a,b),this.connection.addEventListener("iceconnectionstatechange",function(){"failed"===c.connection.iceConnectionState&&c.terminate({cause:Y.causes.RTP_TIMEOUT,status_code:408,reason_phrase:Y.causes.RTP_TIMEOUT})})}function h(a){return i(a,"audio","send","PCMA")}function i(a,b,c,d){if(""===d)return a;var e=a.split("\r\n"),f=j(e,"m=",b);if(null===f)return a;var g=j(e,"a=rtpmap",d);if(g){var h=l(e[g]);h&&(e[f]=m(e[f],h))}return a=e.join("\r\n")}function j(a,b,c){return k(a,0,-1,b,c)}function k(a,b,c,d,e){for(var f=-1!==c?c:a.length,g=b;g<f;++g)if(0===a[g].indexOf(d)&&(!e||-1!==a[g].toLowerCase().indexOf(e.toLowerCase())))return g;return null}function l(a){var b=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),c=a.match(b);return c&&2===c.length?c[1]:null}function m(a,b){var c=a.split(" "),d=c.slice(0,3);d.push(b);for(var e=3;e<c.length;e++)c[e]!==b&&d.push(c[e]);return d.join(" ")}function n(a,b,c,d){function e(d){var e;d.sdp=h(d.sdp),g.addEventListener("icecandidate",e=function(c){if(!c.candidate){if(g.removeEventListener("icecandidate",e),f.rtcReady=!0,b){var d={originator:"local",type:a,sdp:g.localDescription.sdp};V('emit "sdp"'),f.emit("sdp",d),b(d.sdp)}b=null}}),g.setLocalDescription(d).then(function(){if("complete"===g.iceGatheringState&&(f.rtcReady=!0,b)){var c={originator:"local",type:a,sdp:g.localDescription.sdp};V('emit "sdp"'),f.emit("sdp",c),b(c.sdp),b=null}}).catch(function(a){f.rtcReady=!0,c&&c(a),W('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',a),f.emit("peerconnection:setlocaldescriptionfailed",a)})}V("createLocalDescription()");var f=this,g=this.connection;if(this.rtcReady=!1,"offer"===a)g.createOffer(d).then(e).catch(function(a){f.rtcReady=!0,c&&c(a),W('emit "peerconnection:createofferfailed" [error:%o]',a),f.emit("peerconnection:createofferfailed",a)});else{if("answer"!==a)throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+a+'" was given');g.createAnswer(d).then(e).catch(function(a){f.rtcReady=!0,c&&c(a),W('emit "peerconnection:createanswerfailed" [error:%o]',a),f.emit("peerconnection:createanswerfailed",a)})}}function o(a,b,c){var d,e,f="UAS"===b?a.to_tag:a.from_tag,g="UAS"===b?a.from_tag:a.to_tag,h=a.call_id+f+g;return e=this.earlyDialogs[h],c?!!e||(e=new ca(this,a,b,ca.C.STATUS_EARLY),e.error?(V(e.error),N.call(this,"remote",a,Y.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[h]=e,!0)):(this.from_tag=a.from_tag,this.to_tag=a.to_tag,e?(e.update(a,b),this.dialog=e,delete this.earlyDialogs[h],!0):(d=new ca(this,a,b),d.error?(V(d.error),N.call(this,"remote",a,Y.causes.INTERNAL_ERROR),!1):(this.dialog=d,!0)))}function p(a){function b(b){b=b||{},o=!0;var c=b.status_code||403,d=b.reason_phrase||"",e=b.extraHeaders&&b.extraHeaders.slice()||[];if(this.status!==S.STATUS_CONFIRMED)return!1;if(c<300||c>=700)throw new TypeError("Invalid status_code: "+c);a.reply(c,d,e)}function c(){d(function(b){var c=["Contact: "+k.contact];C.call(k,a,c),k.late_sdp&&(b=A.call(k,b)),a.reply(200,null,c,b,function(){k.status=S.STATUS_WAITING_FOR_ACK,e.call(k,a,b),f.call(k)}),"function"==typeof p.callback&&p.callback()},function(){a.reply(500)})}function d(a,b){k.late_sdp?n.call(k,"offer",a,b,k.rtcOfferConstraints):(!0===k.remoteHold&&!1===m?(k.remoteHold=!1,P.call(k,"remote")):!1===k.remoteHold&&!0===m&&(k.remoteHold=!0,O.call(k,"remote")),n.call(k,"answer",a,b,k.rtcAnswerConstraints))}V("receiveReinvite()");var g,h,i,j,k=this,l=a.getHeader("Content-Type"),m=!1,o=!1,p={request:a,callback:void 0,reject:b.bind(this)};if(this.emit("reinvite",p),!o)if(a.body){if(this.late_sdp=!1,"application/sdp"!==l)return V("invalid Content-Type"),void a.reply(415);for(g=a.parseSDP(),h=0;h<g.media.length;h++)if(j=g.media[h],-1!==ja.indexOf(j.type)){if("sendonly"!==(i=j.direction||g.direction||"sendrecv")&&"inactive"!==i){m=!1;break}m=!0}var q={originator:"remote",type:"offer",sdp:a.body},r=new RTCSessionDescription({type:"offer",sdp:q.sdp});this.emit("sdp",q),this.connection.setRemoteDescription(r).then(c).catch(function(b){a.reply(488),W('emit "peerconnection:setremotedescriptionfailed" [error:%o]',b),k.emit("peerconnection:setremotedescriptionfailed",b)})}else this.late_sdp=!0,c()}function q(a){function b(b){b=b||{},i=!0;var c=b.status_code||403,d=b.reason_phrase||"",e=b.extraHeaders&&b.extraHeaders.slice()||[];if(this.status!==S.STATUS_CONFIRMED)return!1;if(c<300||c>=700)throw new TypeError("Invalid status_code: "+c);a.reply(c,d,e)}V("receiveUpdate()");var c,d,e,f,g=this,h=a.getHeader("Content-Type"),i=!1,j=!1,k={request:a,callback:void 0,reject:b.bind(this)};if(this.emit("update",k),!i){if(!a.body){var l=[];return C.call(this,a,l),void a.reply(200,null,l)}if("application/sdp"!==h)return V("invalid Content-Type"),void a.reply(415);for(c=a.parseSDP(),d=0;d<c.media.length;d++)if(f=c.media[d],-1!==ja.indexOf(f.type)){if("sendonly"!==(e=f.direction||c.direction||"sendrecv")&&"inactive"!==e){j=!1;break}j=!0}var m={originator:"remote",type:"offer",sdp:a.body};V('emit "sdp"'),this.emit("sdp",m);var o=new RTCSessionDescription({type:"offer",sdp:m.sdp});this.connection.setRemoteDescription(o).then(function(){!0===g.remoteHold&&!1===j?(g.remoteHold=!1,P.call(g,"remote")):!1===g.remoteHold&&!0===j&&(g.remoteHold=!0,O.call(g,"remote")),n.call(g,"answer",function(b){var c=["Contact: "+g.contact];C.call(g,a,c),a.reply(200,null,c,b),"function"==typeof k.callback&&k.callback()},function(){a.reply(500)})}).catch(function(b){a.reply(488),W('emit "peerconnection:setremotedescriptionfailed" [error:%o]',b),g.emit("peerconnection:setremotedescriptionfailed",b)})}}function r(a){function b(b,c){var f,g;if(c=c||{},b="function"==typeof b?b:null,this.status!==S.STATUS_WAITING_FOR_ACK&&this.status!==S.STATUS_CONFIRMED)return!1;f=new d(this.ua),f.on("progress",function(a){e.notify(a.response.status_code,a.response.reason_phrase)}),f.on("accepted",function(a){e.notify(a.response.status_code,a.response.reason_phrase)}),f.on("failed",function(a){a.message?e.notify(a.message.status_code,a.message.reason_phrase):e.notify(487,a.cause)}),a.refer_to.uri.hasHeader("replaces")&&(g=decodeURIComponent(a.refer_to.uri.getHeader("replaces")),c.extraHeaders=c.extraHeaders||[],c.extraHeaders.push("Replaces: "+g)),f.connect(a.refer_to.uri.toAor(),c,b)}function c(){e.notify(603)}V("receiveRefer()");var e,f=this;return void 0===typeof a.refer_to?(V("no Refer-To header field present in REFER"),void a.reply(400)):a.refer_to.uri.scheme!==Y.SIP?(V("Refer-To header field points to a non-SIP URI scheme"),void a.reply(416)):(a.reply(202),e=new ha(this,a.cseq),V('emit "refer"'),void this.emit("refer",{request:a,accept:function(a,c){b.call(f,a,c)},reject:function(){c.call(f)}}))}function s(a){switch(V("receiveNotify()"),void 0===typeof a.event&&a.reply(400),a.event.event){case"refer":var b=a.event.params.id,c=this.referSubscribers[b];if(!c)return void a.reply(481,"Subscription does not exist");c.receiveNotify(a),a.reply(200);break;default:a.reply(489)}}function t(a){function b(b){var c;if(this.status!==S.STATUS_WAITING_FOR_ACK&&this.status!==S.STATUS_CONFIRMED)return!1;c=new d(this.ua),c.on("confirmed",function(){e.terminate()}),c.init_incoming(a,b)}function c(){V("Replaced INVITE rejected by the user"),a.reply(486)}V("receiveReplaces()");var e=this;this.emit("replaces",{request:a,accept:function(a){b.call(e,a)},reject:function(){c.call(e)}})}function u(a,b,c){function d(a){h.status!==S.STATUS_TERMINATED&&(h.localMediaStream=a,a&&h.connection.addStream(a),V('emit "peerconnection"'),h.emit("peerconnection",{peerconnection:h.connection}),I.call(h,h.request),n.call(h,"offer",f,g,b))}function e(){h.status!==S.STATUS_TERMINATED&&N.call(h,"local",null,Y.causes.USER_DENIED_MEDIA_ACCESS)}function f(a){h.isCanceled||h.status===S.STATUS_TERMINATED||(h.request.body=a,h.status=S.STATUS_INVITE_SENT,V('emit "sending" [request:%o]',h.request),h.emit("sending",{request:h.request}),i.send())}function g(){h.status!==S.STATUS_TERMINATED&&N.call(h,"system",null,Y.causes.WEBRTC_ERROR)}var h=this,i=new da(h,this.ua);this.receiveResponse=function(a){v.call(h,a)},c?setTimeout(function(){d(c)}):a.audio||a.video?(this.localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(a).then(d).catch(function(a){e(a),W('emit "getusermediafailed" [error:%o]',a),h.emit("getusermediafailed",a)})):d(null)}function v(a){V("receiveInviteResponse()");var b,c,d,e,f=this;if(this.dialog&&a.status_code>=200&&a.status_code<=299)return this.dialog.id.call_id===a.call_id&&this.dialog.id.local_tag===a.from_tag&&this.dialog.id.remote_tag===a.to_tag?void z.call(this,Y.ACK):(c=new ca(this,a,"UAC"),void 0!==c.error?void V(c.error):(c.sendRequest({owner:{status:S.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},Y.ACK),void c.sendRequest({owner:{status:S.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},Y.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(a.status_code>=100&&a.status_code<200?this.request.cancel(this.cancelReason):a.status_code>=200&&a.status_code<299&&y.call(this,a));if(this.status===S.STATUS_INVITE_SENT||this.status===S.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(a.status_code):this.status=S.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(a.status_code):if(!a.to_tag){V("1xx response received without to tag");break}if(a.hasHeader("contact")&&!o.call(this,a,"UAC",!0))break;if(this.status=S.STATUS_1XX_RECEIVED,J.call(this,"remote",a),!a.body)break;d={originator:"remote",type:"answer",sdp:a.body},V('emit "sdp"'),this.emit("sdp",d),e=new RTCSessionDescription({type:"answer",sdp:d.sdp}),this.connection.setRemoteDescription(e).catch(function(a){W('emit "peerconnection:setremotedescriptionfailed" [error:%o]',a),f.emit("peerconnection:setremotedescriptionfailed",a)});break;case/^2[0-9]{2}$/.test(a.status_code):if(this.status=S.STATUS_CONFIRMED,!a.body){y.call(this,a,400,Y.causes.MISSING_SDP),N.call(this,"remote",a,Y.causes.BAD_MEDIA_DESCRIPTION);break}if(!o.call(this,a,"UAC"))break;d={originator:"remote",type:"answer",sdp:a.body},V('emit "sdp"'),this.emit("sdp",d),e=new RTCSessionDescription({type:"answer",sdp:d.sdp}),Promise.resolve().then(function(){if("stable"===f.connection.signalingState)return f.connection.createOffer().then(function(a){return f.connection.setLocalDescription(a)}).catch(function(b){y.call(f,a,500,b.toString()),N.call(f,"local",a,Y.causes.WEBRTC_ERROR),W('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',b),f.emit("peerconnection:setlocaldescriptionfailed",b)})}).then(function(){f.connection.setRemoteDescription(e).then(function(){D.call(f,a),K.call(f,"remote",a),z.call(f,Y.ACK),L.call(f,"local",null)}).catch(function(b){y.call(f,a,488,"Not Acceptable Here"),N.call(f,"remote",a,Y.causes.BAD_MEDIA_DESCRIPTION),W('emit "peerconnection:setremotedescriptionfailed" [error:%o]',b),f.emit("peerconnection:setremotedescriptionfailed",b)})});break;default:b=_.sipErrorCause(a.status_code),N.call(this,"remote",a,b)}}function w(a){function b(a){if(d.status!==S.STATUS_TERMINATED&&(z.call(d,Y.ACK),!h)){if(D.call(d,a),!a.body)return void c();if("application/sdp"!==a.getHeader("Content-Type"))return void c();var b={originator:"remote",type:"answer",sdp:a.body};V('emit "sdp"'),d.emit("sdp",b);var e=new RTCSessionDescription({type:"answer",sdp:b.sdp});d.connection.setRemoteDescription(e).then(function(){f.succeeded&&f.succeeded(a)}).catch(function(a){c(),W('emit "peerconnection:setremotedescriptionfailed" [error:%o]',a),d.emit("peerconnection:setremotedescriptionfailed",a)})}}function c(a){f.failed&&f.failed(a)}V("sendReinvite()"),a=a||{};var d=this,e=a.extraHeaders||[],f=a.eventHandlers||{},g=a.rtcOfferConstraints||this.rtcOfferConstraints||null,h=!1;e.push("Contact: "+this.contact),e.push("Content-Type: application/sdp"),this.sessionTimers.running&&e.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),n.call(this,"offer",function(a){a=A.call(d,a),new ea(d,Y.INVITE).send({extraHeaders:e,body:a,eventHandlers:{onSuccessResponse:function(a){b(a),h=!0},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})},function(){c()},g)}function x(a){function b(a){if(d.status!==S.STATUS_TERMINATED&&!i)if(D.call(d,a),h){if(!a.body)return void c();if("application/sdp"!==a.getHeader("Content-Type"))return void c();var b={originator:"remote",type:"answer",sdp:a.body};V('emit "sdp"'),d.emit("sdp",b);var e=new RTCSessionDescription({type:"answer",sdp:b.sdp});d.connection.setRemoteDescription(e).then(function(){f.succeeded&&f.succeeded(a)}).catch(function(a){c(),W('emit "peerconnection:setremotedescriptionfailed" [error:%o]',a),d.emit("peerconnection:setremotedescriptionfailed",a)})}else f.succeeded&&f.succeeded(a)}function c(a){f.failed&&f.failed(a)}V("sendUpdate()"),a=a||{};var d=this,e=a.extraHeaders||[],f=a.eventHandlers||{},g=a.rtcOfferConstraints||this.rtcOfferConstraints||null,h=a.sdpOffer||!1,i=!1;if(e.push("Contact: "+this.contact),this.sessionTimers.running&&e.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),h)e.push("Content-Type: application/sdp"),n.call(this,"offer",function(a){a=A.call(d,a),new ea(d,Y.UPDATE).send({extraHeaders:e,body:a,eventHandlers:{onSuccessResponse:function(a){b(a),i=!0},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})},function(){c()},g);else{new ea(d,Y.UPDATE).send({extraHeaders:e,eventHandlers:{onSuccessResponse:function(a){b(a)},onErrorResponse:function(a){c(a)},onTransportError:function(){d.onTransportError()},onRequestTimeout:function(){d.onRequestTimeout()},onDialogError:function(){d.onDialogError()}}})}}function y(a,b,c){V("acceptAndTerminate()");var d=[];b&&(c=c||Y.REASON_PHRASE[b]||"",d.push("Reason: SIP ;cause="+b+'; text="'+c+'"')),(this.dialog||o.call(this,a,"UAC"))&&(z.call(this,Y.ACK),z.call(this,Y.BYE,{extraHeaders:d})),this.status=S.STATUS_TERMINATED}function z(a,b){V("sendRequest()"),new ea(this,a).send(b)}function A(a){var b,c,d;if(!this.localHold&&!this.remoteHold)return a;if(a=X.parse(a),this.localHold&&!this.remoteHold)for(V("mangleOffer() | me on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],-1!==ja.indexOf(d.type)&&(d.direction?"sendrecv"===d.direction?d.direction="sendonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="sendonly");else if(this.localHold&&this.remoteHold)for(V("mangleOffer() | both on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],-1!==ja.indexOf(d.type)&&(d.direction="inactive");else if(this.remoteHold)for(V("mangleOffer() | remote on hold, mangling offer"),c=a.media.length,b=0;b<c;b++)d=a.media[b],-1!==ja.indexOf(d.type)&&(d.direction?"sendrecv"===d.direction?d.direction="recvonly":"recvonly"===d.direction&&(d.direction="inactive"):d.direction="recvonly");return X.write(a)}function B(){var a=!0,b=!0;(this.localHold||this.remoteHold)&&(a=!1,b=!1),this.audioMuted&&(a=!1),this.videoMuted&&(b=!1),F.call(this,!a),G.call(this,!b)}function C(a,b){if(this.sessionTimers.enabled){var c;a.session_expires&&a.session_expires>=Y.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,c=a.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,c="uas"),b.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+c),this.sessionTimers.refresher="uas"===c,E.call(this)}}function D(a){if(this.sessionTimers.enabled){var b;a.session_expires&&a.session_expires>=Y.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=a.session_expires,b=a.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,b="uac"),this.sessionTimers.refresher="uac"===b,E.call(this)}}function E(){var a=this,b=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){a.status!==S.STATUS_TERMINATED&&(V("runSessionTimer() | sending session refresh request"),x.call(a,{eventHandlers:{succeeded:function(b){D.call(a,b)}}}))},500*b):this.sessionTimers.timer=setTimeout(function(){a.status!==S.STATUS_TERMINATED&&(W("runSessionTimer() | timer expired, terminating the session"),a.terminate({cause:Y.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*b)}function F(a){var b,c,d,e,f,g=this.connection.getLocalStreams();for(d=g.length,b=0;b<d;b++)for(f=g[b].getAudioTracks(),e=f.length,c=0;c<e;c++)f[c].enabled=!a}function G(a){var b,c,d,e,f,g=this.connection.getLocalStreams();for(d=g.length,b=0;b<d;b++)for(f=g[b].getVideoTracks(),e=f.length,c=0;c<e;c++)f[c].enabled=!a}function H(a,b){V("newRTCSession()"),this.ua.newRTCSession({originator:a,session:this,request:b})}function I(a){V("session connecting"),V('emit "connecting"'),this.emit("connecting",{request:a})}function J(a,b){V("session progress"),V('emit "progress"'),this.emit("progress",{originator:a,response:b||null})}function K(a,b){V("session accepted"),this.start_time=new Date,V('emit "accepted"'),this.emit("accepted",{originator:a,response:b||null})}function L(a,b){V("session confirmed"),this.is_confirmed=!0,V('emit "confirmed"'),this.emit("confirmed",{originator:a,ack:b||null})}function M(a,b,c){V("session ended"),this.end_time=new Date,this.close(),V('emit "ended"'),this.emit("ended",{originator:a,message:b||null,cause:c})}function N(a,b,c){V("session failed"),this.close(),V('emit "failed"'),this.emit("failed",{originator:a,message:b||null,cause:c})}function O(a){V("session onhold"),B.call(this),V('emit "hold"'),this.emit("hold",{originator:a})}function P(a){V("session onunhold"),B.call(this),V('emit "unhold"'),this.emit("unhold",{originator:a})}function Q(a){V("session onmute"),B.call(this),V('emit "muted"'),this.emit("muted",{audio:a.audio,video:a.video})}function R(a){V("session onunmute"),B.call(this),V('emit "unmuted"'),this.emit("unmuted",{audio:a.audio,video:a.video})}b.exports=d;var S={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};d.C=S;var T=a("util"),U=a("events"),V=a("debug")("JsSIP:RTCSession"),W=a("debug")("JsSIP:ERROR:RTCSession");W.log=console.warn.bind(console);var X=a("sdp-transform"),Y=a("./Constants"),Z=a("./Exceptions"),$=a("./Transactions"),_=a("./Utils"),aa=a("./Timers"),ba=a("./SIPMessage"),ca=a("./Dialog"),da=a("./RequestSender"),ea=a("./RTCSession/Request"),fa=a("./RTCSession/DTMF"),ga=a("./RTCSession/Info"),ha=a("./RTCSession/ReferNotifier"),ia=a("./RTCSession/ReferSubscriber"),ja=["audio","video"];T.inherits(d,U.EventEmitter),d.prototype.isInProgress=function(){switch(this.status){case S.STATUS_NULL:case S.STATUS_INVITE_SENT:case S.STATUS_1XX_RECEIVED:case S.STATUS_INVITE_RECEIVED:case S.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}},d.prototype.isEstablished=function(){switch(this.status){case S.STATUS_ANSWERED:case S.STATUS_WAITING_FOR_ACK:case S.STATUS_CONFIRMED:return!0;default:return!1}},d.prototype.isEnded=function(){switch(this.status){case S.STATUS_CANCELED:case S.STATUS_TERMINATED:return!0;default:return!1}},d.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},d.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},d.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?!0!==this.dialog.uac_pending_reply&&!0!==this.dialog.uas_pending_reply||(V("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(V("isReadyToReOffer() | session not established yet"),!1):(V("isReadyToReOffer() | internal WebRTC status not ready"),!1)},d.prototype.connect=function(a,b,c){V("connect()"),b=b||{};var d,e,f=a,h=b.eventHandlers||{},i=b.extraHeaders&&b.extraHeaders.slice()||[],j=b.mediaConstraints||{audio:!0,video:!0},k=b.mediaStream||null,l=b.pcConfig||{iceServers:[]},m=b.rtcConstraints||null,n=b.rtcOfferConstraints||null;if(this.rtcOfferConstraints=n,this.rtcAnswerConstraints=b.rtcAnswerConstraints||null,this.sessionTimers.enabled&&_.isDecimal(b.sessionTimersExpires)&&(b.sessionTimersExpires>=Y.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=b.sessionTimersExpires:this.sessionTimers.defaultExpires=Y.SESSION_EXPIRES),this.data=b.data||this.data,void 0===a)throw new TypeError("Not enough arguments");if(!window.RTCPeerConnection)throw new Z.NotSupportedError("WebRTC not supported");if(!(a=this.ua.normalizeTarget(a)))throw new TypeError("Invalid target: "+f);if(this.status!==S.STATUS_NULL)throw new Z.InvalidStateError(this.status);for(d in h)this.on(d,h[d]);this.from_tag=_.newTag(),this.anonymous=b.anonymous||!1,this.isCanceled=!1,e={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(e.from_display_name="Anonymous",e.from_uri="sip:anonymous@anonymous.invalid",i.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),i.push("Privacy: id")),i.push("Contact: "+this.contact),i.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&i.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new ba.OutgoingRequest(Y.INVITE,a,this.ua,e,i),this.id=this.request.call_id+this.from_tag,g.call(this,l,m),this.ua.sessions[this.id]=this,this.direction="outgoing",this.local_identity=this.request.from,this.remote_identity=this.request.to,c?c(this):H.call(this,"local",this.request),u.call(this,j,n,k)},d.prototype.init_incoming=function(a,b){V("init_incoming()");var c,d=this,e=a.getHeader("Content-Type");return a.body&&"application/sdp"!==e?void a.reply(415):(this.status=S.STATUS_INVITE_RECEIVED,this.from_tag=a.from_tag,this.id=a.call_id+this.from_tag,this.request=a,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,a.hasHeader("expires")&&(c=1e3*a.getHeader("expires")),a.to_tag=_.newTag(),o.call(this,a,"UAS",!0)?(a.body?this.late_sdp=!1:this.late_sdp=!0,this.status=S.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){a.reply(408),N.call(d,"local",null,Y.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),c&&(this.timers.expiresTimer=setTimeout(function(){d.status===S.STATUS_WAITING_FOR_ANSWER&&(a.reply(487),N.call(d,"system",null,Y.causes.EXPIRES))},c)),this.direction="incoming",this.local_identity=a.to,this.remote_identity=a.from,b?b(this):H.call(this,"remote",a),void(this.status!==S.STATUS_TERMINATED&&(a.reply(180,null,["Contact: "+d.contact]),J.call(d,"local",null)))):void a.reply(500,"Missing Contact header field"))},d.prototype.answer=function(a){function b(a){if(t.status!==S.STATUS_TERMINATED)if(t.localMediaStream=a,a&&t.connection.addStream(a),V('emit "peerconnection"'),t.emit("peerconnection",{peerconnection:t.connection}),t.late_sdp)d();else{var b={originator:"remote",type:"offer",sdp:u.body};V('emit "sdp"'),t.emit("sdp",b);var c=new RTCSessionDescription({type:"offer",sdp:b.sdp});t.connection.setRemoteDescription(c).then(d).catch(function(a){u.reply(488),N.call(t,"system",null,Y.causes.WEBRTC_ERROR),W('emit "peerconnection:setremotedescriptionfailed" [error:%o]',a),t.emit("peerconnection:setremotedescriptionfailed",a)})}}function c(){t.status!==S.STATUS_TERMINATED&&(u.reply(480),N.call(t,"local",null,Y.causes.USER_DENIED_MEDIA_ACCESS))}function d(){I.call(t,u),t.late_sdp?n.call(t,"offer",h,i,t.rtcOfferConstraints):n.call(t,"answer",h,i,A)}function h(a){function b(){t.status=S.STATUS_WAITING_FOR_ACK,e.call(t,u,a),f.call(t),K.call(t,"local")}function c(){N.call(t,"system",null,Y.causes.CONNECTION_ERROR)}t.status!==S.STATUS_TERMINATED&&(C.call(t,u,v),u.reply(200,null,v,a,b,c))}function i(){t.status!==S.STATUS_TERMINATED&&(u.reply(500),N.call(t,"system",null,Y.causes.WEBRTC_ERROR))}V("answer()"),a=a||{};var j,k,l,m,p=!1,q=!1,r=!1,s=!1,t=this,u=this.request,v=a.extraHeaders&&a.extraHeaders.slice()||[],w=a.mediaConstraints||{},x=a.mediaStream||null,y=a.pcConfig||{iceServers:[]},z=a.rtcConstraints||null,A=a.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=A,this.rtcOfferConstraints=a.rtcOfferConstraints||null,this.sessionTimers.enabled&&_.isDecimal(a.sessionTimersExpires)&&(a.sessionTimersExpires>=Y.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=a.sessionTimersExpires:this.sessionTimers.defaultExpires=Y.SESSION_EXPIRES),this.data=a.data||this.data,"incoming"!==this.direction)throw new Z.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==S.STATUS_WAITING_FOR_ANSWER)throw new Z.InvalidStateError(this.status);if(this.status=S.STATUS_ANSWERED,!o.call(this,u,"UAS"))return void u.reply(500,"Error creating dialog");for(clearTimeout(this.timers.userNoAnswerTimer),v.unshift("Contact: "+t.contact),l=u.parseSDP(),Array.isArray(l.media)||(l.media=[l.media]),j=l.media.length;j--;){var B=l.media[j];"audio"===B.type&&(p=!0,B.direction&&"sendrecv"!==B.direction||(r=!0)),"video"===B.type&&(q=!0,B.direction&&"sendrecv"!==B.direction||(s=!0))}if(x&&!1===w.audio)for(m=x.getAudioTracks(),k=m.length,j=0;j<k;j++)x.removeTrack(m[j]);if(x&&!1===w.video)for(m=x.getVideoTracks(),k=m.length,j=0;j<k;j++)x.removeTrack(m[j]);x||void 0!==w.audio||(w.audio=r),x||void 0!==w.video||(w.video=s),x||p||(w.audio=!1),x||q||(w.video=!1),g.call(this,y,z),x?b(x):w.audio||w.video?(t.localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(w).then(b).catch(function(a){c(a),W('emit "getusermediafailed" [error:%o]',a),t.emit("getusermediafailed",a)})):b(null)},d.prototype.terminate=function(a){V("terminate()"),a=a||{};var b,c,d=a.cause||Y.causes.BYE,e=a.status_code,f=a.reason_phrase,g=a.extraHeaders&&a.extraHeaders.slice()||[],h=a.body,i=this;if(this.status===S.STATUS_TERMINATED)throw new Z.InvalidStateError(this.status);switch(this.status){case S.STATUS_NULL:case S.STATUS_INVITE_SENT:case S.STATUS_1XX_RECEIVED:if(V("canceling session"),e&&(e<200||e>=700))throw new TypeError("Invalid status_code: "+e);e&&(f=f||Y.REASON_PHRASE[e]||"",b="SIP ;cause="+e+' ;text="'+f+'"'),this.status===S.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=b):this.status===S.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=b):this.status===S.STATUS_1XX_RECEIVED&&this.request.cancel(b),this.status=S.STATUS_CANCELED,N.call(this,"local",null,Y.causes.CANCELED);break;case S.STATUS_WAITING_FOR_ANSWER:case S.STATUS_ANSWERED:if(V("rejecting session"),(e=e||480)<300||e>=700)throw new TypeError("Invalid status_code: "+e);this.request.reply(e,f,g,h),N.call(this,"local",null,Y.causes.REJECTED);break;case S.STATUS_WAITING_FOR_ACK:case S.STATUS_CONFIRMED:if(V("terminating session"),f=a.reason_phrase||Y.REASON_PHRASE[e]||"",e&&(e<200||e>=700))throw new TypeError("Invalid status_code: "+e);e&&g.push("Reason: SIP ;cause="+e+'; text="'+f+'"'),this.status===S.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==$.C.STATUS_TERMINATED?(c=this.dialog,this.receiveRequest=function(a){a.method===Y.ACK&&(z.call(this,Y.BYE,{extraHeaders:g,body:h}),c.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===$.C.STATUS_TERMINATED&&(z.call(i,Y.BYE,{extraHeaders:g,body:h}),c.terminate())}),M.call(this,"local",null,d),this.dialog=c,this.ua.dialogs[c.id.toString()]=c):(z.call(this,Y.BYE,{extraHeaders:g,body:h}),M.call(this,"local",null,d))}},d.prototype.close=function(){V("close()");var a;if(this.status!==S.STATUS_TERMINATED){if(this.connection)try{this.connection.close()}catch(a){W("close() | error closing the RTCPeerConnection: %o",a)}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(V("close() | closing local MediaStream"),_.closeMediaStream(this.localMediaStream));for(a in this.timers)clearTimeout(this.timers[a]);clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(a in this.earlyDialogs)this.earlyDialogs[a].terminate(),delete this.earlyDialogs[a];this.status=S.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},d.prototype.sendDTMF=function(a,b){function c(){var a,h;if(g.status===S.STATUS_TERMINATED||!g.tones||f>=g.tones.length)return void(g.tones=null);if(a=g.tones[f],f+=1,","===a)h=2e3;else{var i=new fa(g);b.eventHandlers={onFailed:function(){g.tones=null}},i.send(a,b),h=d+e}setTimeout(c,h)}V("sendDTMF() | tones: %s",a);var d,e,f=0,g=this;if(b=b||{},d=b.duration||null,e=b.interToneGap||null,void 0===a)throw new TypeError("Not enough arguments");if(this.status!==S.STATUS_CONFIRMED&&this.status!==S.STATUS_WAITING_FOR_ACK)throw new Z.InvalidStateError(this.status);if("number"==typeof a&&(a=a.toString()),!a||"string"!=typeof a||!a.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: "+a);if(d&&!_.isDecimal(d))throw new TypeError("Invalid tone duration: "+d);if(d?d<fa.C.MIN_DURATION?(V('"duration" value is lower than the minimum allowed, setting it to '+fa.C.MIN_DURATION+" milliseconds"),d=fa.C.MIN_DURATION):d>fa.C.MAX_DURATION?(V('"duration" value is greater than the maximum allowed, setting it to '+fa.C.MAX_DURATION+" milliseconds"),d=fa.C.MAX_DURATION):d=Math.abs(d):d=fa.C.DEFAULT_DURATION,b.duration=d,e&&!_.isDecimal(e))throw new TypeError("Invalid interToneGap: "+e);if(e?e<fa.C.MIN_INTER_TONE_GAP?(V('"interToneGap" value is lower than the minimum allowed, setting it to '+fa.C.MIN_INTER_TONE_GAP+" milliseconds"),e=fa.C.MIN_INTER_TONE_GAP):e=Math.abs(e):e=fa.C.DEFAULT_INTER_TONE_GAP,this.tones)return void(this.tones+=a);this.tones=a,c()},d.prototype.sendInfo=function(a,b,c){if(V("sendInfo()"),c=c||{},this.status!==S.STATUS_CONFIRMED&&this.status!==S.STATUS_WAITING_FOR_ACK)throw new Z.InvalidStateError(this.status);new ga(this).send(a,b,c)},d.prototype.mute=function(a){V("mute()"),a=a||{audio:!0,video:!1};var b=!1,c=!1;!1===this.audioMuted&&a.audio&&(b=!0,this.audioMuted=!0,F.call(this,!0)),!1===this.videoMuted&&a.video&&(c=!0,this.videoMuted=!0,G.call(this,!0)),!0!==b&&!0!==c||Q.call(this,{audio:b,video:c})},d.prototype.unmute=function(a){V("unmute()"),a=a||{audio:!0,video:!0};var b=!1,c=!1;!0===this.audioMuted&&a.audio&&(b=!0,this.audioMuted=!1,!1===this.localHold&&F.call(this,!1)),!0===this.videoMuted&&a.video&&(c=!0,this.videoMuted=!1,!1===this.localHold&&G.call(this,!1)),!0!==b&&!0!==c||R.call(this,{audio:b,video:c})},d.prototype.hold=function(a,b){V("hold()"),a=a||{};var c,d=this;return(this.status===S.STATUS_WAITING_FOR_ACK||this.status===S.STATUS_CONFIRMED)&&(!0!==this.localHold&&(!!this.isReadyToReOffer()&&(this.localHold=!0,O.call(this,"local"),c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:Y.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},a.useUpdate?x.call(this,{sdpOffer:!0,eventHandlers:c,extraHeaders:a.extraHeaders}):w.call(this,{eventHandlers:c,extraHeaders:a.extraHeaders}),!0)))},d.prototype.unhold=function(a,b){V("unhold()"),a=a||{};var c,d=this;return(this.status===S.STATUS_WAITING_FOR_ACK||this.status===S.STATUS_CONFIRMED)&&(!1!==this.localHold&&(!!this.isReadyToReOffer()&&(this.localHold=!1,P.call(this,"local"),c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:Y.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},a.useUpdate?x.call(this,{sdpOffer:!0,eventHandlers:c,extraHeaders:a.extraHeaders}):w.call(this,{eventHandlers:c,extraHeaders:a.extraHeaders}),!0)))},d.prototype.renegotiate=function(a,b){V("renegotiate()"),a=a||{};var c,d=this,e=a.rtcOfferConstraints||null;return(this.status===S.STATUS_WAITING_FOR_ACK||this.status===S.STATUS_CONFIRMED)&&(!!this.isReadyToReOffer()&&(c={succeeded:function(){b&&b()},failed:function(){d.terminate({cause:Y.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},B.call(this),a.useUpdate?x.call(this,{sdpOffer:!0,eventHandlers:c,rtcOfferConstraints:e,extraHeaders:a.extraHeaders}):w.call(this,{eventHandlers:c,rtcOfferConstraints:e,extraHeaders:a.extraHeaders}),!0))},d.prototype.refer=function(a,b){V("refer()");var c,d,e=this,f=a;if(this.status!==S.STATUS_WAITING_FOR_ACK&&this.status!==S.STATUS_CONFIRMED)return!1;if(!(a=this.ua.normalizeTarget(a)))throw new TypeError("Invalid target: "+f);return c=new ia(this),c.sendRefer(a,b),d=c.outgoingRequest.cseq,this.referSubscribers[d]=c,c.on("requestFailed",function(){delete e.referSubscribers[d]}),c.on("accepted",function(){delete e.referSubscribers[d]}),c.on("failed",function(){delete e.referSubscribers[d]}),c},d.prototype.receiveRequest=function(a){V("receiveRequest()");var b,c=this;if(a.method===Y.CANCEL)this.status!==S.STATUS_WAITING_FOR_ANSWER&&this.status!==S.STATUS_ANSWERED||(this.status=S.STATUS_CANCELED,this.request.reply(487),N.call(this,"remote",a,Y.causes.CANCELED));else switch(a.method){case Y.ACK:if(this.status!==S.STATUS_WAITING_FOR_ACK)return;if(this.status=S.STATUS_CONFIRMED,clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!a.body){this.terminate({cause:Y.causes.MISSING_SDP,status_code:400});break}var d={originator:"remote",type:"answer",sdp:a.body},e=new RTCSessionDescription({type:"answer",sdp:d.sdp});this.emit("sdp",d),this.connection.setRemoteDescription(e).then(function(){c.is_confirmed||L.call(c,"remote",a)}).catch(function(a){c.terminate({cause:Y.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),c.emit("peerconnection:setremotedescriptionfailed",a)})}else this.is_confirmed||L.call(this,"remote",a);break;case Y.BYE:this.status===S.STATUS_CONFIRMED?(a.reply(200),M.call(this,"remote",a,Y.causes.BYE)):this.status===S.STATUS_INVITE_RECEIVED?(a.reply(200),this.request.reply(487,"BYE Received"),M.call(this,"remote",a,Y.causes.BYE)):a.reply(403,"Wrong Status");break;case Y.INVITE:this.status===S.STATUS_CONFIRMED?a.hasHeader("replaces")?t.call(this,a):p.call(this,a):a.reply(403,"Wrong Status");break;case Y.INFO:this.status===S.STATUS_CONFIRMED||this.status===S.STATUS_WAITING_FOR_ACK||this.status===S.STATUS_INVITE_RECEIVED?(b=a.getHeader("content-type"),b&&b.match(/^application\/dtmf-relay/i)?new fa(this).init_incoming(a):void 0!==b?new ga(this).init_incoming(a):a.reply(415)):a.reply(403,"Wrong Status");break;case Y.UPDATE:this.status===S.STATUS_CONFIRMED?q.call(this,a):a.reply(403,"Wrong Status");break;case Y.REFER:this.status===S.STATUS_CONFIRMED?r.call(this,a):a.reply(403,"Wrong Status");break;case Y.NOTIFY:this.status===S.STATUS_CONFIRMED?s.call(this,a):a.reply(403,"Wrong Status");break;default:a.reply(501)}},d.prototype.onTransportError=function(){W("onTransportError()"),this.status!==S.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:Y.causes.CONNECTION_ERROR,cause:Y.causes.CONNECTION_ERROR})},d.prototype.onRequestTimeout=function(){W("onRequestTimeout()"),this.status!==S.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:Y.causes.REQUEST_TIMEOUT,cause:Y.causes.REQUEST_TIMEOUT})},d.prototype.onDialogError=function(){W("onDialogError()"),this.status!==S.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:Y.causes.DIALOG_ERROR,cause:Y.causes.DIALOG_ERROR})},d.prototype.newDTMF=function(a){V("newDTMF()"),this.emit("newDTMF",a)},d.prototype.newInfo=function(a){V("newInfo()"),this.emit("newInfo",a)},d.prototype.resetLocalMedia=function(){V("resetLocalMedia()"),this.localHold=!1,this.audioMuted=!1,this.videoMuted=!1,B.call(this)}},{"./Constants":1,"./Dialog":2,"./Exceptions":5,"./RTCSession/DTMF":12,"./RTCSession/Info":13,"./RTCSession/ReferNotifier":14,"./RTCSession/ReferSubscriber":15,"./RTCSession/Request":16,"./RequestSender":18,"./SIPMessage":19,"./Timers":21,"./Transactions":22,"./Utils":26,debug:35,events:29,"sdp-transform":38,util:33}],12:[function(a,b,c){function d(a){this.owner=a,this.direction=null,this.tone=null,this.duration=null,g.EventEmitter.call(this)}b.exports=d;var e={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};d.C=e;var f=a("util"),g=a("events"),h=a("debug")("JsSIP:RTCSession:DTMF"),i=a("debug")("JsSIP:ERROR:RTCSession:DTMF");i.log=console.warn.bind(console);var j=a("../Constants"),k=a("../Exceptions"),l=a("../RTCSession");f.inherits(d,g.EventEmitter),d.prototype.send=function(a,b){var c,d;if(void 0===a)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==l.C.STATUS_CONFIRMED&&this.owner.status!==l.C.STATUS_WAITING_FOR_ACK)throw new k.InvalidStateError(this.owner.status);if(b=b||{},c=b.extraHeaders?b.extraHeaders.slice():[],this.eventHandlers=b.eventHandlers||{},"string"==typeof a)a=a.toUpperCase();else{if("number"!=typeof a)throw new TypeError("Invalid tone: "+a);a=a.toString()}if(!a.match(/^[0-9A-DR#*]$/))throw new TypeError("Invalid tone: "+a);this.tone=a,this.duration=b.duration,c.push("Content-Type: application/dtmf-relay"),d="Signal="+this.tone+"\r\n",d+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,j.INFO,{extraHeaders:c,body:d})},d.prototype.receiveResponse=function(a){switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.emit("succeeded",{originator:"remote",response:a});break;default:this.eventHandlers.onFailed&&this.eventHandlers.onFailed(),this.emit("failed",{originator:"remote",response:a})}},d.prototype.onRequestTimeout=function(){i("onRequestTimeout"),this.owner.onRequestTimeout()},d.prototype.onTransportError=function(){i("onTransportError"),this.owner.onTransportError()},d.prototype.onDialogError=function(){i("onDialogError"),this.owner.onDialogError()},d.prototype.init_incoming=function(a){var b,c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,d=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=a,a.reply(200),a.body&&(b=a.body.split("\n"),b.length>=1&&c.test(b[0])&&(this.tone=b[0].replace(c,"$2")),b.length>=2&&d.test(b[1])&&(this.duration=parseInt(b[1].replace(d,"$2"),10))),this.duration||(this.duration=e.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:a}):h("invalid INFO DTMF received, discarded")}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:35,events:29,util:33}],13:[function(a,b,c){function d(a){this.owner=a,this.direction=null,this.contentType=null,this.body=null,f.EventEmitter.call(this)}b.exports=d;var e=a("util"),f=a("events"),g=a("debug")("JsSIP:ERROR:RTCSession:Info");g.log=console.warn.bind(console);var h=a("../Constants"),i=a("../Exceptions"),j=a("../RTCSession");e.inherits(d,f.EventEmitter),d.prototype.send=function(a,b,c){var d;if(this.direction="outgoing",void 0===a)throw new TypeError("Not enough arguments");if(this.owner.status!==j.C.STATUS_CONFIRMED&&this.owner.status!==j.C.STATUS_WAITING_FOR_ACK)throw new i.InvalidStateError(this.owner.status);this.contentType=a,this.body=b,c=c||{},d=c.extraHeaders?c.extraHeaders.slice():[],d.push("Content-Type: "+a),this.owner.newInfo({originator:"local",info:this,request:this.request}),this.owner.dialog.sendRequest(this,h.INFO,{extraHeaders:d,body:b})},d.prototype.receiveResponse=function(a){switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.emit("succeeded",{originator:"remote",response:a});break;default:this.emit("failed",{originator:"remote",response:a})}},d.prototype.onRequestTimeout=function(){g("onRequestTimeout"),this.owner.onRequestTimeout()},d.prototype.onTransportError=function(){g("onTransportError"),this.owner.onTransportError()},d.prototype.onDialogError=function(){g("onDialogError"),this.owner.onDialogError()},d.prototype.init_incoming=function(a){this.direction="incoming",this.request=a,a.reply(200),this.contentType=a.getHeader("content-type"),this.body=a.body,this.owner.newInfo({originator:"remote",info:this,request:a})}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:35,events:29,util:33}],14:[function(a,b,c){function d(a,b,c){this.session=a,this.id=b,this.expires=c||e.expires,this.active=!0,this.notify(100)}b.exports=d;var e={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},f=a("debug")("JsSIP:RTCSession:ReferNotifier"),g=a("../Constants"),h=a("./Request");d.prototype.notify=function(a,b){f("notify()");var c,d=this;if(!1!==this.active){b=b||g.REASON_PHRASE[a]||"",c=a>=200?"terminated;reason=noresource":"active;expires="+this.expires;new h(this.session,g.NOTIFY).send({extraHeaders:["Event: "+e.event_type+";id="+d.id,"Subscription-State: "+c,"Content-Type: "+e.body_type],body:"SIP/2.0 "+a+" "+b,eventHandlers:{onErrorResponse:function(){d.active=!1}}})}}},{"../Constants":1,"./Request":16,debug:35}],15:[function(a,b,c){function d(a){this.session=a,this.timer=null,this.outgoingRequest=null,h.EventEmitter.call(this)}function e(){console.log("removeSubscriber()"),clearTimeout(this.timer),this.session.referSubscriber=null}b.exports=d;var f={expires:120},g=a("util"),h=a("events"),i=a("debug")("JsSIP:RTCSession:ReferSubscriber"),j=a("../Constants"),k=a("../Grammar"),l=a("./Request");g.inherits(d,h.EventEmitter),d.prototype.sendRefer=function(a,b){i("sendRefer()");var c,d,g,h=null,k=this;b=b||{},c=b.extraHeaders?b.extraHeaders.slice():[],d=b.eventHandlers||{};for(var m in d)this.on(m,d[m]);b.replaces&&(h=b.replaces.request.call_id,h+=";to-tag="+b.replaces.to_tag,h+=";from-tag="+b.replaces.from_tag,h=encodeURIComponent(h)),g="Refer-To: <"+a+(h?"?Replaces="+h:"")+">",c.push(g);var n=new l(this.session,j.REFER);this.timer=setTimeout(function(){e.call(k)},1e3*f.expires),n.send({extraHeaders:c,eventHandlers:{onSuccessResponse:function(a){k.emit("requestSucceeded",{response:a})},onErrorResponse:function(a){k.emit("requestFailed",{response:a,cause:j.causes.REJECTED})},onTransportError:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.CONNECTION_ERROR})},onRequestTimeout:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.REQUEST_TIMEOUT})},onDialogError:function(){e.call(k),k.emit("requestFailed",{response:null,cause:j.causes.DIALOG_ERROR})}}}),this.outgoingRequest=n.outgoingRequest},d.prototype.receiveNotify=function(a){i("receiveNotify()");var b;if(a.body){if(-1===(b=k.parse(a.body,"Status_Line")))return void i('receiveNotify() | error parsing NOTIFY body: "'+a.body+'"');switch(!0){case/^100$/.test(b.status_code):this.emit("trying",{request:a,status_line:b});break;case/^1[0-9]{2}$/.test(b.status_code):this.emit("progress",{request:a,status_line:b});break;case/^2[0-9]{2}$/.test(b.status_code):e.call(this),this.emit("accepted",{request:a,status_line:b});break;default:e.call(this),this.emit("failed",{request:a,status_line:b})}}}},{"../Constants":1,"../Grammar":6,"./Request":16,debug:35,events:29,util:33}],16:[function(a,b,c){function d(a,b){if(e("new | %s",b),this.session=a,this.method=b,this.outgoingRequest=null,this.session.status!==i.C.STATUS_1XX_RECEIVED&&this.session.status!==i.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==i.C.STATUS_WAITING_FOR_ACK&&this.session.status!==i.C.STATUS_CONFIRMED&&this.session.status!==i.C.STATUS_TERMINATED)throw new h.InvalidStateError(this.session.status);if(this.session.status===i.C.STATUS_TERMINATED&&b!==g.BYE)throw new h.InvalidStateError(this.session.status)}b.exports=d;var e=a("debug")("JsSIP:RTCSession:Request"),f=a("debug")("JsSIP:ERROR:RTCSession:Request");f.log=console.warn.bind(console);var g=a("../Constants"),h=a("../Exceptions"),i=a("../RTCSession");d.prototype.send=function(a){a=a||{};var b=a.extraHeaders&&a.extraHeaders.slice()||[],c=a.body||null;this.eventHandlers=a.eventHandlers||{},this.outgoingRequest=this.session.dialog.sendRequest(this,this.method,{extraHeaders:b,body:c})},d.prototype.receiveResponse=function(a){switch(!0){case/^1[0-9]{2}$/.test(a.status_code):e("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(a);break;case/^2[0-9]{2}$/.test(a.status_code):e("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(a);break;default:e("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(a)}},d.prototype.onRequestTimeout=function(){f("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},d.prototype.onTransportError=function(){f("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},d.prototype.onDialogError=function(){f("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:35}],17:[function(a,b,c){function d(a,b){var c=1;this.ua=a,this.transport=b,this.registrar=a.configuration.registrar_server,this.expires=a.configuration.register_expires,this.call_id=f.createRandomToken(22),this.cseq=0,this.to_uri=a.configuration.uri,this.registrationTimer=null,this.registering=!1,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",c&&(this.contact+=";reg-id="+c,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}b.exports=d;var e=a("debug")("JsSIP:Registrator"),f=a("./Utils"),g=a("./Constants"),h=a("./SIPMessage"),i=a("./RequestSender");d.prototype={setExtraHeaders:function(a){Array.isArray(a)||(a=[]),this.extraHeaders=a.slice()},setExtraContactParams:function(a){a instanceof Object||(a={}),this.extraContactParams="";for(var b in a){var c=a[b];this.extraContactParams+=";"+b,c&&(this.extraContactParams+="="+c)}},register:function(){var a,b,c,d=this;if(this.registering)return void e("Register request in progress...");c=this.extraHeaders.slice(),c.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),c.push("Expires: "+this.expires),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},c),a=new i(this,this.ua),this.receiveResponse=function(a){var c,h,i=a.getHeaders("contact").length;if(a.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):if(this.registering=!1,a.hasHeader("expires")&&(h=a.getHeader("expires")),!i){e("no Contact header in response to REGISTER, response ignored");break}for(;i--;){if(c=a.parseHeader("contact",i),c.uri.user===this.ua.contact.uri.user){h=c.getParam("expires");break}c=null}if(!c){e("no Contact header pointing to us, response ignored");break}h||(h=this.expires),this.registrationTimer=setTimeout(function(){d.registrationTimer=null,0===d.ua.listeners("registrationExpiring").length?d.register():d.ua.emit("registrationExpiring")},1e3*h-5e3),c.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=c.getParam("temp-gruu").replace(/"/g,"")),c.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=c.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:a}));break;case/^423$/.test(a.status_code):a.hasHeader("min-expires")?(this.expires=a.getHeader("min-expires"),this.register()):(e("423 response received for REGISTER without Min-Expires"),this.registrationFailure(a,g.causes.SIP_FAILURE_CODE));break;default:b=f.sipErrorCause(a.status_code),this.registrationFailure(a,b)}},this.onRequestTimeout=function(){this.registrationFailure(null,g.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,g.causes.CONNECTION_ERROR)},this.registering=!0,a.send()},unregister:function(a){var b;if(!this.registered)return void e("already unregistered");a=a||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),b=this.extraHeaders.slice(),a.all?(b.push("Contact: *"+this.extraContactParams),b.push("Expires: 0"),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b)):(b.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),b.push("Expires: 0"),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b));var c=new i(this,this.ua);this.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.unregistered(a);break;default:b=f.sipErrorCause(a.status_code),this.unregistered(a,b)}},this.onRequestTimeout=function(){this.unregistered(null,g.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,g.causes.CONNECTION_ERROR)},c.send()},registrationFailure:function(a,b){this.registering=!1,this.ua.registrationFailed({response:a||null,cause:b}),this.registered&&(this.registered=!1,this.ua.unregistered({response:a||null,cause:b}))},unregistered:function(a,b){this.registering=!1,this.registered=!1,this.ua.unregistered({response:a||null,cause:b||null})},onTransportClosed:function(){this.registering=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":1,"./RequestSender":18,"./SIPMessage":19,"./Utils":26,debug:35}],18:[function(a,b,c){function d(a,b){this.ua=b,this.applicant=a,this.method=a.request.method,this.request=a.request,this.auth=null,this.challenged=!1,this.staled=!1,b.status!==g.C.STATUS_USER_CLOSED||this.method===f.BYE&&this.method===f.ACK||this.onTransportError()}b.exports=d;var e=a("debug")("JsSIP:RequestSender"),f=a("./Constants"),g=a("./UA"),h=a("./DigestAuthentication"),i=a("./Transactions");d.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new i.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new i.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new i.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b,c,d,g=a.status_code;if(401!==g&&407!==g||null===this.ua.configuration.password&&null===this.ua.configuration.ha1)this.applicant.receiveResponse(a);else{if(401===a.status_code?(c=a.parseHeader("www-authenticate"),d="authorization"):(c=a.parseHeader("proxy-authenticate"),d="proxy-authorization"),!c)return e(a.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(a);if(!this.challenged||!this.staled&&!0===c.stale){if(this.auth||(this.auth=new h({username:this.ua.configuration.authorization_user,password:this.ua.configuration.password,realm:this.ua.configuration.realm,ha1:this.ua.configuration.ha1})),!this.auth.authenticate(this.request,c))return void this.applicant.receiveResponse(a);this.challenged=!0,this.ua.set("realm",this.auth.get("realm")),this.ua.set("ha1",this.auth.get("ha1")),c.stale&&(this.staled=!0),b=a.method===f.REGISTER?this.applicant.cseq+=1:this.request.dialog?this.request.dialog.local_seqnum+=1:this.request.cseq+1,this.request=this.applicant.request=this.request.clone(),this.request.cseq=b,this.request.setHeader("cseq",b+" "+this.method),this.request.setHeader(d,this.auth.toString()),this.send()}else this.applicant.receiveResponse(a)}}}},{"./Constants":1,"./DigestAuthentication":4,"./Transactions":22,"./UA":24,debug:35}],19:[function(a,b,c){function d(a,b,c,d,e,f){var g,h,i,m;if(d=d||{},!a||!b||!c)return null;this.ua=c,this.headers={},this.method=a,this.ruri=b,this.body=f,this.extraHeaders=e&&e.slice()||[],d.route_set?this.setHeader("route",d.route_set):c.configuration.use_preloaded_route&&this.setHeader("route","<"+c.transport.sip_uri+";lr>"),this.setHeader("via",""),this.setHeader("max-forwards",j.MAX_FORWARDS),g=d.to_display_name||0===d.to_display_name?'"'+d.to_display_name+'" ':"",g+="<"+(d.to_uri||b)+">",g+=d.to_tag?";tag="+d.to_tag:"",this.to=new l.parse(g),this.setHeader("to",g),h=d.from_display_name||0===d.from_display_name?'"'+d.from_display_name+'" ':c.configuration.display_name?'"'+c.configuration.display_name+'" ':"",h+="<"+(d.from_uri||c.configuration.uri)+">;tag=",h+=d.from_tag||k.newTag(),this.from=new l.parse(h),this.setHeader("from",h),i=d.call_id||c.configuration.jssip_id+k.createRandomToken(15),this.call_id=i,this.setHeader("call-id",i),m=d.cseq||Math.floor(1e4*Math.random()),this.cseq=m,this.setHeader("cseq",m+" "+a)}function e(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function f(a){this.ua=a,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function g(){this.headers={},this.status_code=null,this.reason_phrase=null}b.exports={OutgoingRequest:d,IncomingRequest:f,IncomingResponse:g};var h=a("debug")("JsSIP:SIPMessage"),i=a("sdp-transform"),j=a("./Constants"),k=a("./Utils"),l=a("./NameAddrHeader"),m=a("./Grammar");d.prototype={setHeader:function(a,b){var c,d;for(c=new RegExp("^\\s*"+a+"\\s*:","i"),d=0;d<this.extraHeaders.length;d++)c.test(this.extraHeaders[d])&&this.extraHeaders.splice(d,1);this.headers[k.headerize(a)]=Array.isArray(b)?b:[b]},getHeader:function(a){var b,c,d=this.extraHeaders.length,e=this.headers[k.headerize(a)];if(e){if(e[0])return e[0]}else for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(e=this.extraHeaders[c],b.test(e))return e.substring(e.indexOf(":")+1).trim()},getHeaders:function(a){var b,c,d,e=this.headers[k.headerize(a)],f=[];if(e){for(c=e.length,b=0;b<c;b++)f.push(e[b]);return f}for(c=this.extraHeaders.length,d=new RegExp("^\\s*"+a+"\\s*:","i"),b=0;b<c;b++)e=this.extraHeaders[b],d.test(e)&&f.push(e.substring(e.indexOf(":")+1).trim());return f},hasHeader:function(a){var b,c,d=this.extraHeaders.length;if(this.headers[k.headerize(a)])return!0;for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(b.test(this.extraHeaders[c]))return!0;return!1},parseSDP:function(a){return!a&&this.sdp?this.sdp:(this.sdp=i.parse(this.body||""),this.sdp)},toString:function(){var a,b,c,d="",e=[];d+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(a in this.headers)for(b=this.headers[a].length,c=0;c<b;c++)d+=a+": "+this.headers[a][c]+"\r\n";for(b=this.extraHeaders.length,c=0;c<b;c++)d+=this.extraHeaders[c].trim()+"\r\n";switch(this.method){case j.REGISTER:e.push("path","gruu");break;case j.INVITE:this.ua.configuration.session_timers&&e.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&e.push("gruu"),e.push("ice","replaces");break;case j.UPDATE:this.ua.configuration.session_timers&&e.push("timer"),e.push("ice")}return e.push("outbound"),d+="Allow: "+j.ALLOWED_METHODS+"\r\n",d+="Supported: "+e+"\r\n",d+="User-Agent: "+j.USER_AGENT+"\r\n",this.body?(b=k.str_utf8_length(this.body),d+="Content-Length: "+b+"\r\n\r\n",d+=this.body):d+="Content-Length: 0\r\n\r\n",d},clone:function(){var a=new d(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(b){a.headers[b]=this.headers[b].slice()},this),a.body=this.body,a.extraHeaders=this.extraHeaders&&this.extraHeaders.slice()||[],a.to=this.to,a.from=this.from,a.call_id=this.call_id,a.cseq=this.cseq,a}},e.prototype={addHeader:function(a,b){var c={raw:b};a=k.headerize(a),this.headers[a]?this.headers[a].push(c):this.headers[a]=[c]},getHeader:function(a){var b=this.headers[k.headerize(a)];if(b)return b[0]?b[0].raw:void 0},getHeaders:function(a){var b,c,d=this.headers[k.headerize(a)],e=[];if(!d)return[];for(c=d.length,b=0;b<c;b++)e.push(d[b].raw);return e},hasHeader:function(a){return!!this.headers[k.headerize(a)]},parseHeader:function(a,b){var c,d,e;return a=k.headerize(a),b=b||0,this.headers[a]?b>=this.headers[a].length?void h('not so many "'+a+'" headers present'):(c=this.headers[a][b],d=c.raw,c.parsed?c.parsed:(e=m.parse(d,a.replace(/-/g,"_")),-1===e?(this.headers[a].splice(b,1),void h('error parsing "'+a+'" header field with value "'+d+'"')):(c.parsed=e,e))):void h('header "'+a+'" not present')},s:function(a,b){return this.parseHeader(a,b)},setHeader:function(a,b){var c={raw:b};this.headers[k.headerize(a)]=[c]},parseSDP:function(a){return!a&&this.sdp?this.sdp:(this.sdp=i.parse(this.body||""),this.sdp)},toString:function(){return this.data}},f.prototype=new e,f.prototype.reply=function(a,b,c,d,e,f){var g,h,i,l,m,n=[],o=this.getHeader("To"),p=0,q=0;if(a=a||null,b=b||null,!a||a<100||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);if(b=b||j.REASON_PHRASE[a]||"",c=c&&c.slice()||[],m="SIP/2.0 "+a+" "+b+"\r\n",this.method===j.INVITE&&a>100&&a<=200)for(g=this.getHeaders("record-route"),i=g.length,p;p<i;p++)m+="Record-Route: "+g[p]+"\r\n";for(h=this.getHeaders("via"),i=h.length,q;q<i;q++)m+="Via: "+h[q]+"\r\n";for(!this.to_tag&&a>100?o+=";tag="+k.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(o+=";tag="+this.to_tag),m+="To: "+o+"\r\n",m+="From: "+this.getHeader("From")+"\r\n",m+="Call-ID: "+this.call_id+"\r\n",m+="CSeq: "+this.cseq+" "+this.method+"\r\n",i=c.length,l=0;l<i;l++)m+=c[l].trim()+"\r\n";switch(this.method){case j.INVITE:this.ua.configuration.session_timers&&n.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&n.push("gruu"),n.push("ice","replaces");break;case j.UPDATE:this.ua.configuration.session_timers&&n.push("timer"),d&&n.push("ice"),n.push("replaces")}n.push("outbound"),this.method===j.OPTIONS?(m+="Allow: "+j.ALLOWED_METHODS+"\r\n",m+="Accept: "+j.ACCEPTED_BODY_TYPES+"\r\n"):405===a?m+="Allow: "+j.ALLOWED_METHODS+"\r\n":415===a&&(m+="Accept: "+j.ACCEPTED_BODY_TYPES+"\r\n"),m+="Supported: "+n+"\r\n",d?(i=k.str_utf8_length(d),m+="Content-Type: application/sdp\r\n",m+="Content-Length: "+i+"\r\n\r\n",m+=d):m+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(a,m,e,f)},f.prototype.reply_sl=function(a,b){var c,d,e=0,f=this.getHeaders("via"),g=f.length;if(a=a||null,b=b||null,!a||a<100||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);for(b=b||j.REASON_PHRASE[a]||"",d="SIP/2.0 "+a+" "+b+"\r\n",e;e<g;e++)d+="Via: "+f[e]+"\r\n";c=this.getHeader("To"),!this.to_tag&&a>100?c+=";tag="+k.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(c+=";tag="+this.to_tag),d+="To: "+c+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",d+="Content-Length: 0\r\n\r\n",this.transport.send(d)},g.prototype=new e},{"./Constants":1,"./Grammar":6,"./NameAddrHeader":9,"./Utils":26,debug:35,"sdp-transform":38}],20:[function(a,b,c){function d(){}b.exports=d;var e=a("./Utils"),f=a("./Grammar"),g=a("debug")("JsSIP:ERROR:Socket");g.log=console.warn.bind(console),d.isSocket=function(a){if(Array.isArray(a))return!1;if(void 0===a)return g("undefined JsSIP.Socket instance"),!1;try{if(!e.isString(a.url))throw g("missing or invalid JsSIP.Socket url property"),new Error;if(!e.isString(a.via_transport))throw g("missing or invalid JsSIP.Socket via_transport property"),new Error;if(-1===f.parse(a.sip_uri,"SIP_URI"))throw g("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(a){return!1}try{["connect","disconnect","send"].forEach(function(b){if(!e.isFunction(a[b]))throw g("missing or invalid JsSIP.Socket method: "+b),new Error})}catch(a){return!1}return!0}},{"./Grammar":6,"./Utils":26,debug:35}],21:[function(a,b,c){var d=500,e=4e3,f=5e3,g={T1:d,T2:e,T4:f,TIMER_B:64*d,TIMER_D:0*d,TIMER_F:64*d,TIMER_H:64*d,TIMER_I:0*d,TIMER_J:0*d,TIMER_K:0*f,TIMER_L:64*d,TIMER_M:64*d,PROVISIONAL_RESPONSE_INTERVAL:6e4};b.exports=g},{}],22:[function(a,b,c){function d(a,b,c){var d;this.type=j.NON_INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+c.via_transport,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),l.EventEmitter.call(this)}function e(a,b,c){var d,e=this;this.type=j.INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+c.via_transport,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),this.request.cancel=function(a){e.cancel_request(e,a)},l.EventEmitter.call(this)}function f(a,b,c){var d;this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+c.via_transport,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),l.EventEmitter.call(this)}function g(a,b){this.type=j.NON_INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_TRYING,b.newTransaction(this),l.EventEmitter.call(this)}function h(a,b){this.type=j.INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_PROCEEDING,b.newTransaction(this),this.resendProvisionalTimer=null,a.reply(100),l.EventEmitter.call(this)}function i(a,b){var c;switch(b.method){case r.INVITE:if(c=a.transactions.ist[b.via_branch]){switch(c.state){case j.STATUS_PROCEEDING:c.transport.send(c.last_response);break;case j.STATUS_ACCEPTED:}return!0}break;case r.ACK:if(!(c=a.transactions.ist[b.via_branch]))return!1;if(c.state===j.STATUS_ACCEPTED)return!1;if(c.state===j.STATUS_COMPLETED)return c.state=j.STATUS_CONFIRMED,c.I=setTimeout(function(){c.timer_I()},s.TIMER_I),!0;break;case r.CANCEL:return c=a.transactions.ist[b.via_branch],c?(b.reply_sl(200),c.state!==j.STATUS_PROCEEDING):(b.reply_sl(481),!0);default:if(c=a.transactions.nist[b.via_branch]){switch(c.state){case j.STATUS_TRYING:break;case j.STATUS_PROCEEDING:case j.STATUS_COMPLETED:c.transport.send(c.last_response)}return!0}}}b.exports={C:null,NonInviteClientTransaction:d,InviteClientTransaction:e,AckClientTransaction:f,NonInviteServerTransaction:g,InviteServerTransaction:h,checkTransaction:i};var j={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};b.exports.C=j;var k=a("util"),l=a("events"),m=a("debug")("JsSIP:NonInviteClientTransaction"),n=a("debug")("JsSIP:InviteClientTransaction"),o=a("debug")("JsSIP:AckClientTransaction"),p=a("debug")("JsSIP:NonInviteServerTransaction"),q=a("debug")("JsSIP:InviteServerTransaction"),r=a("./Constants"),s=a("./Timers");k.inherits(d,l.EventEmitter),d.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},d.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_TRYING),this.F=setTimeout(function(){a.timer_F()},s.TIMER_F),this.transport.send(this.request)||this.onTransportError()},d.prototype.onTransportError=function(){m("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},d.prototype.timer_F=function(){m("Timer F expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},d.prototype.timer_K=function(){this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},d.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(c<200)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a)}else switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),clearTimeout(this.F),408===c?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(a),this.K=setTimeout(function(){b.timer_K()},s.TIMER_K);break;case j.STATUS_COMPLETED:}},k.inherits(e,l.EventEmitter),e.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},e.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_CALLING),this.B=setTimeout(function(){a.timer_B()},s.TIMER_B),this.transport.send(this.request)||this.onTransportError()},e.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==j.STATUS_ACCEPTED&&(n("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},e.prototype.timer_M=function(){n("Timer M expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},e.prototype.timer_B=function(){n("Timer B expired for transaction "+this.id),this.state===j.STATUS_CALLING&&(this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},e.prototype.timer_D=function(){n("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},e.prototype.sendACK=function(a){var b=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+a.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){b.timer_D()},s.TIMER_D),this.transport.send(this.ack)},e.prototype.cancel_request=function(a,b){var c=a.request;this.cancel=r.CANCEL+" "+c.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+c.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+c.headers.Route.toString()+"\r\n"),this.cancel+="To: "+c.headers.To.toString()+"\r\n",this.cancel+="From: "+c.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+c.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+c.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",b&&(this.cancel+="Reason: "+b+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===j.STATUS_PROCEEDING&&this.transport.send(this.cancel)},e.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(c>=100&&c<=199)switch(this.state){case j.STATUS_CALLING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a);break;case j.STATUS_PROCEEDING:this.request_sender.receiveResponse(a)}else if(c>=200&&c<=299)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.M=setTimeout(function(){b.timer_M()},s.TIMER_M),this.request_sender.receiveResponse(a);break;case j.STATUS_ACCEPTED:this.request_sender.receiveResponse(a)}else if(c>=300&&c<=699)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.sendACK(a),this.request_sender.receiveResponse(a);break;case j.STATUS_COMPLETED:this.sendACK(a)}},k.inherits(f,l.EventEmitter),f.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},f.prototype.onTransportError=function(){o("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},k.inherits(g,l.EventEmitter),g.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},g.prototype.timer_J=function(){p("Timer J expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},g.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,p("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},g.prototype.receiveResponse=function(a,b,c,d){var e=this;if(100===a)switch(this.state){case j.STATUS_TRYING:this.stateChanged(j.STATUS_PROCEEDING),this.transport.send(b)||this.onTransportError();break;case j.STATUS_PROCEEDING:this.last_response=b,this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=200&&a<=699)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.last_response=b,this.J=setTimeout(function(){e.timer_J()},s.TIMER_J),this.transport.send(b)?c&&c():(this.onTransportError(),d&&d());break;case j.STATUS_COMPLETED:}},k.inherits(h,l.EventEmitter),h.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged")},h.prototype.timer_H=function(){q("Timer H expired for transaction "+this.id),this.state===j.STATUS_COMPLETED&&q("ACK not received, dialog will be terminated"),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},h.prototype.timer_I=function(){this.stateChanged(j.STATUS_TERMINATED)},h.prototype.timer_L=function(){q("Timer L expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,q("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},h.prototype.receiveResponse=function(a,b,c,d){var e=this;if(a>=100&&a<=199)switch(this.state){case j.STATUS_PROCEEDING:this.transport.send(b)||this.onTransportError(),this.last_response=b}if(a>100&&a<=199&&this.state===j.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){e.resend_provisional()},s.PROVISIONAL_RESPONSE_INTERVAL));else if(a>=200&&a<=299)switch(this.state){case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.last_response=b,this.L=setTimeout(function(){e.timer_L()},s.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case j.STATUS_ACCEPTED:this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=300&&a<=699)switch(this.state){case j.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(b)?(this.stateChanged(j.STATUS_COMPLETED),this.H=setTimeout(function(){e.timer_H()},s.TIMER_H),c&&c()):(this.onTransportError(),d&&d())}}},{"./Constants":1,"./Timers":21,debug:35,events:29,util:33}],23:[function(a,b,c){function d(a,b){if(k("new()"),this.status=m.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=b||m.recovery_options,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,void 0===a)throw new TypeError("Invalid argument. undefined 'sockets' argument");a instanceof Array||(a=[a]),a.forEach(function(a){if(!j.isSocket(a.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(a.weight&&!Number(a.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:a.socket,weight:a.weight||0,status:m.SOCKET_STATUS_READY})},this),Object.defineProperties(this,{via_transport:{get:function(){return this.socket.via_transport}},url:{get:function(){return this.socket.url}},sip_uri:{get:function(){return this.socket.sip_uri}}}),i.call(this)}function e(){this.recover_attempts=0,this.status=m.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}function f(a,b,c){this.status=m.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:a,code:b,reason:c}),this.close_requested||(this.sockets.forEach(function(a){this.socket===a.socket&&(a.status=m.SOCKET_STATUS_ERROR)},this),h.call(this,a))}function g(a){if("\r\n"===a)return void k("received message with CRLF Keep Alive response");if("string"!=typeof a){try{a=String.fromCharCode.apply(null,new Uint8Array(a))}catch(a){return void k("received binary message failed to be converted into string, message discarded")}k("received binary message:\n\n"+a+"\n")}else k("received text message:\n\n"+a+"\n");this.ondata({transport:this,message:a})}function h(){var a,b=this;this.recover_attempts+=1,a=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1),a<this.recovery_options.min_interval?a=this.recovery_options.min_interval:a>this.recovery_options.max_interval&&(a=this.recovery_options.max_interval),k("reconnection attempt: "+this.recover_attempts+". next connection attempt in "+a+" seconds"),this.recovery_timer=setTimeout(function(){b.close_requested||b.isConnected()||b.isConnecting()||(i.call(b),b.connect())},1e3*a)}function i(){var a=[];if(this.sockets.forEach(function(b){b.status!==m.SOCKET_STATUS_ERROR&&(0===a.length?a.push(b):b.weight>a[0].weight?a=[b]:b.weight===a[0].weight&&a.push(b))}),0===a.length)return this.sockets.forEach(function(a){a.status=m.SOCKET_STATUS_READY}),void i.call(this);var b=Math.floor(Math.random()*a.length);this.socket=a[b].socket}b.exports=d;var j=a("./Socket"),k=a("debug")("JsSIP:Transport"),l=a("debug")("JsSIP:ERROR:Transport"),m={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:2,max_interval:30}};d.prototype.connect=function(){return k("connect()"),this.isConnected()?void k("Transport is already connected"):this.isConnecting()?void k("Transport is connecting"):(this.close_requested=!1,this.status=m.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),void(this.close_requested||(this.socket.onconnect=e.bind(this),this.socket.ondisconnect=f.bind(this),this.socket.ondata=g.bind(this),this.socket.connect())))},d.prototype.disconnect=function(){k("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=m.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect()},d.prototype.send=function(a){if(k("send()"),!this.isConnected())return l("unable to send message, transport is not connected"),!1;var b=a.toString();return k("sending message:\n\n"+b+"\n"),this.socket.send(b)},d.prototype.isConnected=function(){return this.status===m.STATUS_CONNECTED},d.prototype.isConnecting=function(){return this.status===m.STATUS_CONNECTING}},{"./Socket":20,debug:35}],24:[function(a,b,c){function d(a){if(l("new() [configuration:%o]",a),this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=i.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},this.closeTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var a,b=["nist","nict","ist","ict"],c=0;for(a in b)c+=Object.keys(this.transactions[b[a]]).length;return c}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===a)throw new TypeError("Not enough arguments");try{this.loadConfig(a)}catch(a){throw this.status=i.STATUS_NOT_READY,this.error=i.CONFIGURATION_ERROR,a}this._registrator=new o(this),k.EventEmitter.call(this)}function e(a){this.emit("connecting",a)}function f(a){this.status!==i.STATUS_USER_CLOSED&&(this.status=i.STATUS_READY,this.error=null,this.emit("connected",a),this.dynConfiguration.register&&this._registrator.register())}function g(a){var b,c,d,e=["nict","ict","nist","ist"];for(d=e.length,b=0;b<d;b++)for(c in this.transactions[e[b]])this.transactions[e[b]][c].onTransportError();this.emit("disconnected",a),this._registrator.onTransportClosed(),this.status!==i.STATUS_USER_CLOSED&&(this.status=i.STATUS_NOT_READY,this.error=i.NETWORK_ERROR)}function h(a){var b,c=a.transport,e=a.message;if((e=y.parseMessage(e,this))&&!(this.status===d.C.STATUS_USER_CLOSED&&e instanceof z.IncomingRequest)&&A(e,this,c))if(e instanceof z.IncomingRequest)e.transport=c,this.receiveRequest(e);else if(e instanceof z.IncomingResponse)switch(e.method){case n.INVITE:b=this.transactions.ict[e.via_branch],b&&b.receiveResponse(e);break;case n.ACK:break;default:b=this.transactions.nict[e.via_branch],b&&b.receiveResponse(e)}}b.exports=d;var i={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};d.C=i;var j=a("util"),k=a("events"),l=a("debug")("JsSIP:UA"),m=a("debug")("JsSIP:ERROR:UA");m.log=console.warn.bind(console);var n=a("./Constants"),o=a("./Registrator"),p=a("./RTCSession"),q=a("./Message"),r=a("./Transactions"),s=a("./Transport"),t=a("./Socket"),u=a("./Utils"),v=a("./Exceptions"),w=a("./URI"),x=a("./Grammar"),y=a("./Parser"),z=a("./SIPMessage"),A=a("./sanityCheck");j.inherits(d,k.EventEmitter),d.prototype.start=function(){l("start()"),this.status===i.STATUS_INIT?this.transport.connect():this.status===i.STATUS_USER_CLOSED?(l("restarting UA"),null!==this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null,this.transport.disconnect()),this.status=i.STATUS_INIT,this.transport.connect()):l(this.status===i.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},d.prototype.register=function(){l("register()"),this.dynConfiguration.register=!0,this._registrator.register()},d.prototype.unregister=function(a){l("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(a)},d.prototype.registrator=function(){return this._registrator},d.prototype.isRegistered=function(){return!!this._registrator.registered},d.prototype.isConnected=function(){return this.transport.isConnected()},d.prototype.call=function(a,b){l("call()");var c;return c=new p(this),c.connect(a,b),c},d.prototype.sendMessage=function(a,b,c){l("sendMessage()");var d;return d=new q(this),d.send(a,b,c),d},d.prototype.terminateSessions=function(a){l("terminateSessions()");for(var b in this.sessions)this.sessions[b].isEnded()||this.sessions[b].terminate(a)},d.prototype.stop=function(){l("stop()");var a,b,c,d=this;if(this.dynConfiguration={},this.status===i.STATUS_USER_CLOSED)return void l("UA already closed");this._registrator.close(),c=Object.keys(this.sessions).length;for(a in this.sessions){l("closing session "+a);try{this.sessions[a].terminate()}catch(a){}}for(b in this.applicants)try{this.applicants[b].close()}catch(a){}this.status=i.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&0===this.ictTransactionsCount&&0===this.istTransactionsCount&&0===c?d.transport.disconnect():this.closeTimer=setTimeout(function(){d.closeTimer=null,d.transport.disconnect()},2e3)},d.prototype.normalizeTarget=function(a){return u.normalizeTarget(a,this.configuration.hostport_params)},d.prototype.get=function(a){switch(a){case"realm":return this.configuration.realm;case"ha1":return this.configuration.ha1;default:return void m('get() | cannot get "%s" parameter in runtime',a)}return!0},d.prototype.set=function(a,b){switch(a){case"password":this.configuration.password=String(b);break;case"realm":this.configuration.realm=String(b);break;case"ha1":this.configuration.ha1=String(b),this.configuration.password=null;break;case"display_name":if(-1===x.parse('"'+b+'"',"display_name"))return m('set() | wrong "display_name"'),!1;this.configuration.display_name=b;break;default:return m('set() | cannot set "%s" parameter in runtime',a),!1}return!0},d.prototype.newTransaction=function(a){this.transactions[a.type][a.id]=a,this.emit("newTransaction",{transaction:a})},d.prototype.destroyTransaction=function(a){delete this.transactions[a.type][a.id],this.emit("transactionDestroyed",{transaction:a})},d.prototype.newMessage=function(a){this.emit("newMessage",a)},d.prototype.newRTCSession=function(a){this.emit("newRTCSession",a)},d.prototype.registered=function(a){this.emit("registered",a)},d.prototype.unregistered=function(a){this.emit("unregistered",a)},d.prototype.registrationFailed=function(a){this.emit("registrationFailed",a)},d.prototype.receiveRequest=function(a){var b,c,d,e,f=a.method;if(a.ruri.user!==this.configuration.uri.user&&a.ruri.user!==this.contact.uri.user)return l("Request-URI does not point to us"),void(a.method!==n.ACK&&a.reply_sl(404));if(a.ruri.scheme===n.SIPS)return void a.reply_sl(416);if(!r.checkTransaction(this,a)){if(f===n.INVITE?new r.InviteServerTransaction(a,this):f!==n.ACK&&f!==n.CANCEL&&new r.NonInviteServerTransaction(a,this),f===n.OPTIONS)a.reply(200);else if(f===n.MESSAGE){if(0===this.listeners("newMessage").length)return void a.reply(405);d=new q(this),d.init_incoming(a)}else if(f===n.INVITE&&!a.to_tag&&0===this.listeners("newRTCSession").length)return void a.reply(405);if(a.to_tag)b=this.findDialog(a.call_id,a.from_tag,a.to_tag),b?b.receiveRequest(a):f===n.NOTIFY?(c=this.findSession(a),c?c.receiveRequest(a):(l("received NOTIFY request for a non existent subscription"),a.reply(481,"Subscription does not exist"))):f!==n.ACK&&a.reply(481);else switch(f){case n.INVITE:window.RTCPeerConnection?a.hasHeader("replaces")?(e=a.replaces,b=this.findDialog(e.call_id,e.from_tag,e.to_tag),b?(c=b.owner,c.isEnded()?a.reply(603):c.receiveRequest(a)):a.reply(481)):(c=new p(this),c.init_incoming(a)):(m("INVITE received but WebRTC is not supported"),a.reply(488));break;case n.BYE:a.reply(481);break;case n.CANCEL:c=this.findSession(a),c?c.receiveRequest(a):l("received CANCEL request for a non existent session");break;case n.ACK:break;default:a.reply(405)}}},d.prototype.findSession=function(a){var b=a.call_id+a.from_tag,c=this.sessions[b],d=a.call_id+a.to_tag,e=this.sessions[d];return c||(e||null)},d.prototype.findDialog=function(a,b,c){var d=a+b+c,e=this.dialogs[d];return e||(d=a+c+b,(e=this.dialogs[d])||null)},d.prototype.loadConfig=function(a){var b,c,i,j,k,n={via_host:u.createRandomToken(12)+".invalid",contact_uri:null,password:null,realm:null,ha1:null,register_expires:600,register:!0,registrar_server:null,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0};for(b in d.configuration_check.mandatory){if(!a.hasOwnProperty(b))throw new v.ConfigurationError(b);if(c=a[b],void 0===(i=d.configuration_check.mandatory[b].call(this,c)))throw new v.ConfigurationError(b,c);n[b]=i}for(b in d.configuration_check.optional)if(a.hasOwnProperty(b)){if(c=a[b],u.isEmpty(c))continue;if(void 0===(i=d.configuration_check.optional[b].call(this,c,a)))throw new v.ConfigurationError(b,c);n[b]=i}0===n.display_name&&(n.display_name="0"),n.instance_id||(n.instance_id=u.newUUID()),n.jssip_id=u.createRandomToken(5),j=n.uri.clone(),j.user=null,n.hostport_params=j.toString().replace(/^sip:/i,"");var o=[];if(n.sockets&&Array.isArray(n.sockets)&&(o=o.concat(n.sockets)),0===o.length)throw new v.ConfigurationError("sockets");try{this.transport=new s(o,{max_interval:n.connection_recovery_max_interval,min_interval:n.connection_recovery_min_interval}),this.transport.onconnecting=e.bind(this),this.transport.onconnect=f.bind(this),this.transport.ondisconnect=g.bind(this),this.transport.ondata=h.bind(this),delete n.connection_recovery_max_interval,delete n.connection_recovery_min_interval,delete n.sockets}catch(a){throw m(a),new v.ConfigurationError("sockets",o)}n.authorization_user||(n.authorization_user=n.uri.user),n.registrar_server||(k=n.uri.clone(),k.user=null,k.clearParams(),k.clearHeaders(),n.registrar_server=k),n.no_answer_timeout=1e3*n.no_answer_timeout,n.contact_uri?n.via_host=n.contact_uri.host:n.contact_uri=new w("sip",u.createRandomToken(8),n.via_host,null,{transport:"ws"}),this.contact={pub_gruu:null,temp_gruu:null,uri:n.contact_uri,toString:function(a){a=a||{};var b=a.anonymous||null,c=a.outbound||null,d="<";return d+=b?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!c||(b?this.temp_gruu:this.pub_gruu)||(d+=";ob"),d+=">"}};for(b in n)d.configuration_skeleton[b].value=n[b];Object.defineProperties(this.configuration,d.configuration_skeleton);for(b in n)d.configuration_skeleton[b].value="";l("configuration parameters after validation:");for(b in n)switch(b){case"uri":case"registrar_server":l("- "+b+": "+n[b]);break;case"password":case"ha1":l("- "+b+": NOT SHOWN");break;default:l("- "+b+": "+JSON.stringify(n[b]))}},d.configuration_skeleton=function(){var a,b,c,d={},e=["jssip_id","hostport_params","uri","authorization_user","contact_uri","display_name","instance_id","no_answer_timeout","session_timers","password","realm","ha1","register_expires","registrar_server","sockets","use_preloaded_route","via_core_value","via_host"],f=["password","realm","ha1","display_name"];for(a in e)b=e[a],c=-1!==f.indexOf(b),d[b]={value:"",writable:c,configurable:!1};return d.register={value:"",writable:!0,configurable:!1},d}(),d.configuration_check={mandatory:{uri:function(a){var b;return/^sip:/i.test(a)||(a=n.SIP+":"+a),b=w.parse(a),b&&b.user?b:void 0}},optional:{authorization_user:function(a){return-1===x.parse('"'+a+'"',"quoted_string")?void 0:a},connection_recovery_max_interval:function(a){var b;if(u.isDecimal(a)&&(b=Number(a))>0)return b},connection_recovery_min_interval:function(a){var b;if(u.isDecimal(a)&&(b=Number(a))>0)return b},contact_uri:function(a){if("string"==typeof a){var b=x.parse(a,"SIP_URI");if(-1!==b)return b}},display_name:function(a){return-1===x.parse('"'+a+'"',"display_name")?void 0:a},instance_id:function(a){return/^uuid:/i.test(a)&&(a=a.substr(5)),-1===x.parse(a,"uuid")?void 0:a},no_answer_timeout:function(a){var b;if(u.isDecimal(a)&&(b=Number(a))>0)return b},session_timers:function(a){if("boolean"==typeof a)return a},password:function(a){return String(a)},realm:function(a){return String(a)},ha1:function(a){return String(a)},register:function(a){if("boolean"==typeof a)return a},register_expires:function(a){var b;if(u.isDecimal(a)&&(b=Number(a))>0)return b},registrar_server:function(a){var b;return/^sip:/i.test(a)||(a=n.SIP+":"+a),b=w.parse(a),b?b.user?void 0:b:void 0},sockets:function(a){var b,c;if(t.isSocket(a))a=[{socket:a}];else{if(!Array.isArray(a)||!a.length)return;for(c=a.length,b=0;b<c;b++)t.isSocket(a[b])&&(a[b]={socket:a[b]})}return a},use_preloaded_route:function(a){if("boolean"==typeof a)return a}}}},{"./Constants":1,"./Exceptions":5,"./Grammar":6,"./Message":8,"./Parser":10,"./RTCSession":11,"./Registrator":17,"./SIPMessage":19,"./Socket":20,"./Transactions":22,"./Transport":23,"./URI":25,"./Utils":26,"./sanityCheck":28,debug:35,events:29,util:33}],25:[function(a,b,c){function d(a,b,c,d,f,g){var h,i;if(!c)throw new TypeError('missing or invalid "host" parameter');a=a||e.SIP,this.parameters={},this.headers={};for(h in f)this.setParam(h,f[h]);for(i in g)this.setHeader(i,g[i]);Object.defineProperties(this,{scheme:{get:function(){return a},set:function(b){a=b.toLowerCase()}},user:{get:function(){return b},set:function(a){b=a}},host:{get:function(){return c},set:function(a){c=a.toLowerCase()}},port:{get:function(){return d},set:function(a){d=0===a?a:parseInt(a,10)||null}}})}b.exports=d;var e=a("./Constants"),f=a("./Utils"),g=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]=void 0===b||null===b?null:b.toString())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1},deleteParam:function(a){var b;if(a=a.toLowerCase(),this.parameters.hasOwnProperty(a))return b=this.parameters[a],delete this.parameters[a],b},clearParams:function(){this.parameters={}},setHeader:function(a,b){this.headers[f.headerize(a)]=Array.isArray(b)?b:[b]},getHeader:function(a){if(a)return this.headers[f.headerize(a)]},hasHeader:function(a){if(a)return this.headers.hasOwnProperty(f.headerize(a))&&!0||!1},deleteHeader:function(a){var b;if(a=f.headerize(a),this.headers.hasOwnProperty(a))return b=this.headers[a],delete this.headers[a],b},clearHeaders:function(){this.headers={}},clone:function(){return new d(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var a,b,c,d,e=[];d=this.scheme+":",this.user&&(d+=f.escapeUser(this.user)+"@"),d+=this.host,(this.port||0===this.port)&&(d+=":"+this.port);for(b in this.parameters)d+=";"+b,null!==this.parameters[b]&&(d+="="+this.parameters[b]);for(a in this.headers)for(c=0;c<this.headers[a].length;c++)e.push(a+"="+this.headers[a][c]);return e.length>0&&(d+="?"+e.join("&")),d},toAor:function(a){var b;return b=this.scheme+":",this.user&&(b+=f.escapeUser(this.user)+"@"),b+=this.host,a&&(this.port||0===this.port)&&(b+=":"+this.port),b}},d.parse=function(a){return a=g.parse(a,"SIP_URI"),-1!==a?a:void 0}},{"./Constants":1,"./Grammar":6,"./Utils":26}],26:[function(a,b,c){var d={};b.exports=d;var e=a("./Constants"),f=a("./URI"),g=a("./Grammar");d.str_utf8_length=function(a){return unescape(encodeURIComponent(a)).length},d.isFunction=function(a){return void 0!==a&&"[object Function]"===Object.prototype.toString.call(a)},d.isString=function(a){return void 0!==a&&"[object String]"===Object.prototype.toString.call(a)},d.isDecimal=function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)},d.isEmpty=function(a){if(null===a||""===a||void 0===a||Array.isArray(a)&&0===a.length||"number"==typeof a&&isNaN(a))return!0},d.hasMethods=function(a){for(var b,c=1;b=arguments[c++];)if(this.isFunction(a[b]))return!1;return!0},d.createRandomToken=function(a,b){var c,d,e="";for(b=b||32,c=0;c<a;c++)d=Math.random()*b|0,e+=d.toString(b);return e},d.newTag=function(){return d.createRandomToken(10)},d.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})},d.hostType=function(a){if(a)return-1!==(a=g.parse(a,"host"))?a.host_type:void 0},d.normalizeTarget=function(a,b){var c,g,h,i;if(a){if(a instanceof f)return a;if("string"==typeof a){switch(g=a.split("@"),g.length){case 1:if(!b)return;h=a,i=b;break;case 2:h=g[0],i=g[1];break;default:h=g.slice(0,g.length-1).join("@"),i=g[g.length-1]}return h=h.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(h)&&(h=h.replace(/[\-\.\(\)]/g,"")),a=e.SIP+":"+d.escapeUser(h)+"@"+i,(c=f.parse(a))?c:void 0}}else;},d.escapeUser=function(a){return encodeURIComponent(decodeURIComponent(a)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},d.headerize=function(a){var b,c={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},d=a.toLowerCase().replace(/_/g,"-").split("-"),e="",f=d.length;for(b=0;b<f;b++)0!==b&&(e+="-"),e+=d[b].charAt(0).toUpperCase()+d[b].substring(1);return c[e]&&(e=c[e]),e},d.sipErrorCause=function(a){var b;for(b in e.SIP_ERROR_CAUSES)if(-1!==e.SIP_ERROR_CAUSES[b].indexOf(a))return e.causes[b];return e.causes.SIP_FAILURE_CODE},d.getRandomTestNetIP=function(){function a(a,b){return Math.floor(Math.random()*(b-a+1)+a)}return"192.0.2."+a(1,254)},d.calculateMD5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=new Array(f-1),h=0,i=0;i<c;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;c<=3;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=[],y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);return(m(t)+m(u)+m(v)+m(w)).toLowerCase()},d.closeMediaStream=function(a){if(a)try{var b,c,d;if(a.getTracks)for(b=a.getTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop();else{for(b=a.getAudioTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop();for(b=a.getVideoTracks(),c=0,d=b.length;c<d;c+=1)b[c].stop()}}catch(b){"function"!=typeof a.stop&&"object"!=typeof a.stop||a.stop()}}},{"./Constants":1,"./Grammar":6,"./URI":25}],27:[function(a,b,c){function d(a){j('new() [url:"%s"]',a);var b=null,c=null;this.ws=null,Object.defineProperties(this,{via_transport:{get:function(){return c},set:function(a){c=a.toUpperCase()}},sip_uri:{get:function(){return b}},url:{get:function(){return a}}});var d=i.parse(a,"absoluteURI");if(-1===d)throw k("invalid WebSocket URI: "+a),new TypeError("Invalid argument: "+a);if("wss"!==d.scheme&&"ws"!==d.scheme)throw k("invalid WebSocket URI scheme: "+d.scheme),new TypeError("Invalid argument: "+a);b="sip:"+d.host+(d.port?":"+d.port:"")+";transport=ws",this.via_transport=d.scheme}function e(){j("WebSocket "+this.url+" connected"),this.onconnect()}function f(a){j("WebSocket "+this.url+" closed"),!1===a.wasClean&&j("WebSocket abrupt disconnection");var b={socket:this,error:!a.wasClean,code:a.code,reason:a.reason};this.ondisconnect(b)}function g(a){j("received WebSocket message"),this.ondata(a.data)}function h(a){k("WebSocket "+this.url+" error: "+a)}b.exports=d;var i=a("./Grammar"),j=a("debug")("JsSIP:WebSocketInterface"),k=a("debug")("JsSIP:ERROR:WebSocketInterface");k.log=console.warn.bind(console),d.prototype.connect=function(){if(j("connect()"),this.isConnected())return void j("WebSocket "+this.url+" is already connected");if(this.isConnecting())return void j("WebSocket "+this.url+" is connecting");this.ws&&this.disconnect(),j("connecting to WebSocket "+this.url);try{this.ws=new WebSocket(this.url,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=e.bind(this),this.ws.onclose=f.bind(this),this.ws.onmessage=g.bind(this),this.ws.onerror=h.bind(this)}catch(a){h.call(this,a)}},d.prototype.disconnect=function(){j("disconnect()"),this.ws&&(this.ws.onopen=function(){},this.ws.onclose=function(){},this.ws.onmessage=function(){},this.ws.onerror=function(){},this.ws.close(),this.ws=null)},d.prototype.send=function(a){return j("send()"),this.isConnected()?(this.ws.send(a),!0):(k("unable to send message, WebSocket is not open"),!1)},d.prototype.isConnected=function(){return this.ws&&this.ws.readyState===this.ws.OPEN},d.prototype.isConnecting=function(){return this.ws&&this.ws.readyState===this.ws.CONNECTING}},{"./Grammar":6,debug:35}],28:[function(a,b,c){function d(a,b,c){var d;for(m=a,n=b,o=c,d=v.length;d--;)if(!1===v[d](m))return!1;if(m instanceof r.IncomingRequest){for(d=t.length;d--;)if(!1===t[d](m))return!1}else if(m instanceof r.IncomingResponse)for(d=u.length;d--;)if(!1===u[d](m))return!1;return!0}function e(){if("sip"!==m.s("to").uri.scheme)return l(416),!1}function f(){if(!m.to_tag&&m.call_id.substr(0,5)===n.configuration.jssip_id)return l(482),!1}function g(){if(s.str_utf8_length(m.body)<m.getHeader("content-length"))return l(400),!1}function h(){var a,b,c=m.from_tag,d=m.call_id,e=m.cseq;if(!m.to_tag)if(m.method===q.INVITE){if(n.transactions.ist[m.via_branch])return!1;for(b in n.transactions.ist)if(a=n.transactions.ist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}else{if(n.transactions.nist[m.via_branch])return!1;for(b in n.transactions.nist)if(a=n.transactions.nist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}}function i(){if(m.getHeaders("via").length>1)return p("more than one Via header field present in the response, dropping the response"),!1}function j(){if(s.str_utf8_length(m.body)<m.getHeader("content-length"))return p("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function k(){for(var a=["from","to","call_id","cseq","via"],b=a.length;b--;)if(!m.hasHeader(a[b]))return p("missing mandatory header field : "+a[b]+", dropping the response"),!1}function l(a){var b,c="SIP/2.0 "+a+" "+q.REASON_PHRASE[a]+"\r\n",d=m.getHeaders("via"),e=d.length,f=0;for(f;f<e;f++)c+="Via: "+d[f]+"\r\n";b=m.getHeader("To"),m.to_tag||(b+=";tag="+s.newTag()),c+="To: "+b+"\r\n",c+="From: "+m.getHeader("From")+"\r\n",c+="Call-ID: "+m.call_id+"\r\n",c+="CSeq: "+m.cseq+" "+m.method+"\r\n",c+="\r\n",o.send(c)}b.exports=d;var m,n,o,p=a("debug")("JsSIP:sanityCheck"),q=a("./Constants"),r=a("./SIPMessage"),s=a("./Utils"),t=[],u=[],v=[];t.push(e),t.push(f),t.push(g),t.push(h),u.push(i),u.push(j),v.push(k)},{"./Constants":1,"./SIPMessage":19,"./Utils":26,debug:35}],29:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners)&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace()),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){return this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],30:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],31:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],32:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],33:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){r=" [Function"+(b.name?": "+b.name:"")+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(d<0)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var v;return v=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(v,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0;return a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||void 0===a}function C(a){return Object.prototype.toString.call(a)}function D(a){return a<10?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];c<f;h=d[++c])q(h)||!x(h)?g+=" "+h:g+=" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(!0===b.noDeprecation)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":32,_process:30,inherits:31}],34:[function(a,b,c){function d(a){if(a=String(a),!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){b=b||{};var c=typeof a;if("string"===c&&a.length>0)return d(a);if("number"===c&&!1===isNaN(a))return b.long?f(a):e(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}},{}],35:[function(a,b,c){(function(d){function e(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function f(a){var b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),b){var d="color: "+this.color;a.splice(1,0,d,"color: inherit");var e=0,f=0;a[0].replace(/%[a-zA-Z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d)}}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function h(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(a){}}function i(){try{return c.storage.debug}catch(a){}if(void 0!==d&&"env"in d)return d.env.DEBUG}function j(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=g,c.formatArgs=f,c.save=h,c.load=i,c.useColors=e,c.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:j(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){try{return JSON.stringify(a)}catch(a){return"[UnexpectedJSONParseError]: "+a.message}},c.enable(i())}).call(this,a("_process"))},{"./debug":36,_process:30}],36:[function(a,b,c){function d(a){var b,d=0;for(b in a)d=(d<<5)-d+a.charCodeAt(b),d|=0;return c.colors[Math.abs(d)%c.colors.length]}function e(a){function b(){if(b.enabled){var a=b,d=+new Date,e=d-(j||d);a.diff=e,a.prev=j,a.curr=d,j=d;for(var f=new Array(arguments.length),g=0;g<f.length;g++)f[g]=arguments[g];f[0]=c.coerce(f[0]),"string"!=typeof f[0]&&f.unshift("%O");var h=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var g=f[h];b=e.call(a,g),f.splice(h,1),h--}return b}),c.formatArgs.call(a,f);(b.log||c.log||console.log.bind(console)).apply(a,f)}}return b.namespace=a,b.enabled=c.enabled(a),b.useColors=c.useColors(),b.color=d(a),"function"==typeof c.init&&c.init(b),b}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;b<d;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;b<d;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e.debug=e.default=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j},{ms:34}],37:[function(a,b,c){var d=b.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(a){return null!=a.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(a){var b="candidate:%s %d %s %d %s %d typ %s";return b+=null!=a.raddr?" raddr %s rport %d":"%v%v",b+=null!=a.tcptype?" tcptype %s":"%v",null!=a.generation&&(b+=" generation %d"),b}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(a){return null!=a.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{push:"invalid",names:["value"]}]};Object.keys(d).forEach(function(a){d[a].forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})})},{}],38:[function(a,b,c){var d=a("./parser"),e=a("./writer");c.write=e,c.parse=d.parse,c.parseFmtpConfig=d.parseFmtpConfig,c.parsePayloads=d.parsePayloads,c.parseRemoteCandidates=d.parseRemoteCandidates},{"./parser":39,"./writer":40}],39:[function(a,b,c){var d=function(a){return String(Number(a))===a?Number(a):a},e=function(a,b,c,e){if(e&&!c)b[e]=d(a[1]);else for(var f=0;f<c.length;f+=1)null!=a[f+1]&&(b[c[f]]=d(a[f+1]))},f=function(a,b,c){var d=a.name&&a.names;a.push&&!b[a.push]?b[a.push]=[]:d&&!b[a.name]&&(b[a.name]={});var f=a.push?{}:d?b[a.name]:b;e(c.match(a.reg),f,a.names,a.name),a.push&&b[a.push].push(f)},g=a("./grammar"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);c.parse=function(a){var b={},c=[],d=b;return a.split(/(\r\n|\r|\n)/).filter(h).forEach(function(a){var b=a[0],e=a.slice(2);"m"===b&&(c.push({rtp:[],fmtp:[]}),d=c[c.length-1]);for(var h=0;h<(g[b]||[]).length;h+=1){var i=g[b][h];if(i.reg.test(e))return f(i,d,e)}}),b.media=c,b};var i=function(a,b){var c=b.split(/=(.+)/,2);return 2===c.length&&(a[c[0]]=d(c[1])),a};c.parseFmtpConfig=function(a){return a.split(/\;\s?/).reduce(i,{})},c.parsePayloads=function(a){return a.split(" ").map(Number)},c.parseRemoteCandidates=function(a){for(var b=[],c=a.split(" ").map(d),e=0;e<c.length;e+=3)b.push({component:c[e],ip:c[e+1],port:c[e+2]});return b}},{"./grammar":37}],40:[function(a,b,c){var d=a("./grammar"),e=/%[sdv%]/g,f=function(a){var b=1,c=arguments,d=c.length;return a.replace(e,function(a){if(b>=d)return a;var e=c[b];switch(b+=1,a){case"%%":return"%";case"%s":return String(e);case"%d":return Number(e);case"%v":return""}})},g=function(a,b,c){var d=b.format instanceof Function?b.format(b.push?c:c[b.name]):b.format,e=[a+"="+d];if(b.names)for(var g=0;g<b.names.length;g+=1){var h=b.names[g];b.name?e.push(c[b.name][h]):e.push(c[b.names[g]])}else e.push(c[b.name]);return f.apply(null,e)},h=["v","o","s","i","u","e","p","c","b","t","r","z","a"],i=["i","c","b","a"];b.exports=function(a,b){b=b||{},null==a.version&&(a.version=0),null==a.name&&(a.name=" "),a.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var c=b.outerOrder||h,e=b.innerOrder||i,f=[];return c.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})}),a.media.forEach(function(a){f.push(g("m",d.m[0],a)),e.forEach(function(b){d[b].forEach(function(c){c.name in a&&null!=a[c.name]?f.push(g(b,c,a)):c.push in a&&null!=a[c.push]&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})})}),f.join("\r\n")+"\r\n"}},{"./grammar":37}],41:[function(a,b,c){var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),"candidate:"+b.join(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},d.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.getDtlsParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e=c.filter(function(a){return 0===a.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:e.split(" ")[0],value:e.split(" ")[1]}]}},d.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);return c=c.concat(d.splitLines(b)),{usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)}},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";return c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)}),c+="a=rtcp-mux\r\n",b.headerExtensions.forEach(function(a){c+=d.writeExtmap(a)}),c},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){var b=a.split(" ");return b.shift(),b.map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{payloadType:a.payloadType,ssrc:b}};c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:b,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(0===k[0].indexOf("b=TIAS:")?k=parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")&&(k=parseInt(k[0].substr(5),10)),c.forEach(function(a){a.maxBitrate=k})),c},d.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",a.rtpSender&&a.rtpReceiver?f+="a=sendrecv\r\n":a.rtpSender?f+="a=sendonly\r\n":a.rtpReceiver?f+="a=recvonly\r\n":f+="a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n"},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},b.exports=d},{}],42:[function(a,b,c){!function(){var c=a("./utils").log,d=a("./utils").browserDetails;b.exports.browserDetails=d,b.exports.extractVersion=a("./utils").extractVersion,b.exports.disableLog=a("./utils").disableLog;var e=a("./chrome/chrome_shim")||null,f=a("./edge/edge_shim")||null,g=a("./firefox/firefox_shim")||null,h=a("./safari/safari_shim")||null;switch(d.browser){case"opera":case"chrome":if(!e||!e.shimPeerConnection)return void c("Chrome shim is not included in this adapter release.");c("adapter.js shimming chrome."),b.exports.browserShim=e,e.shimGetUserMedia(),e.shimMediaStream(),e.shimSourceObject(),e.shimPeerConnection(),e.shimOnTrack();break;case"firefox":if(!g||!g.shimPeerConnection)return void c("Firefox shim is not included in this adapter release.");c("adapter.js shimming firefox."),b.exports.browserShim=g,g.shimGetUserMedia(),g.shimSourceObject(),g.shimPeerConnection(),g.shimOnTrack();break;case"edge":if(!f||!f.shimPeerConnection)return void c("MS edge shim is not included in this adapter release.");c("adapter.js shimming edge."),b.exports.browserShim=f,f.shimGetUserMedia(),f.shimPeerConnection();break;case"safari":if(!h)return void c("Safari shim is not included in this adapter release.");c("adapter.js shimming safari."),b.exports.browserShim=h,h.shimGetUserMedia();break;default:c("Unsupported browser!")}}()},{"./chrome/chrome_shim":43,"./edge/edge_shim":45,"./firefox/firefox_shim":47,"./safari/safari_shim":49,"./utils":50}],43:[function(a,b,c){var d=a("../utils.js").log,e=a("../utils.js").browserDetails,f={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var b=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.addEventListener("addtrack",function(c){var d=new Event("track");d.track=c.track,d.receiver={track:c.track},d.streams=[a.stream],b.dispatchEvent(d)}),a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var b=this;if(this._srcObject=a,this.src&&URL.revokeObjectURL(this.src),!a)return void(this.src="");this.src=URL.createObjectURL(a),a.addEventListener("addtrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)}),a.addEventListener("removetrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)})}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(a,b){d("PeerConnection"),a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var c=new webkitRTCPeerConnection(a,b),e=c.getStats.bind(c);return c.getStats=function(a,b,c){var d=this,f=arguments;if(arguments.length>0&&"function"==typeof a)return e(a,b);var g=function(a){var b={};return a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a,b){var c=new Map(Object.keys(a).map(function(b){return[b,a[b]]}));return b=b||a,Object.keys(b).forEach(function(a){c[a]=b[a]}),c};if(arguments.length>=2){var i=function(a){f[1](h(g(a)))};return e.apply(this,[i,arguments[0]])}return new Promise(function(b,c){1===f.length&&"object"==typeof a?e.apply(d,[function(a){b(h(g(a)))},c]):e.apply(d,[function(a){b(h(g(a),a.result()))},c])}).then(b,c)},c},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var c=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){b.apply(a,[d,e,c])})}return b.apply(this,arguments)}}),e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,c=this,d=new Promise(function(d,e){b.apply(c,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};b.exports={shimMediaStream:f.shimMediaStream,shimOnTrack:f.shimOnTrack,shimSourceObject:f.shimSourceObject,shimPeerConnection:f.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils.js":50,"./getusermedia":44}],44:[function(a,b,c){var d=a("../utils.js").log;b.exports=function(){var a=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},b=function(b,c){if(b=JSON.parse(JSON.stringify(b)),b&&b.audio&&(b.audio=a(b.audio)),b&&"object"==typeof b.video){var e=b.video.facingMode;if((e=e&&("object"==typeof e?e:{ideal:e}))&&("user"===e.exact||"environment"===e.exact||"user"===e.ideal||"environment"===e.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete b.video.facingMode,"environment"===e.exact||"environment"===e.ideal))return navigator.mediaDevices.enumerateDevices().then(function(f){f=f.filter(function(a){return"videoinput"===a.kind});var g=f.find(function(a){return-1!==a.label.toLowerCase().indexOf("back")})||f.length&&f[f.length-1];return g&&(b.video.deviceId=e.exact?{exact:g.deviceId}:{ideal:g.deviceId}),b.video=a(b.video),d("chrome: "+JSON.stringify(b)),c(b)});b.video=a(b.video)}return d("chrome: "+JSON.stringify(b)),c(b)},c=function(a){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},e=function(a,d,e){b(a,function(a){navigator.webkitGetUserMedia(a,d,function(a){e(c(a))})})};navigator.getUserMedia=e;var f=function(a){return new Promise(function(b,c){navigator.getUserMedia(a,b,c)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:f,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var g=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return b(a,function(a){return g(a).then(function(b){if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return b},function(a){return Promise.reject(c(a))})})}}else navigator.mediaDevices.getUserMedia=function(a){return f(a)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":50}],45:[function(a,b,c){var d=a("sdp"),e=a("../utils").browserDetails,f={shimPeerConnection:function(){if(window.RTCIceGatherer){window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a});var a=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(b){a.set.call(this,b);var c=new Event("enabled");c.enabled=b,this.dispatchEvent(c)}})}window.RTCPeerConnection=function(a){var b=this,c=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){b[a]=c[a].bind(c)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return b.localStreams},this.getRemoteStreams=function(){return b.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=a&&"max-bundle"===a.bundlePolicy,a&&a.iceServers){var d=JSON.parse(JSON.stringify(a.iceServers));this.iceOptions.iceServers=d.filter(function(a){if(a&&a.urls){var b=a.urls;return"string"==typeof b&&(b=[b]),!!(b=b.filter(function(a){return 0===a.indexOf("turn:")&&-1!==a.indexOf("transport=udp")&&-1===a.indexOf("turn:[")||0===a.indexOf("stun:")&&e.version>=14393})[0])}return!1})}this._config=a,this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this,b=d.splitSections(a.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(c){if(c.candidate&&0!==Object.keys(c.candidate).length)-1===c.candidate.candidate.indexOf("typ endOfCandidates")&&(b[c.candidate.sdpMLineIndex+1]+="a="+c.candidate.candidate+"\r\n");else for(var d=1;d<b.length;d++)-1===b[d].indexOf("\r\na=end-of-candidates\r\n")&&(b[d]+="a=end-of-candidates\r\n");if(a.localDescription.sdp=b.join(""),a.dispatchEvent(c),null!==a.onicecandidate&&a.onicecandidate(c),!c.candidate&&"complete"!==a.iceGatheringState){a.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state})&&(a.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.getConfiguration=function(){return this._config},window.RTCPeerConnection.prototype.addStream=function(a){var b=a.clone();a.getTracks().forEach(function(a,c){var d=b.getTracks()[c];a.addEventListener("enabled",function(a){d.enabled=a.enabled})}),this.localStreams.push(b),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(a){var b=this.localStreams.indexOf(a);b>-1&&(this.localStreams.splice(b,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};return a.codecs.forEach(function(a){for(var d=0;d<b.codecs.length;d++){var e=b.codecs[d];if(a.name.toLowerCase()===e.name.toLowerCase()&&a.clockRate===e.clockRate){e.numChannels=Math.min(a.numChannels,e.numChannels),c.codecs.push(e),e.rtcpFeedback=e.rtcpFeedback.filter(function(b){for(var c=0;c<a.rtcpFeedback.length;c++)if(a.rtcpFeedback[c].type===b.type&&a.rtcpFeedback[c].parameter===b.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,e=new RTCIceGatherer(c.iceOptions),f=new RTCIceTransport(e);e.onlocalcandidate=function(g){var h=new Event("icecandidate");h.candidate={sdpMid:a,sdpMLineIndex:b};var i=g.candidate,j=!i||0===Object.keys(i).length;j?(void 0===e.state&&(e.state="completed"),h.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(i.component="RTCP"===f.component?2:1,h.candidate.candidate=d.writeCandidate(i));var k=d.splitSections(c.localDescription.sdp);-1===h.candidate.candidate.indexOf("typ endOfCandidates")?k[h.candidate.sdpMLineIndex+1]+="a="+h.candidate.candidate+"\r\n":k[h.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",c.localDescription.sdp=k.join("");var l=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});switch(c.iceGatheringState){case"new":c._localIceCandidatesBuffer.push(h),j&&l&&c._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":c._emitBufferedCandidates(),c.dispatchEvent(h),null!==c.onicecandidate&&c.onicecandidate(h),l&&(c.dispatchEvent(new Event("icecandidate")),null!==c.onicecandidate&&c.onicecandidate(new Event("icecandidate")),c.iceGatheringState="complete")}},f.onicestatechange=function(){c._updateConnectionState()};var g=new RTCDtlsTransport(f);return g.ondtlsstatechange=function(){c._updateConnectionState()},g.onerror=function(){g.state="failed",c._updateConnectionState()},{iceGatherer:e,iceTransport:f,dtlsTransport:g}},window.RTCPeerConnection.prototype._transceive=function(a,b,c){var e=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:d.localCName},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),c&&a.rtpReceiver&&("video"===a.kind&&a.recvEncodingParameters&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),e.encodings=a.recvEncodingParameters,e.rtcp={cname:a.cname},a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},window.RTCPeerConnection.prototype.setLocalDescription=function(a){var b,c,e=this;if("offer"===a.type)this._pendingOffer&&(b=d.splitSections(a.sdp),c=b.shift(),b.forEach(function(a,b){var c=d.parseRtpParameters(a);e._pendingOffer[b].localCapabilities=c}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){b=d.splitSections(e.remoteDescription.sdp),c=b.shift();var f=d.matchPrefix(c,"a=ice-lite").length>0;b.forEach(function(a,b){var g=e.transceivers[b],h=g.iceGatherer,i=g.iceTransport,j=g.dtlsTransport,k=g.localCapabilities,l=g.remoteCapabilities;if("0"!==a.split("\n",1)[0].split(" ",2)[1]&&!g.isDatachannel){var m=d.getIceParameters(a,c);if(f){var n=d.matchPrefix(a,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return"1"===a.component});n.length&&i.setRemoteCandidates(n)}var o=d.getDtlsParameters(a,c);f&&(o.role="server"),e.usingBundle&&0!==b||(i.start(h,m,f?"controlling":"controlled"),j.start(o));var p=e._getCommonCapabilities(k,l);e._transceive(g,p.codecs.length>0,!1)}})}switch(this.localDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}var g=arguments.length>1&&"function"==typeof arguments[1];if(g){var h=arguments[1];window.setTimeout(function(){h(),"new"===e.iceGatheringState&&(e.iceGatheringState="gathering"),e._emitBufferedCandidates()},0)}var i=Promise.resolve();return i.then(function(){g||("new"===e.iceGatheringState&&(e.iceGatheringState="gathering"),window.setTimeout(e._emitBufferedCandidates.bind(e),500))}),i},window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,e=[],f=d.splitSections(a.sdp),g=f.shift(),h=d.matchPrefix(g,"a=ice-lite").length>0;switch(this.usingBundle=d.matchPrefix(g,"a=group:BUNDLE ").length>0,f.forEach(function(f,i){var j=d.splitLines(f),k=j[0].substr(2).split(" "),l=k[0],m="0"===k[1],n=d.getDirection(f,g),o=d.matchPrefix(f,"a=mid:");if(o=o.length?o[0].substr(6):d.generateIdentifier(),"application"===l&&"DTLS/SCTP"===k[2])return void(b.transceivers[i]={mid:o,isDatachannel:!0});var p,q,r,s,t,u,v,w,x,y,z,A,B=d.parseRtpParameters(f);m||(z=d.getIceParameters(f,g),A=d.getDtlsParameters(f,g),A.role="client"),w=d.parseRtpEncodingParameters(f);var C,D=d.matchPrefix(f,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];D&&(C=D.value);var E=d.matchPrefix(f,"a=end-of-candidates",g).length>0,F=d.matchPrefix(f,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return"1"===a.component});if("offer"!==a.type||m)"answer"!==a.type||m||(p=b.transceivers[i],q=p.iceGatherer,r=p.iceTransport,s=p.dtlsTransport,t=p.rtpSender,u=p.rtpReceiver,v=p.sendEncodingParameters,x=p.localCapabilities,b.transceivers[i].recvEncodingParameters=w,b.transceivers[i].remoteCapabilities=B,b.transceivers[i].cname=C,(h||E)&&F.length&&r.setRemoteCandidates(F),b.usingBundle&&0!==i||(r.start(q,z,"controlling"),s.start(A)),b._transceive(p,"sendrecv"===n||"recvonly"===n,"sendrecv"===n||"sendonly"===n),!u||"sendrecv"!==n&&"sendonly"!==n?delete p.rtpReceiver:(y=u.track,e.push([y,u]),c.addTrack(y)));else{var G=b.usingBundle&&i>0?{iceGatherer:b.transceivers[0].iceGatherer,iceTransport:b.transceivers[0].iceTransport,dtlsTransport:b.transceivers[0].dtlsTransport}:b._createIceAndDtlsTransports(o,i);if(E&&G.iceTransport.setRemoteCandidates(F),x=RTCRtpReceiver.getCapabilities(l),x.codecs=x.codecs.filter(function(a){return"rtx"!==a.name}),v=[{ssrc:1001*(2*i+2)}],u=new RTCRtpReceiver(G.dtlsTransport,l),y=u.track,e.push([y,u]),c.addTrack(y),b.localStreams.length>0&&b.localStreams[0].getTracks().length>=i){var H;"audio"===l?H=b.localStreams[0].getAudioTracks()[0]:"video"===l&&(H=b.localStreams[0].getVideoTracks()[0]),H&&(t=new RTCRtpSender(H,G.dtlsTransport))}b.transceivers[i]={iceGatherer:G.iceGatherer,iceTransport:G.iceTransport,dtlsTransport:G.dtlsTransport,localCapabilities:x,remoteCapabilities:B,rtpSender:t,rtpReceiver:u,kind:l,mid:o,cname:C,sendEncodingParameters:v,recvEncodingParameters:w},b._transceive(b.transceivers[i],!1,"sendrecv"===n||"sendonly"===n)}}),this.remoteDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}return c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){var a=new Event("addstream");a.stream=c,b.dispatchEvent(a),null!==b.onaddstream&&window.setTimeout(function(){b.onaddstream(a)},0),e.forEach(function(d){var e=d[0],f=d[1],g=new Event("track");g.track=e,g.receiver=f,g.streams=[c],b.dispatchEvent(a),null!==b.ontrack&&window.setTimeout(function(){b.ontrack(g)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this.dispatchEvent(b),null!==this.onsignalingstatechange&&this.onsignalingstatechange(b)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var a=new Event("negotiationneeded");this.dispatchEvent(a),null!==this.onnegotiationneeded&&this.onnegotiationneeded(a)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var a,b=this,c={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(a){c[a.iceTransport.state]++,c[a.dtlsTransport.state]++}),c.connected+=c.completed,a="new",c.failed>0?a="failed":c.connecting>0||c.checking>0?a="connecting":c.disconnected>0?a="disconnected":c.new>0?a="new":(c.connected>0||c.completed>0)&&(a="connected"),a!==b.iceConnectionState){b.iceConnectionState=a;var d=new Event("iceconnectionstatechange");this.dispatchEvent(d),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(d)}},window.RTCPeerConnection.prototype.createOffer=function(){var a=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!=typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],e=0,f=0;if(this.localStreams.length&&(e=this.localStreams[0].getAudioTracks().length,f=this.localStreams[0].getVideoTracks().length),b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(e=b.offerToReceiveAudio),void 0!==b.offerToReceiveVideo&&(f=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?e>0:f>0}),"audio"===a.kind?e--:"video"===a.kind&&f--});e>0||f>0;)e>0&&(c.push({kind:"audio",wantReceive:!0}),e--),f>0&&(c.push({kind:"video",wantReceive:!0}),f--);var g=d.writeSessionBoilerplate(),h=[];c.forEach(function(b,c){var e=b.track,f=b.kind,g=d.generateIdentifier(),i=a.usingBundle&&c>0?{iceGatherer:h[0].iceGatherer,iceTransport:h[0].iceTransport,dtlsTransport:h[0].dtlsTransport}:a._createIceAndDtlsTransports(g,c),j=RTCRtpSender.getCapabilities(f);j.codecs=j.codecs.filter(function(a){return"rtx"!==a.name}),j.codecs.forEach(function(a){"H264"===a.name&&void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1")});var k,l,m=[{ssrc:1001*(2*c+1)}];e&&(k=new RTCRtpSender(e,i.dtlsTransport)),b.wantReceive&&(l=new RTCRtpReceiver(i.dtlsTransport,f)),h[c]={iceGatherer:i.iceGatherer,iceTransport:i.iceTransport,dtlsTransport:i.dtlsTransport,localCapabilities:j,remoteCapabilities:null,rtpSender:k,rtpReceiver:l,kind:f,mid:g,sendEncodingParameters:m,recvEncodingParameters:null}}),this.usingBundle&&(g+="a=group:BUNDLE "+h.map(function(a){return a.mid}).join(" ")+"\r\n"),c.forEach(function(b,c){var e=h[c];g+=d.writeMediaSection(e,e.localCapabilities,"offer",a.localStreams[0])}),this._pendingOffer=h;var i=new RTCSessionDescription({type:"offer",sdp:g});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,b=d.writeSessionBoilerplate();this.usingBundle&&(b+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(c){if(c.isDatachannel)return void(b+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+c.mid+"\r\n");var e=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities);b+=d.writeMediaSection(c,e,"answer",a.localStreams[0])});var c=new RTCSessionDescription({type:"answer",sdp:b});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.addIceCandidate=function(a){if(a){var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}var e=this.transceivers[b];if(e){var f=Object.keys(a.candidate).length>0?d.parseCandidate(a.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port))return;if("1"!==f.component)return;"endOfCandidates"===f.type&&(f={}),e.iceTransport.addRemoteCandidate(f);var g=d.splitSections(this.remoteDescription.sdp);g[b+1]+=(f.type?a.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=g.join("")}}else this.transceivers.forEach(function(a){a.iceTransport.addRemoteCandidate({})});return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(c){var d=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){d.set(b,a[b]),d[b]=a[b]})}),b&&window.setTimeout(b,0,d),c(d)})})}}};b.exports={shimPeerConnection:f.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils":50,"./getusermedia":46,sdp:41}],46:[function(a,b,c){b.exports=function(){var a=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},b=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return b(c).catch(function(b){return Promise.reject(a(b))})}}},{}],47:[function(a,b,c){var d=a("../utils").browserDetails,e={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(d.version<38&&a&&a.iceServers){for(var c=[],e=0;e<a.iceServers.length;e++){var f=a.iceServers[e];if(f.hasOwnProperty("urls"))for(var g=0;g<f.urls.length;g++){var h={url:f.urls[g]};0===f.urls[g].indexOf("turn")&&(h.username=f.username,h.credential=f.credential),c.push(h)}else c.push(a.iceServers[e])}a.iceServers=c}return new mozRTCPeerConnection(a,b)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;if(RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},d.version<48){var b=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},c=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(a,d,e){return c.apply(this,[a||null]).then(function(a){return b(a)}).then(d,e)}}}}};b.exports={shimOnTrack:e.shimOnTrack,shimSourceObject:e.shimSourceObject,shimPeerConnection:e.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils":50,"./getusermedia":48}],48:[function(a,b,c){var d=a("../utils").log,e=a("../utils").browserDetails;b.exports=function(){var a=function(a){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},b=function(b,c,f){var g=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return b=JSON.parse(JSON.stringify(b)),e.version<38&&(d("spec: "+JSON.stringify(b)),b.audio&&(b.audio=g(b.audio)),b.video&&(b.video=g(b.video)),d("ff37: "+JSON.stringify(b))),navigator.mozGetUserMedia(b,c,function(b){f(a(b))})},c=function(a){return new Promise(function(c,d){b(a,c,d)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},e.version<41){var f=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return f().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(e.version<49){var g=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(b){return g(b).then(function(a){if(b.audio&&!a.getAudioTracks().length||b.video&&!a.getVideoTracks().length)throw a.getTracks().forEach(function(a){a.stop()}),new DOMException("The object can not be found here.","NotFoundError");return a},function(b){return Promise.reject(a(b))})}}navigator.getUserMedia=function(a,c,d){if(e.version<44)return b(a,c,d);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(a).then(c,d)}}},{"../utils":50}],49:[function(a,b,c){var d={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};b.exports={shimGetUserMedia:d.shimGetUserMedia}},{}],50:[function(a,b,c){var d=!0,e={disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(d=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(d)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)},detectBrowser:function(){var a={};if(a.browser=null,a.version=null,"undefined"==typeof window||!window.navigator)return a.browser="Not a browser.",a;if(navigator.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;a.browser="safari",a.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return a.browser="Not a supported browser.",a;a.browser="edge",a.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return a}};b.exports={log:e.log,disableLog:e.disableLog,browserDetails:e.detectBrowser(),extractVersion:e.extractVersion}},{}],51:[function(a,b,c){b.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"3.0.13",homepage:"http://jssip.net",author:"José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["Iñaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Saúl Ibarra Corretgé <saghul@gmail.com> (https://github.com/saghul)"],main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.6.8","sdp-transform":"^2.3.0","webrtc-adapter":"^3.4.3"},devDependencies:{browserify:"^14.3.0",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-header":"1.8.8","gulp-jshint":"^2.0.4","gulp-nodeunit-runner":"^0.2.2","gulp-rename":"^1.2.2","gulp-uglify":"^3.0.0","gulp-util":"^3.0.8",jshint:"^2.9.4","jshint-stylish":"^2.2.1",pegjs:"0.7.0","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0"},scripts:{test:"gulp test"}}},{}]},{},[7])(7)}),window.Telecmi=function(){var a=this;Telecmi.prototype.audioTag=function(){var a=document.createElement("AUDIO");a.setAttribute("autoplay",!0),a.setAttribute("hidden",!0),a.setAttribute("id","telecmi_audio_tag"),document.body.appendChild(a)},Telecmi.prototype.startCHUB=function(b,c){this.audioTag();var d=new JsSIP.WebSocketInterface("wss://chubws.telecmi.com");this.verto=new JsSIP.UA({uri:"sip:"+b+"@chubws.telecmi.com",sockets:[d],password:c,stun_servers:["stun:stun.l.google.com:19302"]}),this.verto.on("connected",function(){a.conTout&&clearTimeout(a.conTout),a.onStatus({event:"ws",status:"open"})}),this.verto.on("disconnected",function(b){a.conTout=setTimeout(function(){a.onStatus({event:"ws",status:"closed"})},1e4)}),this.verto.on("registered",function(){a.regTout&&clearTimeout(a.regTout),a.onStatus({event:"register",status:!0})}),this.verto.on("registrationFailed",function(b){a.onStatus({event:"register",status:!1})}),this.verto.on("unregistered",function(){a.regTout=setTimeout(function(){a.onStatus({event:"register",status:!1})},1e4)}),this.verto.on("newRTCSession",function(b){if(this.telecmi_call)return void a.onStatus({event:"busy",status:!0});var c=b.session;if(window.session=c,"incoming"===c.direction){if(a.telecmi_call)return void c.terminate();a.telecmi_call=c,a.onStatus({event:"ringing",status:!0})}c.connection&&c.connection.addEventListener("addstream",function(b){a.onStatus({event:"media",status:!0}),document.getElementById("telecmi_audio_tag").src=window.URL.createObjectURL(b.stream)}),c.on("progress",function(b){"incoming"!==c.direction&&a.onStatus({event:"trying",status:!0})}),c.on("confirmed",function(b){a.onStatus({event:"connected",status:!0})}),c.on("accepted",function(){a.onStatus({event:"answer",status:!0})}),c.on("ended",function(){a.telecmi_call&&(a.telecmi_call=null),a.onStatus({event:"hangup",status:!0})}),c.on("failed",function(b){a.telecmi_call&&(a.telecmi_call=null),a.onStatus({event:"hangup",desc:b,status:!0})})}),this.verto.start()},Telecmi.prototype.isReady=function(a){return this.verto.isConnected()},Telecmi.prototype.call=function(b){if(!this.verto.isRegistered()||!this.verto.isConnected())return void a.onStatus({event:"register",status:!1});if(this.telecmi_call)return void a.onStatus({event:"busy",status:!0});if(b){if(this.verto){var c={mediaConstraints:{audio:!0,video:!1},pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},mediaConstraints:{audio:!0,video:!1},rtcOfferConstraints:{offerToReceiveAudio:1,offerToReceiveVideo:0}};a.telecmi_call=this.verto.call("sip:"+b+"@chubws.telecmi.com",c)}}else;},Telecmi.prototype.answer=function(){if(a.telecmi_call){var b={mediaConstraints:{audio:!0,video:!1},pcConfig:{iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},mediaConstraints:{audio:!0,video:!1},rtcOfferConstraints:{offerToReceiveAudio:1,offerToReceiveVideo:0}};a.telecmi_call.answer(b)}},Telecmi.prototype.hangup=function(){a.telecmi_call&&(a.telecmi_call.terminate(),a.verto.terminateSessions())},Telecmi.prototype.onStatus=function(a){},Telecmi.prototype.dtmf=function(b){var b=0|b;a.telecmi_call&&a.telecmi_call.sendDTMF(b.toString())},Telecmi.prototype.mic=function(){a.telecmi_call&&(a.telecmi_call.mute()?a.telecmi_call.unmute({audio:!0}):a.telecmi_call.mute({audio:!0}))},Telecmi.prototype.logout=function(){a.verto&&a.verto.unregister()}};